/*! svg-designer - v1.0.0(A8 V7.0) - 2020-09-15 */
"use strict";var WorkflowConstant={scene:{DESIGNER_ADMIN:"0",DESIGNER_GENERAL:"1",DESIGNER_CHECK_ADMIN:"2",RUNNING_CHECK_GENERAL:"3",RUNNING_SUPERVISION:"4",RUNNING_MANAGERCONTROL:"5",RUNNING_STEPBACKTOTARGETNODE_PAGE:"6"},processState:{running:"0",finished:"1",startNodeRego:"2",startNodeTome:"3",humenNodeRego:"4",humenNodeTome:"5"},showMode:{read_only:"0",editable:"1"},bpmObjType:{BPMProcess:"0",BPMActivity:"1",BPMAndRouter:"2",BPMConRouter:"3",BPMEnd:"4",BPMEventActivity:"5",BPMHumenActivity:"6",BPMPolicy:"7",BPMStart:"8",BPMStatus:"9",BPMTimeActivity:"10",BPMTransition:"11",BPMSubProcess:"12",BPMActor:"13",BPMActors:"14",BPMNote:"15",BPMDataField:"16",BPMSeeyonPolicy:"17",BPMCircleLink:"18",BPMSwimlane:"19",BPMCollapsedNode:"901"},nodeState:{STATE_NORMAL:"1",STATE_READY:"2",STATE_FINISHED:"3",STATE_PAUSEED:"99",STATE_CANCEL:"4",STATE_RUN:"5",STATE_STOP:"6",STATE_ZCDB:"7",STATE_INFORM:"8",STATE_NEEDREDO_TOME:"41",STATE_SUSPENDED:"61",STATE_STOP_PASSIVITY:"22",STATE_STOP_24:"24",STATE_AUTO_SKIP:"27",STATE_stopback:"stopback"},WorkitemAction:{ACTION_CREATE:"0",ACTION_ASSIGN:"1",ACTION_CANCEL:"2",ACTION_CLAIM:"3",ACTION_ENTRUST:"4",ACTION_FINISHED:"5",ACTION_REPLACE_USER:"6",ACTION_REVIEW_PASS:"7",ACTION_RETURN:"8",ACTION_SAVE_DATE:"9",ACTION_SUSPEND:"10",ACTION_RESUME:"11",ACTION_RETURN_ENTRUST:"12",ACTION_REASSIGN:"13",ACTION_FINISHED_ENTRUST:"14",ACTION_FINISHED_DELEGATE:"15",ACTION_REVIEW_REDO:"16",ACTION_CANCEL_ENTRUST:"17",ACTION_SUSPEND_BYCASE:"18",ACTION_RESUME_BYCASE:"19",ACTION_CANCEL_BYCASE:"20",ACTION_CANCEL_BYACTIVITY:"21",ACTION_STOP:"22",ACTION_ZCDB:"23",ACTION_STOP_EXECUTOR:"24",ACTION_TAKEBACK:"25",ACTION_READ:"26",ACTION_AUTO_SKIP_OVER:"27"},ConditionType:{autoCondition1:"1",handCondition:"2",noCondition:"3",autoCondition4:"4",exclusiveCondition:"5"}},WorkflowUtil={};window.console=window.console||{},window.console.log=window.console.log||function(){},window.console.info=window.console.info||function(){},window.console.error=window.console.error||function(){},window.console.debug=window.console.debug||function(){},window.console.warn=window.console.warn||function(){},WorkflowUtil.language="zh_CN",WorkflowUtil.isDebugModel=!1,WorkflowUtil.isDebug=function(){return WorkflowUtil.isDebugModel},WorkflowUtil.context={},WorkflowUtil.extend=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);function o(){this.constructor=e}return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},WorkflowUtil.merge=function(e,t){for(var i in t)t.hasOwnProperty(i)&&!e[i]&&(e[i]=t[i]);return e},WorkflowUtil.subText=function(e,t){for(var i=t,o=new RegExp("[\\u4E00-\\u9FFF]+"),n=0,r=0,s=e,a=0,l=e.length;a<l;a++){var d=e.charAt(a);o.test(d)?n+=2:n+=1,n<=i&&(r=a+1)}return i+2<n&&(s=e.substring(0,r)+"..."),s},WorkflowUtil.isEmptyObject=function(e){if(null==e)return!0;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},WorkflowUtil.i18n=function(e){var t=arguments,i=window.I18nResource[e];if(!i)return e;if(1<t.length)for(var o=Array.prototype.slice.call(t,1),n=0,r=o.length;n<r;n++)i=i.replace(new RegExp("\\{"+n+"\\}","g"),o[n]);return i},WorkflowUtil.alert=function(e,t){$.alert(e),t&&"function"==typeof t&&t()},WorkflowUtil.toast=function(e){WorkflowUtil.alert(e)},Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var i in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e};var ModelUtil={},__uuid_rand__=0;ModelUtil.getDownNodes=function(e,t){for(var i=[],o=t.downLinks,n=0,r=o.length;n<r;n++){var s=o[n];i.push(e.getNode(s.getAttr("toId")))}return i},ModelUtil.getUpNodes=function(e,t){for(var i=[],o=t.upLinks,n=0,r=o.length;n<r;n++){var s=o[n];i.push(e.getNode(s.getAttr("toId")))}return i},ModelUtil.getEmptyXMLDoc=function(){var e;if(window.ActiveXObject)e=new ActiveXObject("Microsoft.XMLDOM");else{if(!document.implementation||!document.implementation.createDocument)return void alert("your browser do not suport XML.");e=document.implementation.createDocument("","",null)}return e},ModelUtil.xml2String=function(e){return e?window.ActiveXObject?e.xml:(new XMLSerializer).serializeToString(e):""},ModelUtil._CreateXMLDOM=function(){for(var e=["MSXML.DOMDocument","MSXML2.DOMDocument.5.0","MSXML2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","Microsoft.XMLDOM"],t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(e){}return alert("javascript parse xml string error."),null},ModelUtil.getXMLDoc=function(e){var t=null,i=navigator.userAgent;if("Microsoft Internet Explorer"===navigator.appName||-1!==i.indexOf("Trident"))(t=ModelUtil._CreateXMLDOM()).async=!1,null!=e&&t.loadXML(e);else if(document.implementation&&document.implementation.createDocument){t=document.implementation.createDocument("","",null);var o=new DOMParser;t.async=!1,null!=e&&(t=o.parseFromString(e,"text/xml"))}return t},ModelUtil.nextId=function(){var e=(new Date).getTime();return 1e5<__uuid_rand__&&(__uuid_rand__=0),e+""+__uuid_rand__++},ModelUtil.relinkNode=function(e,t,i,o,n){var r,s=t.getDownLinks(),a=e.process;n=!!n;for(var l=0,d=s.length;l<d;l++){var c=s[l];if(c.getFromNode().getId()===t.getId()&&c.getToNode().getId()===i.getId()){r=c;break}}var h=o;Array.isArray(o)||(h=[]).push(o);for(var u=0,f=h.length;u<f;u++){var p=h[u];if(a.addNode(p),0<u){var m=h[u-1],g=e.createLink(m,p);a.addLink(g)}}var v=h[0],w=h[h.length-1];if(n){t.removeDonwLink(r.getId());var N=e.createLink(t,v);a.addLink(N),ModelUtil.makeLink(w,i,r)}else{i.removeUpLink(r.getId());var A=e.createLink(w,i);a.addLink(A),ModelUtil.makeLink(t,v,r)}},ModelUtil.addNodes=function(e,t,i,o,n,r){var s=o;Array.isArray(o)||(s=[]).push(o);var a=e.process;if(!0===n){for(var l=0,d=s.length;l<d;l++){var c=s[l];if(a.addNode(c),0<l){var h=s[l-1],u=e.createLink(h,c);a.addLink(u)}}var f=s[0],p=s[s.length-1],m=e.createLink(t,f),g=e.createLink(p,i);a.addLink(m),a.addLink(g)}else{var v,w=-1,N=-1;if(r){for(var A=a.getNodes(),_=0,y=A.length;_<y;_++)if(A[_].getId()===r.getId()){w=_;break}for(var S=a.getLinks(),b=r.getUpLinks()[0],I=0,C=S.length;I<C;I++)if(S[I].getId()===b.getId()){v=S[I],N=I;break}}for(var k=0,T=s.length;k<T;k++){var M=s[k];a.addNodeBefore(M,w),-1!==w&&w++;var U=e.createLink(t,M,v),x=e.createLink(M,i);a.addLinkBefore(U,N),a.addLink(x),-1!==N&&N++}}},ModelUtil.removeLink=function(e,t,i){var o=i.getUpLinks()[0];e.process.removeLink(o)},ModelUtil.makeLink=function(e,t,i,o){for(var n=!0,r=!0,s=e.getDownLinks(),a=0,l=s.length;a<l;a++){if(s[a].getId()===i.getId()){n=!1;break}}for(var d=t.getUpLinks(),c=0,h=d.length;c<h;c++){if(d[c].getId()===i.getId()){r=!1;break}}if(n){var u=-1;if(o)for(var f=0,p=s.length;f<p;f++){if(s[f].getId()===o.getId()){u=f;break}}e.addDonwLink(i,u)}r&&t.addUpLink(i),i.setPairNodes(e,t)},ModelUtil.removeAllUpCircleLink=function(e,t){for(var i=[].concat(t.getCircleUpLinks()),o=0,n=i.length;o<n;o++)e.removeCircleLink(i[o])},ModelUtil.removeAllDownCircleLink=function(e,t){for(var i=[].concat(t.getCircleDownLinks()),o=0,n=i.length;o<n;o++)e.removeCircleLink(i[o])},ModelUtil.removeAllCircleLink=function(e,t){ModelUtil.removeAllUpCircleLink(e,t),ModelUtil.removeAllDownCircleLink(e,t)},ModelUtil._findCanSelectNodes=function(e,t,i){var o=e.getId();if(!i.hasOwnProperty(o)){i[o]=o;for(var n=e.getAvailableUpNodes(),r=0,s=n.length;r<s;r++){var a=n[r];a.isInfoNode()||a.isSplit()||a.isJoin()||a.isBlank()||a.isVouch()||a.isSuperNode()||!a.canStepBack()||(t[a.getId()]=a.getId()),ModelUtil._findCanSelectNodes(a,t,i)}}},ModelUtil.findCanSelectNodes=function(e){var t={};return ModelUtil._findCanSelectNodes(e,t,{}),t[e.getId()]=e.getId(),t},ModelUtil.findCanSelectNode4AddBranch=function(e){for(var t={},i=0,o=e;!o.isEnd()&&-1<i;){var n=o.getId();o.isSplit()?i+=1:(o.isJoin()&&(i-=1),0===i&&(t[n]=n)),o=o.getDownNodes()[0]}return t},ModelUtil.findJoin=function(e){var t=null;if(e.isSplit())for(var i=1,o=e.getDownNodes()[0];!o.isEnd()&&0<i;)o.isSplit()?i+=1:o.isJoin()&&0===(i-=1)&&(t=o),o=o.getDownNodes()[0];return t},ModelUtil.clearCopyNodeProperty=function(r,e){var t=e.getAttr("copyFrom"),i=e.getAttr("pasteTo");function o(e){for(var t=r.getAttr("usedNumberStr"),i=t?t.split(","):[],o=0,n=i.length;o<n;o++)if(i[o]===e){i.splice(o,1);break}t=i.join(","),r.setAttr("usedNumberStr",t)}if(t){for(var n=r.getNode(t),s=(i=n.getAttr("pasteTo"))?i.split(","):[],a=0,l=s.length;a<l;a++)if(s[a]===e.getId()){s.splice(a,1);break}if(i=s.join(","),n.setAttr("pasteTo",i),n.setForceRedraw(!0),""===i)o(n.getAttr("copyNumber")),n.setAttr("copyNumber","");e.setAttr("copyFrom",""),e.setAttr("pasteTo",""),e.setAttr("copyNumber","")}else if(i){for(var d=i?i.split(","):[],c=0,h=d.length;c<h;c++){var u=r.getNode(d[c]);u&&(u.setAttr("copyFrom",""),u.setAttr("pasteTo",""),u.setAttr("copyNumber",""),u.setForceRedraw(!0))}o(e.getAttr("copyNumber")),e.setAttr("copyFrom",""),e.setAttr("pasteTo",""),e.setAttr("copyNumber","")}e.setForceRedraw(!0)},ModelUtil.iterator=function(e,a,l){var d={};1===l(e)&&function e(t){for(var i=t.getAvailableDownNodes(),o=0,n=i.length;o<n;o++){var r=i[o];if(!d[r.getId()]){d[r.getId()]=!0;var s=l(r);if(-1===s)return!1;if(1===s&&(!a||a.getId()!==r.getId())&&!1===e(r))return!1}}return!0}(e)};var WorkflowApp=function(){var t=function(e){this.setting=null,this.controller=null;var t={target:"",width:0,height:0,toolbar:"",language:"zh_CN",scene:WorkflowConstant.scene.RUNNING_CHECK_GENERAL,debug:!1,context:{}};e=WorkflowUtil.merge(e,t),WorkflowUtil.language=e.language,WorkflowUtil.isDebugModel=!!e.debug,WorkflowUtil.context=e.context,WorkflowUtil.context.scene=e.scene,WorkflowUtil.context.expandedSplits={},this._init(e)},e=t.prototype;e.version="1.1.0",e._init=function(e){this.setting=e,this.controller=new t.Controller({scene:e.scene,container:e.target,toolbar:e.toolbar,bottomBar:e.bottomBar,eagleEye:e.eagleEye,width:e.width,height:e.height})};var i={loadWorkflow:"_loadWorkflow",reloadWorkflow:"_reloadWorkflow",toXMLObject:"_toXMLObject",getNodeInfo:"_getNodeInfo",minimizeView:"_minimizeView",maximizeView:"_maximizeView",scaleView:"_scaleView",hasPolicy:"_hasPolicy",getAllWFSuperNodeNames:"_getAllWFSuperNodeNames",getAllWFSuperNodePartyIds:"_getAllWFSuperNodePartyIds",setRelationDataToProcess:"_setRelationDataToProcess",stepbackTargetNodeCallback:"_stepbackTargetNodeCallback",resizeScrollPane:"_resizeScrollPane",switchToFlash:"_switchToFlash"};for(var o in i){var n=i[o];o!==n?t.prototype[o]=function(e){return function(){if(t.prototype[e])return t.prototype[e].apply(this,arguments);console.error(e+"接口未定义")}}(n):console.error("错误的接口定义， 方法名和实际执行函数相同了.")}return e._minimizeView=function(){this.controller.scaleView(0,!0)},e._maximizeView=function(){this.controller.scaleView(1,!0)},e._scaleView=function(e){!0===e?this.controller.scaleView(.2):this.controller.scaleView(-.2)},e._loadWorkflow=function(e){return this.controller.loadProcess({processXml:e.processXml,caseLogXml:e.caseLogXml,caseWorkitemLogXml:e.caseWorkitemLogXml,verifyResultXml:e.verifyResultXml}),this},e._reloadWorkflow=function(e){return this.controller.reLoadProcess({processXml:e.processXml,caseLogXml:e.caseLogXml,caseWorkitemLogXml:e.caseWorkitemLogXml}),this},e._toXMLObject=function(){return this.controller.parseProcess2XML()},e._getNodeInfo=function(){for(var e="",t=this.controller.getNodeInfos(10),i=0,o=t.length;i<o;i++)""!==e&&(e+="、"),e+=t[i];return e},e._setRelationDataToProcess=function(e){var t=this.controller.view.controller.model.process;if(e)for(var i=0,o=e.length;i<o;i++){var n=e[i],r=n.activityId,s=n.activityDataId,a=t.getNode(r);if(a)a.getPolicy().setAttr("DR",s)}},e._stepbackTargetNodeCallback=function(e){this.controller.view.setStepBackTargetNodeCallback(e)},e._resizeScrollPane=function(){this.controller.view.refreshLayout()},e._switchToFlash=function(){window.switchDesigner("flash")},e._hasPolicy=function(e){return this.controller.model.process.hasPolicy(e)},e._getAllWFSuperNodeNames=function(){return this.controller.model.process.getAllWFSuperNodeNames()},e._getAllWFSuperNodePartyIds=function(){return this.controller.model.process.getAllWFSuperNodePartyIds()},t}();!function(I){var s=function(){this.splits=[],this.split2Join={},this.join2Split={},this.currentSplit="",this.splitSubMaxX={},this.pushSplit=function(e){this.currentSplit=e.getId(),this.splits.push(e)},this.popSplit=function(){var e=null;return 0<this.splits.length&&(e=this.splits.pop()),e},this.getSplitSubMaxX=function(e){var t=0,i=this.splitSubMaxX[e];return i&&(t=i),t},this.setSplitSubMaxX=function(e){if(this.currentSplit){var t=this.splitSubMaxX[this.currentSplit]||0;this.splitSubMaxX[this.currentSplit]=Math.max(t,e)}},this.changeCurrentSplit=function(){this.currentSplit&&delete this.splitSubMaxX[this.currentSplit],0<this.splits.length?this.currentSplit=this.splits[this.splits.length-1].getId():this.currentSplit=""},this.getTempSplitSize=function(){return this.splits.length},this.addSplipt2JoinRelation=function(e,t){this.split2Join[e]=t,this.join2Split[t]=e},this.getSplitByJoin=function(e){return this.join2Split[e]},this.getJoinBySplit=function(e){return this.split2Join[e]}},e=function(e,t){this.ignoreDelete=!0===e,this.merge=!0===t},t=e.prototype;t.setIgnoreDelete=function(e){this.ignoreDelete=e},t.setMergeSplitAndJoin=function(e){this.merge=e},t.calculateLocation=function(e,t){var i=(new Date).getTime();e.setMaxX(0),e.setMaxY(0);var o=e.getStartNode(),n=new s;o.setVisible(!0),this._countSubSize(o,e,n);var r=(o.getSubSize()-1)/2;this._calculateNode(o,0,r,e,n),this._calculateNodeBySwimlane(e,!1),console.log("计算节点位置耗时 "+((new Date).getTime()-i)+" ms")},t._calculateNodeBySwimlane=function(e,t){for(var i=e.getSwimlanes(),o=0,n=i.length;o<n;o++){for(var r=i[o],s=r.getNodes(),a=-1,l=0,d=0,c=s.length;d<c;d++){var h=s[d];h.isVisible()&&!0!==h.isCollapsed&&(a=-1===a?h.getX():Math.min(a,h.getX()),l=Math.max(l,h.getX()))}-1===a?r.setVisible(!1):(r.setVisible(!0),r.setMinX(a),r.setMaxX(l+1))}if(!e.isEmptySwimlane()&&t)for(var u=1,f=i.length;u<f;u++){var p=void 0,m=u-1;for(p=i[m];!p.isVisible()&&0<m;)p=i[m],m--;var g=i[u];if(g.isVisible()&&g.getMinX()<p.getMaxX()){var v=p.getMaxX()-g.getMinX(),w=g.getMinX();g.setMinX(p.getMaxX());for(var N=g.getNodes(),A=0,_=N.length;A<_;A++)for(var y=A+1;y<_;y++)if(N[A].getX()>N[y].getX()){var S=N[A];N[A]=N[y],N[y]=S}for(var b={},I=0,C=N.length;I<C;I++){for(var k=N[I],T=-1,M=k.getAvailableUpNodes(),U=!1,x=0,E=M.length;x<E;x++){var V=M[x];if(V.isSkip())for(;;){if(!(V=V.getAvailableUpNodes()[0])||!V.isSkip())break}if(V.getSwimlane().getId()===g.getId()&&V.isVisible()){U=!0;var L=k.getX()-V.getX();1===L&&(L=b[V.getId()]),T=-1===T?L:Math.min(T,L)}}U||(T=k.getX()-w+1),-1===T&&(T=1),b[k.getId()]=T}for(var P=0,B=0,O=N.length;B<O;B++){var D=N[B],W=b[D.getId()],R=D.getX()+v-(W-1);R>e.getMaxX()&&e.setMaxX(R),P=Math.max(R,P),D.setX(R)}var F=P+1;g.setMaxX(F)}}},t._countSubSize=function(e,t,i){var o=WorkflowUtil.context;e.isSplit()&&i.pushSplit(e),e.isDelete()&&e.setVirtual(!0);var n=i.getTempSplitSize(),r=0,s=e.getDownLinks();if(s&&0<s.length)for(var a=0,l=s.length;a<l;a++){var d=s[a].getToNode();if(!d.isDelete()||this.ignoreDelete){d.setVisible(!0);var c=!0;if(d.setDelete(e.isDelete()),d.isSplit())r+=this._countSubSize(d,t,i),d.isDelete()&&!this.ignoreDelete&&(c=!1);else if(d.isJoin()){if(!i.getSplitByJoin(d.getId())){var h=i.popSplit();i.addSplipt2JoinRelation(h.getId(),d.getId())}d.addPreLineSize()}else r+=this._countSubSize(d,t,i);c&&(d.isCurrentPath&&(e.isCurrentPath=!0,e.isSplit()&&(e.currentPathSize++,1===e.currentPathSize?e.nextCurrentPathNodeId=d.getId():e.nextCurrentPathNodeId=null)),e.addNextLineSize())}}if(0<r&&e.setNextSubSize(r),e.isSplit()){0===r&&(e.setDelete(!0),e.setSubSize(0),e.setVisible(this.ignoreDelete));var u=0,f=null,p=i.getJoinBySplit(e.getId());if(p&&(f=t.getNode(p)),o.scene!==WorkflowConstant.scene.RUNNING_STEPBACKTOTARGETNODE_PAGE&&"default"===e.splitDisplay&&""!==o.expandedSplits[e.getId()]&&e.getNextLineSize()>o.collapsedCriticalValue){if(e.splitDisplay="collapsed",1===e.currentPathSize){var m=e.nextCurrentPathNodeId,g=t.getNode(m).getSubSize()+1;e.setNextSubSize(g),r=g}else e.setNextSubSize(1),r=1;e.collapseNode=new I.BPMCollapsedNode(e,f)}else o.expandedSplits[e.getId()]="",e.splitDisplay="expanded";if(n===i.getTempSplitSize())i.popSplit();else if(f){if(f.setDelete(e.isDelete()),f.reachToJoinNodes=[],!f.isDelete()){for(var v=f.getUpNodes(),w=!0,N=0,A=v.length;N<A;N++){if(!v[N].isDelete()){w=!1;break}}w&&(f.setDelete(!0),f.setVisible(this.ignoreDelete))}f.isDelete()&&(f.setVirtual(!0),f.setVisible(this.ignoreDelete)),u=this._countSubSize(f,t,i),f.isCurrentPath&&(e.isCurrentPath=!0)}r<u&&(r=u)}else if(e.isJoin()){for(var _=e.getDownNodes(),y=!0,S=0,b=_.length;S<b;S++){if(!_[S].isDelete()){y=!1;break}}y&&(e.setDelete(!0),e.setVisible(this.ignoreDelete),e.setVirtual(this.ignoreDelete))}return e.getSubSize()<r&&e.setSubSize(r),!this.ignoreDelete&&this.merge&&(e.isSplit()&&e.getNextLineSize()<=1||e.isJoin()&&e.getPreLineSize()<=1)&&(e.setSkip(!0),e.setVisible(!1)),e.getId()===o.currentNodeId&&(e.isCurrentPath=!0),e.getSubSize()},t._calculateNode=function(e,t,i,o,n){e.setX(t),e.setY(i),t>o.getMaxX()&&o.setMaxX(t),i>o.getMaxY()&&o.setMaxY(i);var r=e.getDownNodes();if(e.isSplit()&&"collapsed"===e.splitDisplay){var s=e.collapseNode;if(r=[],1===e.currentPathSize){n.pushSplit(e);var a=o.getNode(e.nextCurrentPathNodeId);r.push(a),r.push(s)}else{s.setX(t),s.setY(i);var l=s.joinNode;e=s,l&&(r=(e=l).getDownNodes())}n.setSplitSubMaxX(t)}else e.isSplit()&&n.pushSplit(e),e.isJoin()||n.setSplitSubMaxX(t);if(r&&0<r.length){var d,c=e.getSubSize(),h=e.getNextSubSize();d=h<c?(h+1)/2:(c+1)/2;for(var u=0,f=0,p=r.length;f<p;f++){var m=r[f];if(!m.isHidden()){var g=u+1;u+=m.getSubSize();var v=t+1;!this.ignoreDelete&&this.merge&&m.isSkip()&&(v=t);var w=(i+(g-d)+(i+(u-d)))/2;m.isJoin()?(m.reachToJoinNodes.push(e),m.setY(i)):this._calculateNode(m,v,w,o,n)}}}if(e.isSplit()){var N=o.getNode(n.getJoinBySplit(e.getId())),A=n.getSplitSubMaxX(e.getId());if(n.popSplit(),n.changeCurrentSplit(),n.setSplitSubMaxX(A),N){var _=0,y=N.getY(),S=N.reachToJoinNodes;N.reachToJoinNodes=[];for(var b=0,I=0,C=S.length;I<C;I++){var k=S[I],T=k.getX();k.isHidden()?T=0:b++,_=Math.max(_,T)}1<b&&(y=e.getY()),_=Math.max(A,_),N.isSkip()||(_+=1),this._calculateNode(N,_,y,o,n)}}},I.AutoLayout=e}(WorkflowApp),function(c){var e=function(e){var t=this.autoLayout=new c.AutoLayout(!1,!0);this.scene=e.scene||WorkflowConstant.scene.RUNNING_CHECK_GENERAL,WorkflowUtil.isDebug()&&(t.setIgnoreDelete(!0),t.setMergeSplitAndJoin(!0)),this.model=new c.Model({controller:this}),this.view=new c.View({container:e.container,toolbar:e.toolbar,bottomBar:e.bottomBar,eagleEye:e.eagleEye,width:e.width,height:e.height,model:this.model,controller:this})},t=e.prototype;t.loadProcess=function(e){var t=(new Date).getTime(),i=this.model,o=this.view;i.parseProcessFromXML({processXml:e.processXml,caseLogXml:e.caseLogXml,caseWorkitemLogXml:e.caseWorkitemLogXml,verifyResultXml:e.verifyResultXml}),console.log("解析xml耗时 "+((new Date).getTime()-t)+" ms");var n=i.process,r=i.caseLog;this._setNodeState(n,r);var s=WorkflowUtil.context;if(s.scene===WorkflowConstant.scene.RUNNING_STEPBACKTOTARGETNODE_PAGE){var a=n.getNode(s.currentNodeId),l=ModelUtil.findCanSelectNodes(a);o.setEnableNodes(l)}o.createToolbar(),this.drawOrRefreshView();var d=this;setTimeout(function(){var e=WorkflowUtil.context,t=d.model.process;d.locationNode(e.currentNodeId),2!==t.nodes.length||e.showMode!==WorkflowConstant.showMode.editable||e.isTemplete||(d.view.focusNode(t.getStartNode()),new c.AddPartyCommand(d.view,t.getStartNode()).run()),d=null},10),console.log("流程加载耗时："+((new Date).getTime()-t)+"ms"),console.log("=========流程图信息========="),console.log("当前节点数量:"+n.nodes.length),console.log("当前连线数量:"+n.links.length),console.log("当前环线线数量:"+n.circleLinks.length),console.log("^^^^^^^^^测试信息^^^^^^^^^")},t.reLoadProcess=function(e){var t=this.model;t.parseProcessFromXML({processXml:e.processXml,caseLogXml:e.caseLogXml,caseWorkitemLogXml:e.caseWorkitemLogXml});var i=t.process,o=t.caseLog;this._setNodeState(i,o),this.drawOrRefreshView(!0,!0)},t.calculateLocation=function(e){for(var t=this.model.process,i=this.autoLayout,o=t.nodes,n=0,r=o.length;n<r;n++){var s=o[n];s.resetLocationInfo(),s.isCollapsed=!1,!(s.collapsedBy=null)===e&&s.setForceRedraw(!0),s.isSplit()&&"default"!==s.splitDisplay&&"collapsed"===s.splitDisplay&&(s.splitDisplay="default",s.nextCurrentPathNodeId=null,s.collapseNode=null,s.currentPathSize=0)}i.calculateLocation(t,this.view.viewState.swimlaneVisible)},t.drawOrRefreshView=function(e,t){var i=this.view;!1!==e&&this.calculateLocation(t),i.draw()},t.locationNode=function(e){this.view.locationNode(e)},t.getNodeInfos=function(e){return this.model.getNodeInfoStr(e)},t.scaleView=function(e,t){this.view.scale(e,t)},t.parseProcess2XML=function(){var e=ModelUtil.getEmptyXMLDoc();if(!e)return"";if(this.model.process.nodes.length<3)return"";var t=e.createElement("ps");return e.appendChild(t),this.model.process.toXML(t,e),ModelUtil.xml2String(e)},t._setNodeState=function(e,t){if(t)for(var i=t.getStepList(),o=0,n=i.length;o<n;o++)for(var r=i[o].getFrameList(),s=0;s<r.length;s++){var a=r[s],l=e.getNode(a.getNodeId());if(null!=l){var d=WorkflowConstant.nodeState;l.getState()===d.STATE_STOP&&a.getState()!==d.STATE_READY||l.setState(a.getState())}}},c.Controller=e}(WorkflowApp),function(l){var e=function(e){this.process=null,this.caseLog=null,this.caseItemLog=null,this.controller=e.controller,this.verifyMap={}},t=e.prototype;t.parseProcessFromXML=function(e){var t,i,o;console.log("初始化Model"),e.processXml?(t=new l.BPMProcess).fromXML(e.processXml):t=this._createEmptyProcess(),this.process=t,e.caseLogXml&&(i=new l.BPMCaseLog).fromXML(e.caseLogXml),this.caseLog=i,e.caseWorkitemLogXml&&(o=new l.BPMCaseItemLog).fromXML(e.caseWorkitemLogXml),this.caseItemLog=o,e.verifyResultXml&&this._parseVerifyResultXml(e.verifyResultXml)},t._parseVerifyResultXml=function(e){for(var t=ModelUtil.getXMLDoc(e).documentElement.firstChild;null!=t;){var i=t.nodeName,o=t.getAttribute("s"),n=t.getAttribute("id"),r=void 0;switch(i){case"n":r="node";break;case"l":r="link";break;case"cl":r="clink"}for(var s={type:r,state:o},a=t.firstChild;null!=a;){var l="",d=a.firstChild;d&&(l=d.nodeValue||""),s[a.nodeName]=l,a=a.nextSibling}this.verifyMap[n]=s,t=t.nextSibling}},t._createEmptyProcess=function(){var e=WorkflowUtil.context,t=new l.BPMProcess,i=this._createNode({id:"start",operationName:e.startOperationName,form:e.formName,formApp:e.formApp,name:e.isTemplete?e.label.startUser:e.currentUserName});t.addNode(i);var o=this._createNode({id:"end",name:"end"});t.addNode(o);var n=this.createLink(i,o);return t.addLink(n),e.isTemplete&&e.hasWorkflowAdvanced&&t.initSwimlane(),t},t.createByParty=function(e){var t=new l.BPMHumenActivity,i=WorkflowUtil.context;t.setName(e.name);var o="";e.nodeDesc&&"null"!==e.nodeDesc&&(o=e.nodeDesc),t.setAttr("desc",o);var n=t.getActor(),r=t.getPolicy();r.setAttr("id",i.defaultPolicyId),r.setAttr("name",i.defaultPolicyName),r.setAttr("operationName",i.operationName),r.setAttr("form",i.formName),r.setAttr("formApp",i.formApp),i.isTemplete?r.setProcessMode("single"):r.setProcessMode("all");var s=e.type;"Member"!==s&&"user"!==s||(s="user",r.setProcessMode("single")),n.setAttr("roleId","roleadmin"),n.setAttr("partyVJoin",e.externalType),n.setAttr("partyExcludeChildChild",!!e.excludeChildDepartment),n.setAttr("includeChild",!1),n.setAttr("partyId",e.id),n.setAttr("partyType",s),n.setAttr("name",e.name),n.setAttr("partyAccountId",e.accountId),n.setAttr("shortName",e.accountShortname);var a={processMode:e.processMode,tolerantModel:e.tolerantModel,interveneMemberId:e.interveneMemberId,stepBackType:e.stepBackType};return this.resetPolicy(t,a),t},t.resetPolicy=function(e,t){var i=e.getActor(),o=e.getPolicy(),n=WorkflowUtil.context,r=i.getAttr("partyType"),s=i.getAttr("partyAccountId"),a=i.getAttr("partyId");if("Post"===r){var l=o.getAttr("matchScope"),d="-1730833917365171641"===s;!n.isTemplete&&d?l="2":n.isTemplete&&d?"4"===l&&(l="1"):d||"2"!==l&&"4"!==l&&"5"!==l||(l="1"),o.setAttr("matchScope",l)}if(e.isBlank()&&(o.setAttr("id",n.label.inform),o.setAttr("name",n.label.informName),o.setAttr("isHasNewflow","0"),o.setAttr("multipleMode","")),"Department_Role"===r)o.setAttr("rup","0");else if(e.isSuperNode())"1"===t.processMode?o.setAttr("processMode","1"):(o.setAttr("processMode","0"),o.setAttr("id","inform"),o.setAttr("name",n.label.informName)),t.tolerantModel&&o.setAttr("tolerantModel",t.tolerantModel),t.interveneMemberId&&o.setAttr("dealTermUserId",t.interveneMemberId),"2"===t.stepBackType&&o.setAttr("stepBackType",t.stepBackType),o.setAttr("isHasNewflow","0"),"external_seal"===a&&(o.setAttr("processMode","1"),o.setAttr("id","信任签字"),o.setAttr("name","信任签字"));else if("WFDynamicForm"===r)o.setAttr("na","2"),o.setAttr("ignoreBlank","1"),o.setAttr("asBlankNode","1"),-1!==a.indexOf("Member")?o.setProcessMode("single"):(o.setProcessMode("all"),o.setAttr("isHasNewflow","0"));else if("FormField"===r){a.indexOf("@");var c=a.indexOf("#"),h=a.lastIndexOf("#"),u="";-1!==h&&c!==h&&(u=a.substr(h+1)),c===h&&(0===a.indexOf("Member")?o.setProcessMode("single"):(o.setProcessMode("all"),o.setAttr("isHasNewflow","0"))),""!==u&&o.setAttr("rup","0")}},t.createSplit=function(){var e=new l.BPMAndRouter,t=WorkflowUtil.context;return e.setAttr("start","true"),e.setName("split"),t.expandedSplits[e.getId()]="",e.splitDisplay="expanded",e},t.createJoin=function(){var e=new l.BPMAndRouter;return e.setAttr("start","false"),e.setName("join"),e},t._createNode=function(e){var t,i=WorkflowUtil.context;if("start"===e.id){if(t=new l.BPMStart,this.controller.scene===WorkflowConstant.scene.DESIGNER_GENERAL){var o=t.getActor();o.setAttr("partyId",i.currentUserId),o.setAttr("partyType","user"),o.setAttr("name",i.currentUserName)}}else t="end"===e.id?new l.BPMEnd:new l.BPMHumenActivity;t.setId(e.id),t.setName(e.name);var n=t.getPolicy();if(n){n.setAttr("operationName",e.operationName),n.setAttr("form",e.form),n.setAttr("formApp",e.formApp);var r=e.processMode;r||(r=i.isTemplete?"single":"all"),n.setProcessMode(r)}return t},t._getNodeInfoStr=function(e,t,i,o){if(!t.isEnd()&&!o.hasOwnProperty(t.getId())){o[t.getId()]=t.getId();var n=t.getAvailableDownNodes();if(0<n.length){for(var r=0,s=n.length;r<s;r++){if(i.length>=e)return;var a=n[r];if(a.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMHumenActivity){var l=a.getName(),d=a.getPolicyName();if(l&&d){var c="",h=a.getActor().getAttr("shortName");h&&(c+="("+h+")"),a.isBlank()?c+=l:c+=l+"("+d+")",i.push(c)}}}if(i.length<e)for(var u=0,f=n.length;u<f;u++)this._getNodeInfoStr(e,n[u],i,o)}}},t.createLink=function(e,t,i){var o=new l.BPMTransition;return o.setId(ModelUtil.nextId()),ModelUtil.makeLink(e,t,o,i),o},t.createCircleLink=function(e,t){var i=new l.BPMCTransition;return i.setId(ModelUtil.nextId()),i.setPairNodes(e,t),i},t.getNodeInfoStr=function(e){var t=[];return this._getNodeInfoStr(e,this.process.getStartNode(),t,{}),t},t.isNewCreate=function(){return null==this.caseLog},l.Model=e}(WorkflowApp);var SVGUtil=function(){var r="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xlink",c={nodeicon_end:"node_End",nodeicon_user:"node_User",nodeicon_start:"node_User",nodeicon_Account:"node_Account",nodeicon_BusinessAccount:"node_Account",nodeicon_Account_Role:"node_Role",nodeicon_Department_Role:"node_Role",nodeicon_Role:"node_Role",nodeicon_Department:"node_Department",nodeicon_BusinessDepartment:"node_Department",nodeicon_Department_Post:"node_Post",nodeicon_Post:"node_Post",nodeicon_FormField:"node_FormField",nodeicon_FormField_Mutil:"node_FormField",nodeicon_office:"node_FormField",nodeicon_Level:"node_Level",nodeicon_SuperNode:"node_SuperNode",nodeicon_SynNode:"node_SynNode",nodeicon_Team:"node_Team",nodeicon_VJ_Account_1:"node_VJ_Account_1",nodeicon_VJ_AccountTag:"node_VJ_AccountTag",nodeicon_VJ_Department_1:"node_VJ_Department_1",nodeicon_VJ_Department_2:"node_VJ_Department_2",nodeicon_VJ_Post_1:"node_VJ_Post_1",nodeicon_VJ_user_1:"node_VJ_User_1",nodeicon_BlankNode:"node_BlankNode",nodeicon_BlankNode_current:"node_BlankNode_current",nodeicon_CollapsedNode:"node_CollapsedNode",branch_auto_force:"branch_forceAutoCondition",branch_auto_force_red:"branch_forceAutoCondition_red",branch_auto:"branch_autoSelect",branch_auto_red:"branch_autoSelect_red",branch_manual:"branch_handSelect",branch_manual_red:"branch_handSelect_red",branch_exclusive:"branch_exclusive","nodestate_monitor-autoskip":"state_monitor-autoskip","nodestate_monitor-finish":"state_monitor-finish","nodestate_monitor-stop":"state_monitor-stop","nodestate_monitor-stoped":"state_monitor-stoped",nodestate_read:"state_read",nodestate_stepbackto:"state_stepbackto",nodestate_stepNodeFlag:"state_stepNodeFlag",nodestate_steppedNodeFlag:"state_steppedNodeFlag",nodestate_steppedNodeReadFlag:"state_steppedNodeReadFlag",nodestate_steppedNodeZcdbFlag:"state_steppedNodeZcdbFlag",nodestate_temporary:"state_temporary",nodestate_unread:"state_unread",other_Competition:"other_Competition",other_advanceEvent:"other_advanceEvent",other_Newflow:"other_Newflow",other_Newflow_red:"other_Newflow_red",other_Newflow_99:"other_Newflow_99"},e=function(){var e,t,i,o,n;this.supported=!!document.createElementNS&&!!document.createElementNS(r,"svg").createSVGRect,this.isIE=(e=navigator.userAgent,t=-1<e.indexOf("compatible")&&-1<e.indexOf("MSIE"),i=-1<e.indexOf("Edge")&&!t,o=-1<e.indexOf("Trident")&&-1<e.indexOf("rv:11.0"),n=!0,t||i||o||(n=!1),n),this.ieLoadSymbol=!1},t=e.prototype={create:function(e){var t;return t=document.createElementNS(r,e),"svg"===e.toLowerCase()&&(t.setAttribute("xmlns",r),t.setAttribute("version","1.1"),t.setAttribute("xmlns:xlink",o),t.setAttribute("xmlns:s","http://www.seeyon.com/")),ViewUtil.randId(t),t},createDom:function(e){var t=document.createElement(e);return ViewUtil.randId(t),t},newText:function(e){return document.createTextNode(e)},setAttr:function(e,t,i){0===t.indexOf("xlink:")?e.setAttributeNS(o,t,i):e.setAttribute(t,i)},setAttrs:function(e,t){for(var i in t)t.hasOwnProperty(i)&&this.setAttr(e,i,t[i])},getAttr:function(e,t){if(0!==t.indexOf("xlink:"))return e.getAttribute(t);var i=t.replace("xlink:","");return e.getAttributeNS(o,i)}};return t.getDefIcon=function(e,t,i){var o,n,r,s=e.split("_"),a=s[0],l=s[1];switch(i?o="node_User.png":(o=c[e])?(t&&(o+="_Current"),o+=".svg"):(o="node_FormField.png",i=WorkflowUtil.context.iconRoot+"node_custom_"+l+".png?build="+WorkflowApp.buildInfo),o=WorkflowUtil.context.iconRoot+o+"?build="+WorkflowApp.buildInfo,n=r=32,a){case"branch":n=r=23;break;case"nodeicon":n=r=34,i&&(n=r=34);break;case"nodestate":n=r=16,"nodestate_steppedNodeFlag"!==e&&"nodestate_steppedNodeReadFlag"!==e&&"nodestate_steppedNodeZcdbFlag"!==e||(n=16,r=24);break;case"other":"other_Newflow"===e||"other_Newflow_red"===e||"other_Newflow_99"===e?(n=17,r=15):"other_Competition"===e?(n=10,r=16):n=r=16}var d=this.create("image");return this.setAttr(d,"width",n),this.setAttr(d,"height",r),this.setAttr(d,"xlink:href",o),i&&ViewUtil.lazyLoadImg(d,i),d},t.getDefIconId=function(e){if(-1!==e.indexOf("_VJ_"))switch(e){case"nodeicon_VJ_Account_1":e="nodeicon_Account";break;case"nodeicon_VJ_Department_1":e="nodeicon_Department";break;case"nodeicon_VJ_Department_2":break;case"nodeicon_VJ_Post_1":e="nodeicon_Post";break;case"nodeicon_VJ_user_1":e="nodeicon_user"}if(this.isIE,!this.ieLoadSymbol){this.ieLoadSymbol=!0;var t=new XMLHttpRequest;t.onload=function(e){document.body.insertAdjacentHTML("afterBegin",'<div style="display:none;">'+t.responseText+"</div>")},t.open("GET",WorkflowUtil.context.iconRoot+"svg_designer_all_icons.svg?build="+WorkflowApp.buildInfo,!1),t.send()}return c[e]},t.svgPathCurv=function(e,t,i,o){return"M"+e+","+t+" "+("Q"+(e+i)/2+","+((t+o)/2-100)+" ")+(i+","+o+" ")},new e}();function _transformFlashArgsXml2Context(e){var n=ModelUtil.getXMLDoc(e).documentElement;function t(e){var t=n.getElementsByTagName(e);if(t&&0<t.length){var i=t[0].firstChild;if(i){var o=i.nodeValue||"";return"null"!==o&&"undefined"!==o||(o=""),o}}return""}var i={currentNodeId:t("currentNodeId"),formName:t("formName"),operationName:t("operationName"),startOperationName:t("startOperationName"),defaultPolicyId:t("defaultPolicyId"),defaultPolicyName:t("defaultPolicyName"),appName:t("appName"),isTemplete:"true"===t("isTemplete"),isFormTemplate:"true"===t("isFormTemplate"),isShowReadState:t("isShowReadState"),isCIPModel:"true"===t("isCIPModel"),isSkipNode:"true"===t("isSkipNode"),hasWorkflowAdvanced:"true"===t("hasWorkflowAdvanced"),showHastenButton:t("showHastenButton"),processState:t("state"),showMode:t("showMode")||WorkflowConstant.showMode.read_only,canDrSet:t("canDrSet"),currentUserId:t("currentUserId")||window.currentUserId||"",currentUserName:t("currentUserName"),currentUserAccountName:t("currentUserAccountName"),newflowNodeIdsStr:t("newflowNodeIdsStr"),formApp:t("formApp"),collapsedCriticalValue:parseInt(t("collapsedCriticalValue")||"15"),label:{etAl:t("etAl"),informName:t("informName"),inform:"inform",startUser:t("startUser"),unallowed:t("unallowed"),splitCondition:t("splitCondition"),currentNodeUser:t("currentNodeUser"),moreOptionI18N:t("moreOptionI18N"),handworkConditionI18N:t("handworkConditionI18N"),exclusiveConditionI18N:t("exclusiveConditionI18N"),autoConditionI18N:t("autoConditionI18N"),submitstyle:t("submitstyle"),rerunlabel:t("rerunlabel"),submittolabel:t("submittolabel"),personDelete:t("personDelete"),personDimission:t("personDimission"),personUnAssign:t("personUnAssign"),personTruce:t("personTruce"),swimlaneName:t("swimlaneName"),startSwimlaneName:t("startSwimlaneName"),clickEditSwimlaneName:t("clickEditSwimlaneName"),cannotSplitSwimlane:t("cannotSplitSwimlane"),colon:t("colon"),unRN0:t("unRN0"),unRN1:t("unRN1"),unRN2:t("unRN2"),unANF0:t("unANF0"),unANF1:t("unANF1"),unAN0:t("unAN0"),unAN1:t("unAN1"),unDN0:t("unDN0"),unDN1:t("unDN1"),unDN2:t("unDN2"),unSN0:t("unSN0"),unSN1:t("unSN1"),unSN2:t("unSN2"),unSN3:t("unSN3"),unSN4:t("unSN4"),unSN5:t("unSN5"),unSN6:t("unSN6"),cp0:t("cp0"),cp2:t("cp2"),hurryButton:t("hurryButton"),viewNewFlowI18N:t("viewNewFlowI18N"),viewMainFlowI18N:t("viewMainFlowI18N")},nodeMenu:[{key:"deleteNodeI18N",index:1,label:t("deleteNodeI18N"),keyCode:46},{key:"replaceNodeI18N",index:2,label:t("replaceNodeI18N")},{key:"copyNodeI18N",index:5,label:t("copyNodeI18N"),keyCode:67},{key:"pasteReplaceI18N",index:5,label:t("pasteReplaceI18N"),keyCode:86},{key:"addBranchI18N",index:6,label:t("addBranchI18N"),keyCode:66},{key:"nodePropI18N",index:7,label:t("nodePropI18N"),keyCode:65},{key:"handBranchI18N",index:8,label:t("handBranchI18N")}],lineMenu:[{key:"autoConditionI18N",index:0,label:t("autoConditionI18N")},{key:"handworkConditionI18N",index:1,label:t("handworkConditionI18N")},{key:"moreOptionI18N",index:3,label:t("moreOptionI18N")},{key:"deleteConditionI18N",index:4,label:t("deleteConditionI18N")}]};if(i.isCIPModel&&"edoc"===i.appName||i.nodeMenu.push({key:"addNodeI18N",index:0,label:t("addNodeI18N"),keyCode:78}),i.isFormTemplate){i.nodeMenu.push({key:"newWorkflowI18N",index:9,label:t("newWorkflowI18N")});var o=t("circleBranchI18N");o&&i.nodeMenu.push({key:"circleBranchI18N",index:10,label:o})}if(i.isTemplete){var r=t("relationdata");r&&"collaboration"===i.appName&&i.nodeMenu.push({key:"relationdata",index:11,label:r})}return i.isCIPModel&&i.nodeMenu.push({key:"advanceEvent",index:12,label:t("advanceEvent")}),i.label.cloneWorkflow=$.i18n("workflow.copy.title.js"),i}function _exePageFunction(e){var t=Array.prototype.slice.call(arguments,1);window[e].apply(window,t)}function _getSvgDesigner(){return window.svgDesigner}function _exeCommandCallback(e,t){_exeCommandMethod(e,t),svgMonitorObj._currentCommond=null}function _exeCommandMethod(e,t){svgMonitorObj._currentCommond&&svgMonitorObj._currentCommond[e].apply(svgMonitorObj._currentCommond,t)}!function(e){var i="wf_dom_index",w=0,g={},r={},o=function(e){this.img=null,this.config=e,this.isError=!1,this.width=0,this.height=0,this._loadImg=function(){var e=this;this.img=new Image,this.img.onerror=function(){e._error(),e=null},this.img.onload=function(){e._load(),e=null},this.img.src=this.config.src,this.img.complete&&this._load()},this._load=function(){this.img&&(this.width=this.img.width,this.height=this.img.height),this._finish()},this._error=function(){this.isError=!0,this._finish()},this._finish=function(){return this._destoryImg(),this.isError?this.config.error&&this.config.error():this.config.load&&this.config.load({width:this.width,height:this.height}),!0},this._destoryImg=function(){this.img=this.img.onload=this.img.onerror=null},this._loadImg()};function a(e,t){for(var i=!1,o=e.split(" "),n=0,r=o.length;n<r;n++){var s=o[n];if(s&&s===t){i=!0;break}}return i}function n(e){for(var t=e.nextSibling;t&&1!==t.nodeType;)t=t.nextSibling;return t&&1===t.nodeType?t:null}var N={};N.DOM_INDEX_KEY=i,N.query=function(e,t,i){var o=i||document;return t?o.querySelectorAll(e):o.querySelector(e)},N.get_nextsibling=n,N.insertAfter=function(e,t){if(e){var i=t.parentNode,o=n(t);o?i.insertBefore(e,o):i.appendChild(e)}},N.offset=function(e){for(var t=e.offsetLeft,i=e.offsetTop,o=e.offsetParent;null!==o;)t+=o.offsetLeft,i+=o.offsetTop,o=o.offsetParent;return[i,t]},N.escapeHTML=function(e){return e?e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/ /g,"&nbsp;"):e},N.escapeXML=function(e){return e?e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e},N.removeElement=function(e){if(e)if(e.remove)e.remove();else{var t=e.parentNode;t&&t.removeChild(e)}},N.lazyLoadImg=function(e,t,i){var m,g,v;m=e,v=i,new o({src:g=t,error:function(){v=g=m=null},load:function(e){var t=[v.width,v.height],i=t[0],o=t[1],n=e.width,r=e.height;if(!0===v.scale&&n&&0<n&&r&&0<r){var s=i/n,a=o/r;a<s?o=r*s:i=n*a}var l=m.nodeName;if("image"===l)m.setAttribute("href",g);else if("use"===l){var d=v.$defs,c=SVGUtil.create("image");SVGUtil.setAttrs(c,{width:i,height:o,"xlink:href":g});var h="rand"+w++,u=SVGUtil.create("pattern");SVGUtil.setAttrs(u,{patternUnits:"objectBoundingBox",width:"1",height:"1",x:"0",y:"0",id:h}),u.appendChild(c),d.appendChild(u);var f=SVGUtil.create("circle"),p=v.width/2;SVGUtil.setAttrs(f,{r:p,cx:p-.5,cy:p-.5,fill:"url(#"+h+")"}),m.parentNode.appendChild(f),!0===v.isCurrentNode&&SVGUtil.setAttrs(f,{"stroke-width":3,stroke:"#F5A623"}),N.removeElement(m)}v=g=m=null}})},N.getTarget=function(e){return e.srcElement&&!e.target&&(e.target=e.srcElement),e.target},N.addClass=function(e,t){var i=e.classList;i?i.contains(t)||i.add(t):a(i=e.getAttribute("class")||"",t)||e.setAttribute("class",i+" "+t)},N.removeClass=function(e,t){var i=e.classList;if(i)i.contains(t)&&i.remove(t);else if(a(i=e.getAttribute("class")||"",t)){for(var o=i.split(" "),n="",r=0,s=o.length;r<s;r++)o[r]&&o[r]!==t&&(n+=" "+o[r]);e.setAttribute("class",n)}},N.hasClass=function(e,t){var i=e.classList;return i?i.contains(t):a(i=e.getAttribute("class")||"",t)},N.randId=function(e){var t="";return(t=e===document?document[i]:SVGUtil.getAttr(e,i))||(t="wf_"+w++,e===document?document[i]=t:SVGUtil.setAttr(e,i,t)),t},N.effectiveValue=function(e,t,i){i=!1!==i;var o=Math.pow(10,t),n=e*o;return(n=i?Math.floor(n):Math.ceil(n))/o},N.registerEvent=function(e,t){var i=r[e];i||(i=[]),i.push(t),r[e]=i},N.cancelEvent=function(e,t){var i=r[e];if(i)for(var o=0,n=i.length;o<n;o++)if(i[o]===t){i.splice(o,1);break}},N.triggerEvent=function(e){var t=r[e];if(t)for(var i=Array.prototype.slice.call(arguments,1),o=0,n=t.length;o<n;o++)t[o].apply(window,i)},N.addEvent=function(t,e,i,o){if(t){var n=function(e){var t=e.type;return"DOMMouseScroll"!==t&&"mousewheel"!==t||(e.delta=e.wheelDelta?e.wheelDelta/120:-(e.detail||0)/3),e.srcElement&&!e.target&&(e.target=e.srcElement),e.preventDefault||void 0===e.returnValue||(e.preventDefault=function(){e.returnValue=!1}),e},r=null;window.addEventListener?("mousewheel"===e&&void 0!==document.mozFullScreen&&(e="DOMMouseScroll"),t.addEventListener(e,r=function(e){i.call(this,n(e))},o||!1)):window.attachEvent&&t.attachEvent("on"+e,r=function(e){e=e||window.event,i.call(t,n(e))});var s=N.randId(t),a=g[s]||{},l=a[e]||{},d=l.agents||[],c=l.srcEvents||[];d.push(r),c.push(i),l.agents=d,l.srcEvents=c,a[e]=l,g[s]=a}},N.removeEvent=function(e,t,i){if(e){for(var o=N.randId(e),n=g[o]||{},r=n[t]||{},s=r.agents||[],a=r.srcEvents||[],l=[],d=0,c=a.length;d<c;d++)i&&i!==a[d]||(l.push(s[d]),s.splice(d,1),a.splice(d,1),d--,c--);if(0!==l.length){if(r.agents=s,r.srcEvents=a,n[t]=r,g[o]=n,0===s.length){delete n[t];var h=0;for(var u in n)if(n.hasOwnProperty(u)){h++;break}0===h&&delete g[o]}for(var f=0,p=l.length;f<p;f++){var m=l[f];window.addEventListener?("mousewheel"===t&&void 0!==document.mozFullScreen&&(t="DOMMouseScroll"),e.removeEventListener(t,m)):window.attachEvent&&e.detachEvent("on"+t,m)}}}},e.ViewUtil=N}(window),function(x){var f=new RegExp("[\\u4E00-\\u9FFF]+"),E='PingFangSC, "Microsoft YaHei", "Lantinghei SC", serif',p=["click","mouseover","mouseleave"],m="#D0021B",C="#999999",T={},oe={},ne=.25,a={icon_size:35,icon_margin_tb:0,icon_margin_lr:33,icon_margin_line_lr:8,icon_synNode_size:15,blank_size:20,line_height:1.5,font_size:12},l={container:"",width:0,height:0,controller:null};function e(e){this.setting=WorkflowUtil.merge(e,l),this.controller=e.controller,this.layoutInfo={mainOffset:[0,0],nodeWidth:0,nodeHeight:0,topOneLineTextOffset:[0,0],topTwoLineTextOffset:[0,0],iconOffset:[0,0],iconSynNodeOffset:[0,0],leftLineOffset:[0,0],rightLineOffset:[0,0],blankOffset:[0,0],bottonTextOffset:[0,0],topCircleLineOffset:[0,0],bottonCircleLineOffset:[0,0],stateOffset:[0,0],zoom:1,minZoom:1,maxZoom:5,svgHeight:0,svgWidth:0,viewHeight:0,viewWidth:0,viewBoxWidht:0,viewBoxHeight:0,nodeCache:{},lineCache:{}},this.viewState={isAddBranchModel:!1,isCircleBranchModel:!1,isCopyNodeModel:!1,currentNumber:"",isShowDynamicMarkPath:!1,blockEvent:!1,enableNodes:null,swimlaneVisible:!1},this.selectNode=null,this.container=e.container,this.$scrollRoot=null,this.$container=null,this.$toolbar=null,this.$bottombar=null,this.$eagleEye=null,this.$background=null,this.$svg=null,this.$defs=null,this.$dynamicMarkPath=null,this.nodeConfig=WorkflowUtil.merge({},a),this._scaleConfig(1);var t=this.$container=ViewUtil.query(this.container),i=this.$scrollRoot=t.parentNode,o=i.parentNode.clientHeight-24,n=ViewUtil.query(".wf_info_bar");if(n){var r=n.offsetHeight;o-=r,i.style.top=r+"px"}i.style.height=o+"px",e.toolbar&&(this.$toolbar=ViewUtil.query(e.toolbar)),e.bottomBar&&(this.$bottombar=ViewUtil.query(e.bottomBar),this.$bottombar&&e.eagleEye&&(this.$eagleEye=ViewUtil.query(e.eagleEye))),this.$svg=SVGUtil.create("svg"),SVGUtil.setAttr(this.$svg,"preserveAspectRatio","xMinYMin meet"),SVGUtil.setAttr(this.$svg,"id","svg-view-"+(new Date).getTime()),this.$defs=SVGUtil.create("defs"),this.$svg.appendChild(this.$defs),this._addDefs(this.$defs),this.menuManager=new x.MenuManager({container:t.parentNode,view:this});var s=this.layoutInfo;0===e.width?(s.viewWidth=i.clientWidth,s.viewHeight=o):(s.viewWidth=e.width,s.viewHeight=e.height,i.parentNode.style.width=s.viewWidth+"px",i.parentNode.style.height=s.viewHeight+"px"),s.mainOffset=ViewUtil.offset(i),this._createBottombar(),this._listener(i),t.appendChild(this.$svg)}var t=e.prototype;t._getVerify=function(e){return this.controller.model.verifyMap[e]||{type:"node",state:"true",r0:"true",r0msg:"",r1:"true",r1msg:"",r2:"true",r2msg:"",r3:"true",r3msg:"",r4:"true",r4msg:"",r5:"true",r5msg:""}},t._createBaseFilter=function(){var e=SVGUtil.create("filter");SVGUtil.setAttrs(e,{id:"icon_node_filter_base",x:"-47.1%",y:"-47.1%",width:"194.1%",height:"194.1%",filterUnits:"objectBoundingBox"});var t=SVGUtil.create("feMorphology");SVGUtil.setAttrs(t,{radius:"1",operator:"dilate",in:"SourceAlpha",result:"shadowSpreadOuter1"});var i=SVGUtil.create("feOffset");SVGUtil.setAttrs(i,{dx:"0",dy:"0",in:"shadowSpreadOuter1",result:"shadowOffsetOuter1"});var o=SVGUtil.create("feGaussianBlur");SVGUtil.setAttrs(o,{stdDeviation:"5",in:"shadowOffsetOuter1",result:"shadowBlurOuter1"});var n=SVGUtil.create("feComposite");return SVGUtil.setAttrs(n,{in:"shadowBlurOuter1",in2:"SourceAlpha",operator:"out",result:"shadowBlurOuter1"}),e.appendChild(t),e.appendChild(i),e.appendChild(o),e.appendChild(n),e},t._addDefs=function(e){if(WorkflowUtil.context.scene===WorkflowConstant.scene.DESIGNER_ADMIN){var t=SVGUtil.create("pattern"),i="back"+(new Date).getTime();SVGUtil.setAttrs(t,{id:i,patternUnits:"userSpaceOnUse",width:"10",height:"10",x:"0",y:"0"});var o=SVGUtil.create("path");SVGUtil.setAttrs(o,{stroke:"#ccc",fill:"none",transform:"scale(0.2)",d:"M26,0 l0,2 m0,2 l0,2 m0,2 l0,2 m0,2 l0,2 m0,2 l0,20 m0,2 l0,2 m0,2 l0,2 m0,2 l0,2 m0,2 M0,26 l2,0 m2,0 l2,0 m2,0 l2,0 m2,0 l2,0 m2,0 l20,0 m2,0 l2,0 m2,0 l2,0 m2,0 l2,0 m2,0"}),t.appendChild(o),e.appendChild(t);var n=SVGUtil.create("rect");SVGUtil.setAttrs(n,{id:"background_ract",fill:"url(#"+i+")",width:"10",height:"10"}),this.$svg.insertBefore(n,e),this.$background=n}var r=this._createBaseFilter();SVGUtil.setAttrs(r,{id:"icon_node_filter_normal"});var s=SVGUtil.create("feColorMatrix");SVGUtil.setAttrs(s,{values:"0 0 0 0 0.294117647   0 0 0 0 0.564705882   0 0 0 0 0.870588235  0 0 0 0.25 0",type:"matrix",in:"shadowBlurOuter1"}),r.appendChild(s),e.appendChild(r);var a=this._createBaseFilter();SVGUtil.setAttrs(a,{id:"icon_node_filter_current"});var l=SVGUtil.create("feColorMatrix");SVGUtil.setAttrs(l,{values:"0 0 0 0 0.960784314   0 0 0 0 0.650980392   0 0 0 0 0.137254902  0 0 0 0.25 0",type:"matrix",in:"shadowBlurOuter1"}),a.appendChild(l),e.appendChild(a);var d=this._createBaseFilter();SVGUtil.setAttrs(d,{id:"icon_node_filter_end"});var c=SVGUtil.create("feColorMatrix");SVGUtil.setAttrs(c,{values:"0 0 0 0 0.717647059   0 0 0 0 0.717647059   0 0 0 0 0.717647059  0 0 0 0.25 0",type:"matrix",in:"shadowBlurOuter1"}),d.appendChild(c),e.appendChild(d);var h=this._createBaseFilter();SVGUtil.setAttrs(h,{id:"icon_node_filter_start"});var u=SVGUtil.create("feColorMatrix");SVGUtil.setAttrs(u,{values:"0 0 0 0 0.384313725   0 0 0 0 0.698039216   0 0 0 0 0  0 0 0 0.25 0",type:"matrix",in:"shadowBlurOuter1"}),h.appendChild(u),e.appendChild(h);var f=SVGUtil.create("circle");SVGUtil.setAttrs(f,{id:"icon_filter_circle",cx:"17",cy:"17",r:"17",fill:"black","fill-opacity":"1"});var p=SVGUtil.create("circle");SVGUtil.setAttrs(p,{id:"icon_back_circle","stroke-width":"1","fill-rule":"evenodd",stroke:"#fff",cx:"17",cy:"17",r:"17.5"});var m=SVGUtil.create("circle");SVGUtil.setAttrs(m,{id:"icon_vj_back_circle","stroke-width":"2",fill:"#fff",cx:"17",cy:"17",r:"15.5"}),e.appendChild(f),e.appendChild(p),e.appendChild(m);var g=SVGUtil.create("circle");SVGUtil.setAttrs(g,{id:"icon_filter_circle_min",cx:"13.5",cy:"13.5",r:"13.5",fill:"black","fill-opacity":"1"});var v=SVGUtil.create("circle");SVGUtil.setAttrs(v,{id:"icon_back_circle_min","stroke-width":"1","fill-rule":"evenodd",stroke:"#fff",cx:"13.5",cy:"13.5",r:"14"});var w=SVGUtil.create("circle");SVGUtil.setAttrs(w,{id:"icon_vj_back_circle_min","stroke-width":"2",fill:"#fff",cx:"17",cy:"17",r:"15.5"}),e.appendChild(g),e.appendChild(v),e.appendChild(w)},t._scaleConfig=function(e){for(var t in this.nodeConfig)this.nodeConfig.hasOwnProperty(t)&&(this.nodeConfig[t]*=e);var i=this.nodeConfig,o=this.layoutInfo;o.nodeWidth=i.icon_size+2*i.icon_margin_lr;var n=i.font_size*i.line_height;this.nodeNameHeight=2*n,o.nodeHeight=i.icon_size+this.nodeNameHeight+i.font_size*i.line_height,o.iconOffset=[i.icon_margin_lr,0];var r=(i.icon_size-i.icon_synNode_size)/2;o.iconSynNodeOffset=[o.iconOffset[0]+r,o.iconOffset[1]+r],o.stateOffset=[o.iconOffset[0]+i.icon_size-16,i.icon_size-20];var s=o.nodeWidth/2;o.topOneLineTextOffset=[s,i.icon_size+2],o.topTwoLineTextOffset=[12,o.topOneLineTextOffset[1]],o.bottonTextOffsetForOneLine=[s,o.topOneLineTextOffset[1]+n],o.bottonTextOffsetForTwoLine=[s,o.topOneLineTextOffset[1]+2*n],o.leftLineOffset=[i.icon_margin_lr-i.icon_margin_line_lr,i.icon_size/2],o.rightLineOffset=[i.icon_margin_lr+i.icon_size+i.icon_margin_line_lr,o.leftLineOffset[1]],o.topCircleLineOffset=[s,o.iconOffset[1]],o.bottonCircleLineOffset=[s,o.iconOffset[1]+i.icon_size],o.blankOffset=[(i.icon_size-i.blank_size)/2+o.iconOffset[0],(i.icon_size-i.blank_size)/2+o.iconOffset[1]]},t.getDefIcon=function(e,t,i,o){var n="icon_"+e+"_"+(o=o||"");if(!0===t&&(n+="_current"),!T[n]){var r=e.split("_"),s=r[0],a=r[1],l=0,d=0,c=!0;if("nodeicon"===s){var h=-1!==e.indexOf("_VJ_"),u=SVGUtil.create("g");if("nodeicon_BlankNode"===e)!0===t&&(e="nodeicon_BlankNode_current");else if("nodeicon_SynNode"!==e){var f="#4B90DE",p="#icon_node_filter_normal";t?(f="#F5A623",p="#icon_node_filter_current"):"nodeicon_end"===e?(f="#B7B7B7",p="#icon_node_filter_end"):"nodeicon_CollapsedNode"===e?f="#DB8B80":"nodeicon_SuperNode"===e?f="#DB8B80":"nodeicon_start"===e?(f="#62B200",p="#icon_node_filter_start"):h&&(f="#48C0FB"),SVGUtil.setAttr(u,"fill",f);var m="";28===o&&(m="_min");var g=SVGUtil.create("use");SVGUtil.setAttrs(g,{"xlink:href":"#icon_filter_circle"+m,filter:p?"url("+p+")":""}),u.appendChild(g);var v=SVGUtil.create("use");if(SVGUtil.setAttr(v,"xlink:href","#icon_back_circle"+m),u.appendChild(v),h){var w=SVGUtil.create("use"),N="#48C0FB";t&&(N="#F5A623"),SVGUtil.setAttrs(w,{"xlink:href":"#icon_vj_back_circle"+m,stroke:N}),u.appendChild(w)}}var A;if(i){A=SVGUtil.getDefIconId("nodeicon_user");var _=new Date,y="";y+=_.getFullYear(),y+=_.getMonth(),y+=_.getDay(),WorkflowUtil.context.webRoot+"/rest/orgMember/avatar/"+i+"?maxWidth=200&_r="+y}else(A=SVGUtil.getDefIconId(e))||(A=SVGUtil.getDefIconId("nodeicon_FormField"),WorkflowUtil.context.iconRoot+"node_custom_"+a+".png?build="+WorkflowApp.buildInfo);var S="#symbol_"+A,b=SVGUtil.create("use"),I="#fff";h?(I="#6EA4D9",t&&(I="#F5A623")):"nodeicon_SynNode"===e&&(I="#B7B7B7",t&&(I="#F5A623")),SVGUtil.setAttrs(b,{"xlink:href":S,fill:I}),u.appendChild(b),SVGUtil.setAttr(u,"id",n),this.$defs.appendChild(u)}else{var C=SVGUtil.getDefIcon(e,t);if(l=SVGUtil.getAttr(C,"width"),d=SVGUtil.getAttr(C,"height"),-1!==(SVGUtil.getAttr(C,"xlink:href")||"").indexOf(".svg"))SVGUtil.setAttr(C,"id",n),this.$defs.appendChild(C);else{c=!1;var k=SVGUtil.create("pattern");SVGUtil.setAttrs(k,{patternUnits:"objectBoundingBox",width:"1",height:"1",x:"0",y:"0",id:n}),k.appendChild(C),this.$defs.appendChild(k)}}T[n]={iconId:n,width:l,height:d,isImg:c}}return T[n]},t._setNotCache=function(){var e=this.layoutInfo.nodeCache;for(var t in e)e.hasOwnProperty(t)&&(e[t].draw=!1);var i=this.layoutInfo.lineCache;for(var o in i)i.hasOwnProperty(o)&&(i[o].draw=!1)},t._removeNode=function(e){delete this.layoutInfo.nodeCache[e];var t=ViewUtil.query("#Node_"+e,!1,this.$svg);if(t){for(var i=ViewUtil.query("#node_icon_rect_"+e,!1,t),o=ViewUtil.randId(i),n=0,r=p.length;n<r;n++){delete oe[o+"_"+p[n]],ViewUtil.removeEvent(i,p[n])}ViewUtil.removeElement(t)}},t._removeLine=function(e){var t=this.layoutInfo,i=t.lineCache[e];delete t.lineCache[e];for(var o=0;o<i.lineSize;o++){var n=ViewUtil.query("#Line_"+e+"_"+o,!1,this.$svg);ViewUtil.removeElement(n)}var r="line_hot_"+e,s=ViewUtil.query("#"+r);if(s){for(var a=ViewUtil.randId(s),l=0,d=p.length;l<d;l++){delete oe[a+"_"+p[l]],ViewUtil.removeEvent(s,p[l])}ViewUtil.removeElement(s)}var c="branch_"+e,h="branch_"+e+"_hot",u=ViewUtil.query("#"+c,!1,this.$svg);if(u){var f=ViewUtil.query("#"+h,!1,this.$svg);f&&(ViewUtil.removeEvent(f,"mouseover"),ViewUtil.removeEvent(f,"mouseleave"),ViewUtil.removeEvent(f,"click"),ViewUtil.removeElement(f)),ViewUtil.removeElement(u)}},t._clearDeleteDom=function(){var e=this.layoutInfo,t=[],i=[];for(var o in e.nodeCache)e.nodeCache.hasOwnProperty(o)&&!1===e.nodeCache[o].draw&&t.push(o);for(var n in e.lineCache)e.lineCache.hasOwnProperty(n)&&!1===e.lineCache[n].draw&&i.push(n);for(var r=0,s=t.length;r<s;r++){var a=t[r];this._removeNode(a)}for(var l=0,d=i.length;l<d;l++){var c=i[l];this._removeLine(c)}},t.setStepBackTargetNodeCallback=function(e){var t=this.selectNode;"success"===e?this.focusNode(t):this.selectNode=null},t.refreshLayout=function(){var e=this.$scrollRoot,t=e.parentNode.clientHeight-24,i=ViewUtil.query(".wf_info_bar");i&&(t-=i.offsetHeight),e.style.height=t+"px";var o=this.layoutInfo;o.viewWidth=e.clientWidth,o.viewHeight=t,this.draw()},t.locationNodeLink=function(e){var t,i=this.controller.model.process.getLine(e);i&&(t=i.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMCircleLink?i.getFromNode():i.getToNode(),this.locationNode(t.getId()))},t.locationNode=function(e){e||(e="start");var t,i,o=this.controller.model.process,n=o.getNode(e);if(n&&n.isCollapsed){var r=WorkflowUtil.context,s=n.collapsedBy,a=o.getNode(s);return r.expandedSplits[a.getId()]="",a.splitDisplay="expanded",a.nextCurrentPathNodeId=null,a.collapseNode=null,a.currentPathSize=0,this.controller.drawOrRefreshView(),t=this,i=e,void setTimeout(function(){t.locationNode(i)},10)}var l="Node_"+e,d=ViewUtil.query("#"+l);if((d||"start"===e)&&n||(d=ViewUtil.query("#Node_start"),n=o.getStartNode()),d){var c=this.layoutInfo,h=this.$scrollRoot,u=c.nodeWidth*c.zoom,f=n.getLayoutX(),p=n.getLayoutY();f*=c.zoom,p*=c.zoom,f-=2*u,f=Math.max(f,0),p-=c.viewHeight/2,p=Math.max(p,0),h.scrollLeft=f,h.scrollTop=p}},t.focusNode=function(e){this._toggleNodeState(e,!0)},t.blurNode=function(e){this._toggleNodeState(e,!1)},t.focusLine=function(e){this._toggleLineState(e,!0)},t.blurLine=function(e){this._toggleLineState(e,!1)},t._toggleNodeState=function(e,t){var i=e.getId(),o=e.getNodeIcon(),n=o.nodeIconCode,r=o.memberId,s=this.getDefIcon(n,t,r).iconId,a=ViewUtil.query("#node_icon_use_"+i,!1,this.$svg);a&&SVGUtil.setAttr(a,"xlink:href","#"+s)},t._toggleLineState=function(e,t){var i=this.layoutInfo,o=e.getId(),n="removeClass";t&&(n="addClass");for(var r="false"===this._getVerify(e.getId()).r0,s=i.lineCache[o],a=0;a<s.lineSize;a++){var l=ViewUtil.query("#Line_"+o+"_"+a,!1,this.$svg);if(t)SVGUtil.getAttr(l,"x1")===SVGUtil.getAttr(l,"x2")&&(ViewUtil.removeElement(l),this.$svg.insertBefore(l,this.$defs));ViewUtil[n](l,"focus"),t?ViewUtil.removeClass(l,"invalid"):r&&ViewUtil.addClass(l,"invalid")}if(e.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMTransition){var d="branch_"+o,c=ViewUtil.query("#"+d,!1,this.$svg);if(c){var h=e.getBranchIcon();r&&!t&&(h+="_red");var u=this.getDefIcon(h,t).iconId;SVGUtil.setAttr(c,"xlink:href","#"+u)}}},t.setEnableNodes=function(e){this.viewState.enableNodes=e},t.initCopyNodeModel=function(e){var t=this.viewState;this.selectNode=e,t.isCopyNodeModel=!0,this._setEditLineForceRedraw(),this.draw()},t.destroyCopyNodeModel=function(){var e=this.viewState;this.selectNode=null,e.isCopyNodeModel=!1,e.currentNumber="",this._setEditLineForceRedraw(),this.draw()},t._setEditLineForceRedraw=function(){var e=this.layoutInfo.lineCache,t=this.controller.model.process;for(var i in e){if(e.hasOwnProperty(i))if(!0===e[i].isEditLine)t.getLine(i).setForceRedraw(!0)}},t._isCommandState=function(){var e=this.viewState;return e.isAddBranchModel||e.isCircleBranchModel||e.isCopyNodeModel},t.initAddBranchModel=function(e,t){var i=this.$dynamicMarkPath=SVGUtil.create("path"),o=this.viewState;SVGUtil.setAttrs(i,{stroke:"#D0021B","stroke-width":"2",fill:"none","stroke-dasharray":"5 5"}),this.selectNode=e,this.setEnableNodes(t),o.isAddBranchModel=!0,this._setEditLineForceRedraw(),this.draw()},t.destroyAddBranchModel=function(e){var t=this.viewState;t.isAddBranchModel&&(t.isShowDynamicMarkPath&&ViewUtil.removeElement(this.$dynamicMarkPath),t.isShowDynamicMarkPath=!1,this.$dynamicMarkPath=null,this.selectNode=null,this.setEnableNodes(null),t.isAddBranchModel=!1,this._setEditLineForceRedraw(),!1!==e&&this.draw())},t.initCircleBranchModel=function(e,t){var i=this.$dynamicMarkPath=SVGUtil.create("path"),o=this.viewState;SVGUtil.setAttrs(i,{stroke:"#D0021B","stroke-width":"2",fill:"none","stroke-dasharray":"5 5"}),this.selectNode=e,this.setEnableNodes(t),o.isCircleBranchModel=!0,this._setEditLineForceRedraw(),this.draw()},t.destroyCircleBranchModel=function(e){var t=this.viewState;t.isCircleBranchModel&&(t.isShowDynamicMarkPath&&ViewUtil.removeElement(this.$dynamicMarkPath),t.isShowDynamicMarkPath=!1,this.$dynamicMarkPath=null,this.selectNode=null,this.setEnableNodes(null),t.isCircleBranchModel=!1,this._setEditLineForceRedraw(),!1!==e&&this.draw())},t.draw=function(){var e=(new Date).getTime();this._setNotCache();var t=this.controller.model.process,i=this.layoutInfo,o=t.getMaxX(),n=t.getMaxY(),r=(o+ne+.25+1)*i.nodeWidth,s=(n+1.6+.5+1)*i.nodeHeight;t.setMaxLayoutX(r),t.setMaxLayoutY(s),i.viewBoxWidht=Math.max(r,i.viewWidth),i.viewBoxHeight=Math.max(s,i.viewHeight),i.svgWidth=Math.ceil(i.viewBoxWidht*i.zoom),i.svgHeight=Math.ceil(i.viewBoxHeight*i.zoom),i.minZoom=Math.min(ViewUtil.effectiveValue(i.viewWidth/i.viewBoxWidht,2,!0),ViewUtil.effectiveValue(i.viewHeight/i.viewBoxHeight,2,!0));var a,l,d,c={};a=i.svgWidth+"px",l=i.svgHeight+"px",d="0,0,"+i.viewBoxWidht+","+i.viewBoxHeight,c.width=a,c.height=l,""!==d&&(c.viewBox=d),this.$container.style.width=a,this.$container.style.height=l,SVGUtil.setAttrs(this.$svg,c),this.$background&&SVGUtil.setAttrs(this.$background,{width:i.viewBoxWidht,height:i.viewBoxHeight});var h={};this._iterationDrawNode(t.getStartNode(),h),h=null;var u=t.getCircleLinks();if(u&&0<u.length)for(var f=0,p=u.length;f<p;f++){var m=u[f];this._drawCircleLine(m.getFromNode(),m.getToNode(),m)}this.viewState.swimlaneVisible&&this._refreshSwimlane(),this._clearDeleteDom(),this._setEagleEyeSVG();var g=(new Date).getTime();console.log("画图耗时: "+(g-e)+" ms")},t._setEagleEyeSVG=function(){if(this.$eagleEye){var e=this.layoutInfo,t=ViewUtil.query("svg",!1,this.$eagleEye),i=e.svgWidth/e.svgHeight,o=0,n=0,r=157,s=130;157/130<i?o=(130-(s=r/i))/2:n=(157-(r=s*i))/2,SVGUtil.setAttrs(t,{width:r,height:s,viewBox:"0,0,"+e.svgWidth+","+e.svgHeight});var a=t.style;a.top=o+"px",a.left=n+"px",a.width=r+"px",a.height=s+"px",a.backgroundColor="#fff";var l=ViewUtil.query("#eagle_eye_box",!1,this.$eagleEye);SVGUtil.setAttrs(l,{minTop:o,minLeft:n}),this._setEagleEyeWinOffset();var d=this.$bottombar,c=ViewUtil.query("#eagle_eye_switcher",!1,d);if(!c.getAttribute("show")){var h=this.$eagleEye,u=this.layoutInfo,f=u.viewWidth<1024||u.viewHeight<768;1===u.minZoom||f?(ViewUtil.removeClass(c,"on"),h.style.display="none"):(h.style.display="",ViewUtil.addClass(c,"on"))}}},t._setEagleEyeWinOffset=function(){var e=this.$eagleEye,t=ViewUtil.query("#eagle_eye_box",!1,e),i=ViewUtil.query("svg",!1,e),o=this.$scrollRoot,n=this.layoutInfo,r=[parseInt(i.style.width),parseInt(i.style.height)],s=r[0],a=r[1],l=parseInt(SVGUtil.getAttr(t,"minTop")),d=parseInt(SVGUtil.getAttr(t,"minLeft")),c=0,h=0,u=l,f=d;n.viewWidth>n.svgWidth?c=s:(c=s*(n.viewWidth/n.svgWidth),f+=o.scrollLeft*(c/n.viewWidth));n.viewHeight>n.svgHeight?h=a:(h=a*(n.viewHeight/n.svgHeight),u+=o.scrollTop*(h/n.viewHeight));c-=2,h-=2,SVGUtil.setAttrs(t,{maxTop:l+a-h,maxLeft:d+s-c});var p=t.style;p.width=c+"px",p.height=h+"px",p.top=u+"px",p.left=f+"px"},t.setBlockEvent=function(e){this.viewState.blockEvent=e},t._listener=function(e){var n=this;ViewUtil.addEvent(e,"mousewheel",function(e){var t=!1;if(e.wheelDelta&&e.ctrlKey?t=!0:e.detail&&e.ctrlKey&&(t=!0),t){if(n.viewState.blockEvent)return;e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation(),e.delta<0?n.scale(-.2):0<e.delta&&n.scale(.2)}}),ViewUtil.addEvent(e,"mousedown",function(e){if(!n.viewState.blockEvent){var t=e||event;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0;var i,o,l=t.clientX,d=t.clientY,c=this;ViewUtil.addEvent(c,"mousemove",i=function(e){var t=e||event;t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation();var i=t.clientX,o=t.clientY,n=i-l,r=o-d;l=i,d=o;var s=c.scrollTop-r,a=c.scrollLeft-n;c.scrollTop=s,c.scrollLeft=a}),ViewUtil.addEvent(c,"mouseup",o=function(){ViewUtil.removeEvent(c,"mousemove",i),ViewUtil.removeEvent(c,"mouseup",o),ViewUtil.removeEvent(c,"mouseout",o),c=o=i=null}),ViewUtil.addEvent(c,"mouseout",o)}}),ViewUtil.addEvent(e,"click",function(e){ViewUtil.triggerEvent("clickMainContainerEvent")}),this.$eagleEye&&ViewUtil.addEvent(e,"scroll",function(e){n._setEagleEyeWinOffset()})},t._createBottombar=function(){var w=this,e=this.$bottombar;if(e){var t=ViewUtil.query("#zoom_switcher",!1,e);ViewUtil.addEvent(t,"click",function(e){e.stopPropagation();"1"===this.getAttribute("min")?(this.setAttribute("min","0"),ViewUtil.removeClass(this,"sy-show-normal"),ViewUtil.addClass(this,"sy-show-all"),w.scale(1,!0)):(this.setAttribute("min","1"),ViewUtil.removeClass(this,"sy-show-all"),ViewUtil.addClass(this,"sy-show-normal"),w.scale(0,!0)),w.menuManager.hideFloatBox()});var i=ViewUtil.query("#zoom_in",!1,e);ViewUtil.addEvent(i,"click",function(e){e.stopPropagation(),w.scale(.2)});var o=ViewUtil.query("#zoom_out",!1,e);ViewUtil.addEvent(o,"click",function(e){e.stopPropagation(),w.scale(-.2)});var n=this.$eagleEye;if(n){var r=ViewUtil.query("#eagle_eye_switcher",!1,e);ViewUtil.addEvent(r,"click",function(e){e.stopPropagation();var t=w.$eagleEye;ViewUtil.hasClass(this,"on")?(this.setAttribute("show","1"),ViewUtil.removeClass(this,"on"),t.style.display="none"):(this.setAttribute("show","0"),t.style.display="",ViewUtil.addClass(this,"on"))});var s=SVGUtil.create("svg");ViewUtil.addClass(s,"wf_eagle_eye_svg");var a=SVGUtil.create("use");SVGUtil.setAttr(a,"xlink:href","#"+this.$svg.getAttribute("id")),s.appendChild(a),n.appendChild(s);var l=ViewUtil.query("#eagle_eye_layer",!1,n);ViewUtil.addEvent(l,"mousedown",function(e){var t=e||window.event;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0;var i,o,n,r=this;(n=function(e){var t=e.offsetY,i=e.offsetX;if(0===i||i||(i=e.originalEvent.mouseX),0===t||t||(t=e.originalEvent.mouseY),0===i||i){var o,n,r=ViewUtil.query("#eagle_eye_box",!1,w.$eagleEye),s=w.$scrollRoot,a=w.layoutInfo,l=parseInt(r.style.width)+2,d=parseInt(r.style.height)+2,c=[parseInt(SVGUtil.getAttr(r,"minTop")),parseInt(SVGUtil.getAttr(r,"minLeft"))],h=c[0],u=c[1],f=[parseInt(SVGUtil.getAttr(r,"maxTop")),parseInt(SVGUtil.getAttr(r,"maxLeft"))],p=f[0],m=f[1],g=i-l/2,v=t-d/2;g=Math.max(u,g),g=Math.min(m,g),v=Math.max(h,v),v=Math.min(p,v),o=Math.floor((g-u)/(l/a.viewWidth)),n=Math.floor((v-h)/(d/a.viewHeight)),s.scrollLeft=o,s.scrollTop=n}})(t),ViewUtil.addEvent(r,"mousemove",i=function(e){var t=e||event;t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation(),n(t)}),ViewUtil.addEvent(r,"mouseup",o=function(){ViewUtil.removeEvent(r,"mousemove",i),ViewUtil.removeEvent(r,"mouseup",o),ViewUtil.removeEvent(r,"mouseout",o),r=n=o=i=null}),ViewUtil.addEvent(r,"mouseout",o)})}}},t.createToolbar=function(){var e=this.$toolbar,o=this.controller.model.process;if(e){var t=!1,i=ViewUtil.query(".wf_info_bar");i&&(ViewUtil.addClass(e,"hasInfobar"),i=null);var n=WorkflowUtil.context;if("true"===window.canCopyFlow&&window.showWFTemplateList4Clone&&(t&&this._createToolbarBtn(e,"","split"),t=!0,this._createToolbarBtn(e,n.label.cloneWorkflow,"textbtn",function(){window.showWFTemplateList4Clone()})),(n.scene===WorkflowConstant.scene.DESIGNER_ADMIN||!o.isEmptySwimlane())&&n.hasWorkflowAdvanced){t&&this._createToolbarBtn(e,"","split"),t=!0;var r=this.viewState.swimlaneVisible=o.hasSwimlane()&&"true"===o.getAttr("showSwimlane"),s=this;this._createToolbarBtn(e,n.label.swimlaneName,"switch",function(e){var t=s.viewState;if(e){var i=s.controller.model.process;i.hasSwimlane()||i.initSwimlane()}else s._removeSwimlaneDom();t.swimlaneVisible=e,o.setAttr("showSwimlane",e+""),s.controller.drawOrRefreshView()},{isActive:r})}n.scene===WorkflowConstant.scene.DESIGNER_ADMIN&&(window.openEventAdvancedSetting&&(t&&this._createToolbarBtn(e,"","split"),t=!0,this._createToolbarBtn(e,"开发高级","textbtn",function(){window.openEventAdvancedSetting()})),t&&this._createToolbarBtn(e,"","split"),t=!0,this._createToolbarBtn(e,"","sy-download",function(){window.exportWorkflowDiagramFunc()})),t||(e.style.display="none")}},t._createToolbarBtn=function(e,t,i,o,n){var r=document.createElement("div");if(ViewUtil.addClass(r,"wf_tool_btn"),ViewUtil.addClass(r,i),"switch"===i){var s=document.createElement("div");s.style.display="inline-block",s.style.height="26px",s.style.marginRight="10px",s.style.verticalAlign="middle",s.innerText=t,r.appendChild(s);var a=document.createElement("div");a.style.verticalAlign="middle",ViewUtil.addClass(a,"wf_switch"),n&&n.isActive&&ViewUtil.addClass(a,"active");var l=document.createElement("div");ViewUtil.addClass(l,"wf_switch-handle"),a.appendChild(l),o&&ViewUtil.addEvent(a,"click",function(){var e=ViewUtil.hasClass(this,"active"),t="addClass";e&&(t="removeClass"),ViewUtil[t](this,"active"),o(e=!e)}),r.appendChild(a)}else"sy-search"===i||"sy-download"===i||"sy-predict-process"===i?(ViewUtil.addClass(r,"syIcon"),ViewUtil.addClass(r,i),"sy-search"===i&&(r.style.width="16px")):t&&(r.innerText=t),o&&ViewUtil.addEvent(r,"click",o);e.appendChild(r)},t.scale=function(e,t){var i,p=this.layoutInfo;if(!0===t){if((i=Math.abs(e))>p.maxZoom&&(i=p.maxZoom),i<p.minZoom&&(i=p.minZoom),p.zoom===i)return}else{if(0<e){if(p.zoom>=p.maxZoom)return}else if(p.zoom<=p.minZoom)return;var o=Math.abs(e),n=0<e?1:-1,r=p.svgWidth*o/p.viewBoxWidht*n;(i=ViewUtil.effectiveValue(p.zoom+r,2,!0))===p.zoom&&(i+=.02)}if(i<p.minZoom)this.scale(p.minZoom,!0);else if(i>p.maxZoom)this.scale(p.maxZoom,!0);else{this.$container.style.width=Math.ceil(p.viewBoxWidht*i)+"px",this.$container.style.height=Math.ceil(p.viewBoxHeight*i)+"px",this.$background&&SVGUtil.setAttrs(this.$background,{width:p.viewBoxWidht,height:p.viewBoxHeight}),"undefined"!=typeof animatedZoom&&window.cancelAnimationFrame&&window.cancelAnimationFrame(animatedZoom);var s=this.$bottombar;if(this.$bottombar){var a=ViewUtil.effectiveValue(100*i,0);ViewUtil.query("#zoom_value",!1,s).innerText=a+"%";var l=ViewUtil.query("#zoom_switcher",!1,s);100!==a?(l.setAttribute("min","1"),ViewUtil.removeClass(l,"sy-show-all"),ViewUtil.addClass(l,"sy-show-normal")):(l.setAttribute("min","0"),ViewUtil.removeClass(l,"sy-show-normal"),ViewUtil.addClass(l,"sy-show-all")),90<a&&(a=90),ViewUtil.query(".slider",!1,s).style.left=a+"px"}var m=Date.now(),g=i-p.zoom,v=p.zoom,w=this;!function e(){var t=(Date.now()-m)/300;t=Math.pow(t-1,3)+1,(!window.requestAnimationFrame||1<t)&&(t=1);var i,o,n,r,s,a;s=(r=w.$scrollRoot).scrollLeft,a=r.scrollTop,n=v+g*t;var l=s+Math.min(p.viewWidth,p.svgWidth)/2,d=a+Math.min(p.viewHeight,p.svgHeight)/2,c=p.svgWidth/l,h=p.svgHeight/d;i=Math.ceil(p.viewBoxWidht*n),o=Math.ceil(p.viewBoxHeight*n);var u=(i-p.svgWidth)/c,f=(o-p.svgHeight)/h;SVGUtil.setAttrs(w.$svg,{width:i,height:o}),r.scrollTop=a+f,r.scrollLeft=s+u,p.svgWidth=i,p.svgHeight=o,p.zoom=n,t<1&&-.9<t?window.animatedZoom=requestAnimationFrame(e):w._setEagleEyeSVG()}()}},t._resolveName=function(e){var t=[];if(e.length<=6)return t.push(e),t;for(var i=0,o=0,n=!1,r=0,s=new RegExp("[a-zA-Z0-9.]+"),a=0,l=e.length;a<l;a++){var d=e.charAt(a);if(f.test(d)?i+=2:i+=1,n=s.test(d)?(n||(r=a),!0):(o=a,!1),12<=i){n&&(o=r-1);break}l===a+1&&(o=a)}var c=o+1,h=e.substring(0,c);if(t.push(h),c<e.length){var u=WorkflowUtil.subText(e.slice(c),10);t.push(u)}return t},t._drawNodeName=function(e,t){var i=1;if(!t.isEnd()){var o=t.getName();if(o){var n=t.getPartyType();if("Account"!==n&&"Role"!==n&&"Node"!==n){var r=t.getAccountShortName();r&&(o=o+"("+r+")")}var s=this._resolveName(o),a=SVGUtil.create("text"),l=this.layoutInfo,d="#000",c=this._getVerify(t.getId());if(t.isStart()?"false"===c.r0||"false"===c.r1||"false"===c.r3||"false"===c.r4||"false"===c.r5?d=m:t.isValid()||(d=C):"true"===c.r0?t.isValid()||(d=C):d=m,SVGUtil.setAttrs(a,{"font-family":E,"font-size":this.nodeConfig.font_size+1+"px",fill:d}),1<s.length){i=2,SVGUtil.setAttrs(a,{x:l.topTwoLineTextOffset[0],y:l.topTwoLineTextOffset[1]});var h=SVGUtil.create("tspan");h.appendChild(SVGUtil.newText(s[0])),SVGUtil.setAttrs(h,{dy:this.nodeConfig.font_size});var u=SVGUtil.create("tspan");u.appendChild(SVGUtil.newText(s[1])),SVGUtil.setAttrs(u,{x:l.topTwoLineTextOffset[0],dy:this.nodeConfig.font_size*this.nodeConfig.line_height}),a.appendChild(h),a.appendChild(u)}else SVGUtil.setAttrs(a,{x:l.topOneLineTextOffset[0],y:l.topOneLineTextOffset[1]+this.nodeConfig.font_size}),a.style.cssText="text-anchor: middle;",a.appendChild(SVGUtil.newText(s[0]));var f=SVGUtil.create("title");f.appendChild(SVGUtil.newText(o)),a.appendChild(f),e.appendChild(a)}}return i},t._drawPolicyName=function(e,t,i){if(!t.isStart()&&!t.isEnd()){var o=t.getPolicyName();if(o&&(o="["+(o=WorkflowUtil.subText(o,10))+"]"),o){var n=this.layoutInfo.bottonTextOffsetForOneLine;1<i&&(n=this.layoutInfo.bottonTextOffsetForTwoLine);var r=SVGUtil.create("text");r.appendChild(SVGUtil.newText(o));var s="#666";if(t.isValid()){var a=this._getVerify(t.getId());"false"!==a.r1&&"false"!==a.r3&&"false"!==a.r4&&"false"!==a.r5||(s=m)}else s=C;SVGUtil.setAttrs(r,{fill:s,"font-family":E,"font-size":this.nodeConfig.font_size+"px",x:n[0],y:n[1]+this.nodeConfig.font_size}),r.style.cssText="text-anchor:middle;";var l=SVGUtil.create("title");l.appendChild(SVGUtil.newText(t.getPolicyName())),r.appendChild(l),e.appendChild(r)}}},t._drawNodeIcon=function(e,t){var i=WorkflowUtil.context,o=this.nodeConfig,n=i.currentNodeId===t.getId();this.viewState.isCopyNodeModel&&this.selectNode.getId()===t.getId()&&(n=!0);var r,s=[],a=[],l=0;if(t.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMCollapsedNode){s=t.iconNodes,l=28,r=[];var d=(o.icon_size-l)/2;r[0]=this.layoutInfo.iconOffset[0]+d,r[1]=this.layoutInfo.iconOffset[1]+d}else s.push(t),l=o.icon_size,r=this.layoutInfo.iconOffset;for(var c=l+10*(s.length-1),h=l,u=r[0]-(c-l)/2,f=r[1],p=0;p<s.length;p++){var m=s[p],g=m.getNodeIcon(),v=g.nodeIconCode,w=g.memberId,N=this.getDefIcon(v,n,w,l).iconId,A=SVGUtil.create("use"),_=void 0;m.isSplit()||m.isJoin()?(_=this.layoutInfo.iconSynNodeOffset[0],f=this.layoutInfo.iconSynNodeOffset[1],u=_,h=c=15):_=u+10*p,SVGUtil.setAttrs(A,{"xlink:href":"#"+N,x:_,y:f,id:"node_icon_use_"+m.getId()}),a.push(A)}var y="transparent",S="";t.isValid()||(y=C,S="filter:alpha(opacity=60);-moz-opacity:0.6;-khtml-opacity: 0.6;opacity: 0.6;");var b=SVGUtil.create("rect");SVGUtil.setAttrs(b,{x:u-1.5,y:f-1.5,rx:c/2+1,ry:h/2+1,class:t.isEnd()?"":"event_ract",width:c+2,height:h+2,id:"node_icon_rect_"+t.getId(),fill:y,style:S});for(var I=0;I<a.length;I++)e.appendChild(a[I]);return b},t._getNodeState=function(e){return e.getNodeState(this.controller.model.caseItemLog)},t._drawNodeState=function(e,t,i){if(!t.isSplit()&&!t.isJoin()){var o,n=WorkflowConstant.nodeState,r=WorkflowUtil.context;if(t.isStart())"3"===r.processState&&(o="stepbackto");else{var s=this._getNodeState(t),a=s.state,l=s.nodeState,d=s.isReadState;switch(a){case n.STATE_NORMAL:break;case n.STATE_READY:o="true"===r.isShowReadState&&d?(l===n.STATE_NEEDREDO_TOME&&(o="steppedNodeReadFlag"),l===n.STATE_SUSPENDED?"steppedNodeFlag":"read"):l===n.STATE_NEEDREDO_TOME?"steppedNodeFlag":l===n.STATE_SUSPENDED?"stepNodeFlag":"unread";break;case n.STATE_FINISHED:case n.STATE_PAUSEED:o="monitor-finish";break;case n.STATE_AUTO_SKIP:o="monitor-autoskip";break;case n.STATE_ZCDB:o=l===n.STATE_NEEDREDO_TOME?"steppedNodeZcdbFlag":l===n.STATE_SUSPENDED?"stepNodeFlag":"temporary";break;case n.STATE_INFORM:o=l===n.STATE_NEEDREDO_TOME?"steppedNodeFlag":l===n.STATE_SUSPENDED?"stepNodeFlag":"unread";break;case n.STATE_STOP:case n.STATE_STOP_24:o="monitor-stop";break;case n.STATE_STOP_PASSIVITY:o="monitor-stoped";break;case n.STATE_RUN:case n.STATE_stopback:o="";break;case n.STATE_NEEDREDO_TOME:o=d?"steppedNodeReadFlag":"steppedNodeFlag";break;case n.STATE_SUSPENDED:o="stepNodeFlag";break;default:o=""}}if(o){var c=this.layoutInfo,h=this.nodeConfig;o="nodestate_"+o;var u,f,p=this.getDefIcon(o),m=p.iconId,g=p.width,v=p.height;if(t.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMCollapsedNode){g*=.8,v*=.8;var w=[],N=(h.icon_size-28)/2;w[0]=this.layoutInfo.iconOffset[0]+N,w[1]=this.layoutInfo.iconOffset[1]+N;var A=28+10*(t.iconNodes.length-1);u=w[0]-(A-28)/2+A-g,f=w[1]+28-v}else u=c.iconOffset[0]+h.icon_size-g+4,f=c.iconOffset[1]+h.icon_size-v;var _=SVGUtil.create("use");if(SVGUtil.setAttrs(_,{"xlink:href":"#"+m,x:u,y:f}),e.appendChild(_),i){var y=this._getFilterRect({width:16,height:16,x:u,y:f,color:i,circle:!0});e.appendChild(y)}}}},t._getFilterRect=function(e){var t=e.width,i=e.height,o=e.x,n=e.y,r=e.color,s=e.circle,a=SVGUtil.create("rect"),l={x:o,y:n,width:t,height:i,fill:r,style:"filter:alpha(opacity=60);-moz-opacity:0.6;-khtml-opacity: 0.6;opacity: 0.6;"};return s&&(l.rx=l.ry=t/2),SVGUtil.setAttrs(a,l),a},t._drawCompetition=function(e,t){if(t.isCompetitionModel()){var i=this.getDefIcon("other_Competition"),o=i.iconId,n=i.width,r=this.layoutInfo,s=this.nodeConfig,a=SVGUtil.create("use");SVGUtil.setAttrs(a,{"xlink:href":"#"+o,x:r.iconOffset[0]+s.icon_size-n,y:r.iconOffset[1]-2}),e.appendChild(a)}},t._drawAdvanceEvent=function(e,t){if(t.hasAdvanceEvent()){var i=this.getDefIcon("other_advanceEvent"),o=i.iconId,n=i.height,r=this.layoutInfo,s=this.nodeConfig,a=SVGUtil.create("use");SVGUtil.setAttrs(a,{"xlink:href":"#"+o,x:r.iconOffset[0]-4,y:r.iconOffset[1]+s.icon_size-n}),e.appendChild(a)}},t._drawSubProcess=function(e,t){if(t.hasSubProcess()&&!t.isStart()){var i="other_Newflow";"false"===this._getVerify(t.getId()).r2&&(i="other_Newflow_red"),t.getState()===WorkflowConstant.nodeState.STATE_PAUSEED&&(i="other_Newflow_99");var o,n,r=this.getDefIcon(i),s=r.iconId,a=r.width,l=r.height,d=this.layoutInfo,c=this.nodeConfig,h=SVGUtil.create("use");n=d.iconOffset[1]+c.icon_size-l,o=t.hasAdvanceEvent()?d.iconOffset[0]-4-a:d.iconOffset[0]-9,SVGUtil.setAttrs(h,{"xlink:href":"#"+s,x:o,y:n}),e.appendChild(h)}},t._drawHurryButton=function(e,t){if(t.isStart()||t.isEnd()||t.isSplit()||t.isJoin()||t.isBlank())return!1;var f=WorkflowUtil.context,i=this.layoutInfo,o=this.nodeConfig;if("2"!==t.getState()&&"7"!==t.getState()&&"41"!==t.getState()&&("61"!==t.getState()||"user"===t.getPartyType())||"true"!==f.showHastenButton)return!1;var n=SVGUtil.create("g"),r=i.iconOffset[0]+o.icon_size+5,s=i.iconOffset[1]+o.icon_size-15;SVGUtil.setAttrs(n,{id:"hurry_"+t.getId(),nodeId:t.getId(),transform:"matrix(1,0,0,1,"+r+","+s+")",fill:"#fff"});var a=f.label.hurryButton,l=SVGUtil.create("rect");SVGUtil.setAttrs(l,{width:3<a.length?45:30,height:15,stroke:"#000","stroke-width":"0.5",rx:5});var d=SVGUtil.create("text");return SVGUtil.setAttrs(d,{"font-family":E,"font-size":"11px",fill:"#000",y:11,x:5}),d.appendChild(SVGUtil.newText(a)),n.appendChild(l),n.appendChild(d),e.appendChild(n),n.style.cursor="pointer",n.viewObject=this,ViewUtil.addEvent(n,"click",function(e){(e=e||window.event).stopPropagation();for(var t=this.viewObject,i=SVGUtil.getAttr(this,"nodeId"),o=t.controller.model.process,n=o.getNode(i),r=t.controller.model.caseItemLog.getWorkItems(i),s=[],a=0,l=r.length;a<l;a++){var d=r[a],c=d.getItemAction(),h=d.getAttr("performer");"0"!==c&&"23"!==c||s.push(h)}var u=[];u.push(n.getId()),u.push(o.getAttr("id")),u.push(s.join("@")),f.scene===WorkflowConstant.scene.RUNNING_MANAGERCONTROL||f.scene===WorkflowConstant.scene.RUNNING_SUPERVISION?_exePageFunction("edocSupervise",u):_exePageFunction("hurry",u)}),!0},t._setCopyNumber=function(e,t){var i=t.getAttr("copyNumber");if(!i){var o=this.viewState;if(o.isCopyNodeModel&&this.selectNode.getId()===t.getId()){for(var n=this.controller.model.process.getAttr("usedNumberStr"),r=n?n.split(","):[],s={},a=0,l=r.length;a<l;a++){var d=r[a];s[d]=d}for(var c=1;c<=99;c++){var h=c+"";if(!s.hasOwnProperty(h)){o.currentNumber=i=h;break}}}}if(i){1===i.length&&(i="0"+i),i=(t.getAttr("copyFrom")?"P":"C")+i;var u=this.layoutInfo,f=this.nodeConfig,p=SVGUtil.create("text");SVGUtil.setAttrs(p,{"font-family":E,"font-size":f.font_size+1+"px",x:u.iconOffset[0]+f.icon_size-3,y:10,fill:"#000"}),p.appendChild(SVGUtil.newText(i)),e.appendChild(p)}},t._drawViewFlowButton=function(e,t){var i=WorkflowUtil.context,o=this.layoutInfo,n=this.nodeConfig;if(i.showMode===WorkflowConstant.showMode.read_only&&t.hasSubProcess()&&-1<i.newflowNodeIdsStr.indexOf(","+t.getId()+",")){var r="main",s=i.label.viewNewFlowI18N,a=45,l=o.iconOffset[0]+n.icon_size+5,d=o.iconOffset[1]+n.icon_size-15;t.isStart()&&(r="child",s=i.label.viewMainFlowI18N,a=62);var c=SVGUtil.create("g");SVGUtil.setAttrs(c,{id:"ViewFlowBtn_"+t.getId(),nodeId:t.getId(),subType:r,transform:"matrix(1,0,0,1,"+l+","+d+")",fill:"#fff"});var h=SVGUtil.create("rect");SVGUtil.setAttrs(h,{width:a,height:15,stroke:"#000","stroke-width":"0.5",rx:5});var u=SVGUtil.create("text");SVGUtil.setAttrs(u,{"font-family":E,"font-size":"11px",fill:"#000",y:11,x:5}),u.appendChild(SVGUtil.newText(s)),c.appendChild(h),c.appendChild(u),e.appendChild(c),ViewUtil.addEvent(c,"click",function(e){(e=e||window.event).stopPropagation();var t=SVGUtil.getAttr(this,"nodeId"),i=SVGUtil.getAttr(this,"subType"),o=[];o.push(i),o.push(t),_exePageFunction("viewRelateFlow",o)})}},t._drawNode=function(e){var t,i,o=WorkflowUtil.context,n=this.layoutInfo,r=!1,s=!1,a=this.viewState.enableNodes,l="removeClass",d="";if(WorkflowUtil.isEmptyObject(a)||a[e.getId()]||(l="addClass",d="#fff"),!e.isSkip()){r=!0;var c=(e.getX()+ne)*n.nodeWidth,h=(e.getY()+1.6)*n.nodeHeight;e.setLayoutX(c),e.setLayoutY(h);var u=n.nodeCache[e.getId()],f="Node_"+e.getId();if(u?(t=ViewUtil.query("#"+f,!1,this.$svg),s=!0):u={},u.x=e.getX(),u.y=e.getY(),u.draw=!0,e.isJoin()||e.isSplit()){var p=!1;o.showMode===WorkflowConstant.showMode.editable&&(e.isSplit()?o.isTemplete&&(p=!0):p=!0),p&&(n.nodeCache[e.getId()]=u,t||(t=SVGUtil.create("g"),SVGUtil.setAttr(t,"id",f),SVGUtil.setAttr(t,"node_id",e.getId()),ViewUtil.addClass(t,"wf_node"),i=this._drawNodeIcon(t,e),t.appendChild(i),ViewUtil.insertAfter(t,this.$defs)),SVGUtil.setAttr(t,"transform","matrix(1,0,0,1,"+c+","+h+")"))}else{if(n.nodeCache[e.getId()]=u,!t){t=SVGUtil.create("g"),SVGUtil.setAttr(t,"id",f),SVGUtil.setAttr(t,"node_id",e.getId()),ViewUtil.addClass(t,"wf_node"),e.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMCollapsedNode&&(SVGUtil.setAttr(t,"collapsed","true"),SVGUtil.setAttr(t,"collapsedBy",e.splitNode.getId())),i=this._drawNodeIcon(t,e),t.appendChild(i);var m=this._drawNodeName(t,e);e.isBlank()||this._drawPolicyName(t,e,m),e.isValid()||(d=C),e.isEnd()||this._drawNodeState(t,e,d),this._drawCompetition(t,e),this._drawAdvanceEvent(t,e),this._drawSubProcess(t,e);var g=this._drawHurryButton(t,e);this._drawViewFlowButton(t,e,g),this._setCopyNumber(t,e),ViewUtil.insertAfter(t,this.$defs)}SVGUtil.setAttr(t,"transform","matrix(1,0,0,1,"+c+","+h+")")}}if(t){var v=ViewUtil.query("#node_icon_rect_"+e.getId(),!1,t);v&&ViewUtil[l](v,"disabled");var w=ViewUtil.query("text",!0,t);if(w&&0<w.length)for(var N=0,A=w.length;N<A;N++)ViewUtil[l](w[N],"disabled")}if(t&&!e.isEnd()&&!s){var _=ViewUtil.randId(t)+"_click";oe[_]=function(e){if((e||window.event).stopPropagation(),!ViewUtil.hasClass(this,"disabled")){var t=this.parentNode,i=t.viewObject,o=SVGUtil.getAttr(t,"node_id"),n=i.controller.model.process,r=WorkflowUtil.context;if("true"===SVGUtil.getAttr(t,"collapsed")){var s=SVGUtil.getAttr(t,"collapsedBy"),a=n.getNode(s);return r.expandedSplits[a.getId()]="",a.splitDisplay="expanded",a.nextCurrentPathNodeId=null,a.collapseNode=null,a.currentPathSize=0,void i.controller.drawOrRefreshView()}var l=n.getNode(o);if(r.showMode!==WorkflowConstant.showMode.editable)if(r.scene!==WorkflowConstant.scene.RUNNING_STEPBACKTOTARGETNODE_PAGE)new x.SettingPropCommand(i,l,!0).run();else{var d=r.processState,c=r.currentNodeId===o;if("2"!==d&&"3"!==d&&!c){var h=i.selectNode;if(h){if(i.blurNode(h),h.getId()===o)return i.selectNode=h=null,void _exePageFunction("clearStepBackTargetNode","clear");i.selectNode=h=l}else i.selectNode=h=l;var u=[];u.push(h.getId()),u.push(h.getName()),u.push(r.currentNodeId),h.isStart()?u.push(""):u.push(h.getPolicyId()),u.push(h.isBlank());var f="",p=h.getPolicy();p&&(f=p.getAttr("stepBackType")),u.push(f),_exePageFunction("setStepBackTargetNode",u)}}else{var m=i.viewState;if(m.isCircleBranchModel){var g=i.selectNode;if(l.getId()===g.getId())_exeCommandCallback("cancelExeCommand");else{var v=l.getPolicy();if(!l.isBlank()&&-1!==v.getAttr("multipleMode").indexOf("1"))return void WorkflowUtil.toast(r.label.unSN5);ViewUtil.removeEvent(this,"mouseout"),_exeCommandMethod("newCircleBranch",[l])}}else if(m.isAddBranchModel){var w=i.selectNode;l.getId()===w.getId()?_exeCommandCallback("cancelExeCommand"):(ViewUtil.removeEvent(this,"mouseout"),_exeCommandMethod("runAddBranch",[l]))}else{var N=i.layoutInfo,A=i.nodeConfig,_=l.getLayoutX()+N.iconOffset[0]+A.icon_size/2,y=l.getLayoutY()+N.iconOffset[1]+A.icon_size/2;_*=N.zoom,y*=N.zoom;var S=[];if(!r.isCIPModel&&l.isSuperNode())r.isSkipNode||(S.push("addNodeI18N"),S.push("deleteNodeI18N"),S.push("nodePropI18N"),i.menuManager.showNodeMenu(l,S,_,y));else if(r.isCIPModel)S.push("addNodeI18N"),l.isSuperNode()&&(S.push("deleteNodeI18N"),S.push("nodePropI18N")),l.isStart()||l.isSplit()||l.isJoin()||l.isSuperNode()||S.push("advanceEvent"),0<S.length&&i.menuManager.showNodeMenu(l,S,_,y);else if(l.isSplit()||l.isJoin()||l.isBlank()){if(l.isSplit())S.push("addBranchI18N"),S.push("handBranchI18N");else if(S.push("addNodeI18N"),l.isBlank()){if(S.push("deleteNodeI18N"),S.push("replaceNodeI18N"),r.isTemplete&&r.showMode===WorkflowConstant.showMode.editable){l.getAttr("copyFrom")||S.push("copyNodeI18N");var b=i.selectNode;m.isCopyNodeModel&&b.getId()!==l.getId()&&S.push("pasteReplaceI18N")}}else S.push("nodePropI18N");i.menuManager.showNodeMenu(l,S,_,y)}else if(l.isStart()||l.isEnd())l.isStart()&&(r.formApp&&"-1"!==r.formApp&&"0"!==r.formApp?(S.push("addNodeI18N"),S.push("nodePropI18N"),r.isTemplete&&"1"===r.canDrSet&&S.push("relationdata"),i.menuManager.showNodeMenu(l,S,_,y)):r.isTemplete&&"collaboration"===r.appName&&"1"===r.canDrSet?(S.push("addNodeI18N"),S.push("relationdata"),i.menuManager.showNodeMenu(l,S,_,y)):(i.focusNode(l),new x.AddPartyCommand(i,l).run()));else{if(S.push("addNodeI18N"),S.push("deleteNodeI18N"),S.push("replaceNodeI18N"),r.isTemplete&&r.showMode===WorkflowConstant.showMode.editable){var I=!l.isInfoNode();if(!l.isSuperNode()){l.getAttr("copyFrom")||S.push("copyNodeI18N");var C=i.selectNode;m.isCopyNodeModel&&C.getId()!==l.getId()&&!l.getAttr("pasteTo")&&S.push("pasteReplaceI18N")}S.push("addBranchI18N"),S.push("nodePropI18N"),l.isSuperNode()||S.push("newWorkflowI18N"),r.isFormTemplate&&I&&S.push("circleBranchI18N"),r.isTemplete&&"1"===r.canDrSet&&S.push("relationdata")}else S.push("nodePropI18N"),l.isSuperNode()||S.push("newWorkflowI18N");i.menuManager.showNodeMenu(l,S,_,y)}}}}};var y=ViewUtil.randId(t)+"_mouseover";oe[y]=function(e){if((e||window.event).stopPropagation(),!ViewUtil.hasClass(this,"disabled")){var t=this.parentNode;if("true"!==SVGUtil.getAttr(t,"collapsed")){var i=t.viewObject,o=i.controller.model,n=o.process,r=i.layoutInfo,s=i.nodeConfig,a=WorkflowUtil.context,l=i.viewState,d=SVGUtil.getAttr(t,"node_id"),c=n.getNode(d);if(l.isAddBranchModel||l.isCircleBranchModel){var h=i.selectNode;if(h.getId()===c.getId())return;var u="";if(l.isShowDynamicMarkPath||(l.isShowDynamicMarkPath=!0,i.$svg.appendChild(i.$dynamicMarkPath)),l.isCircleBranchModel){var f=h.getLayoutX()+r.topCircleLineOffset[0],p=h.getLayoutY(),m=c.getLayoutX()+r.topCircleLineOffset[0],g=c.getLayoutY(),v=0,w="";g<=p?v=s.icon_size:w="-",u+="M"+f+","+(p+v),u+=" l0,"+w+"30",u+=" l"+(m-f)+",0",u+=" L"+m+","+(g+v)}else{var N=h.getLayoutX(),A=h.getLayoutY(),_=c.getLayoutX(),y=A+r.leftLineOffset[1],S=_+r.nodeWidth;u+="M"+N+","+y,u+=" l0,30",u+=" l"+(S-N)+",0",u+=" L"+S+","+y}SVGUtil.setAttr(i.$dynamicMarkPath,"d",u),ViewUtil.removeEvent(this,"mouseout"),ViewUtil.addEvent(this,"mouseout",function(e){var t=this.parentNode.viewObject;l.isShowDynamicMarkPath=!1,ViewUtil.removeElement(t.$dynamicMarkPath),ViewUtil.removeEvent(this,"mouseout")})}else if(!(c.isStart()||c.isEnd()||a.showMode!==WorkflowConstant.showMode.read_only||c.isBlank()||c.isUserNode()||null==o.caseItemLog)){var b=c.getLayoutX()+r.iconOffset[0]+s.icon_size-12,I=c.getLayoutY()+r.iconOffset[1]+s.icon_size-12;b*=r.zoom,I*=r.zoom,i.menuManager.showNodeMembers(c,b,I)}}}},ViewUtil.addEvent(i,"mouseover",oe[y]),t.viewObject=this,ViewUtil.addEvent(i,"click",oe[_])}return r},t._iterationDrawNode=function(e,t,i){if(t[e.getId()])return{node:e,fromLink:i};t[e.getId()]=e.getId(),e.isForceRedraw()&&(this._removeNode(e.getId()),e.setForceRedraw(!1));var o=this._drawNode(e),n=e.getDownLinks();if(e.isSplit()&&"collapsed"===e.splitDisplay&&1===e.currentPathSize){var r=e.collapseNode;n=[];var s=this.controller.model.process.getNode(e.nextCurrentPathNodeId);n.push(r.getUpLinks()[0]),n.push(s.getUpLinks()[0])}e.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMCollapsedNode&&(1!==e.splitNode.currentPathSize&&e.joinNode&&(n=[]).push(e.joinNode.getDownLinks()[0]));if(n&&0<n.length)for(var a=0;a<n.length;a++){var l=n[a],d=l.getToNode();if(!d.isHidden()){d.isSplit()&&"collapsed"===d.splitDisplay&&1!==d.currentPathSize&&(d=d.collapseNode);var c=this._iterationDrawNode(d,t,l),h=c.node,u=c.fromLink;if(o&&!h.isSkip()&&this._drawLine(e,l,h,u),1===e.getNextLineSize()&&!o)return{node:h,fromLink:u}}}return{node:e,fromLink:i}},t._drawLine=function(e,t,i,o){var n=this.layoutInfo,r=WorkflowUtil.context;o.isForceRedraw()&&(this._removeLine(o.getId()),o.setForceRedraw(!1));var s="false"===this._getVerify(o.getId()).r0,a=(e.getX()+ne)*n.nodeWidth,l=(e.getY()+1.6)*n.nodeHeight,d=(i.getX()+ne)*n.nodeWidth,c=(i.getY()+1.6)*n.nodeHeight,h=n.rightLineOffset[0];e.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMCollapsedNode&&(h+=5);var u=n.leftLineOffset[0];i.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMCollapsedNode&&(u-=5);var f=this._getLineLocation(e,a,l,h),p=this._getLineLocation(i,d,c,u),m=[];if(m.push(f),l===c);else{var g=[];e.isSplit()?(g.push(f[0]),g.push(p[1])):i.isJoin()&&(g.push(p[0]),g.push(f[1])),m.push(g)}m.push(p);var v,w,N,A,_=!i.isJoin()&&!i.isEnd()&&i.getBPMObjectType()!==WorkflowConstant.bpmObjType.BPMCollapsedNode&&r.showMode===WorkflowConstant.showMode.editable&&!0===r.isTemplete&&!r.isCIPModel,y=i.isVirtual()||e.isVirtual(),S=o.getId()||"",b=0,I=0,C=0;v=m[0][0],w=m[0][1],N=m[1][0],A=m[1][1],2<m.length&&(b=m[2][0],I=m[2][1]);var k=v+","+w+" "+N+","+A+" "+b+","+I,T=n.lineCache[S],M=!1,U=0;if(T){if(M=!0,U=T.lineSize,T.path===T)return}else T={};T.path=k,T.lineSize=m.length-1,T.draw=!0,T.isEditLine=_,n.lineCache[S]=T;var x,E=null,V="Line_"+S+"_"+C;M?x=ViewUtil.query("#"+V,!1,this.$svg):(x=SVGUtil.create("line"),SVGUtil.setAttrs(x,{id:V,line_id:S}),ViewUtil.addClass(x,"wf_line"),y&&ViewUtil.addClass(x,"dasharray"),this.$svg.insertBefore(x,this.$defs)),SVGUtil.setAttrs(x,{x1:v,y1:w,x2:N,y2:A}),(_=_&&!this._isCommandState())?ViewUtil.addClass(x,"edit"):M&&ViewUtil.removeClass(x,"edit"),s&&ViewUtil.addClass(x,"invalid"),w===A&&(E=x);var L,P=v,B=N,O=A,D="Line_"+S+"_"+ ++C;if(2<m.length)M&&(L=ViewUtil.query("#"+D,!1,this.$svg)),L||(L=SVGUtil.create("line"),SVGUtil.setAttrs(L,{id:D,line_id:o.getId()}),ViewUtil.addClass(L,"wf_line"),y&&ViewUtil.addClass(L,"dasharray"),this.$svg.insertBefore(L,this.$defs)),SVGUtil.setAttrs(L,{x1:b,y1:I,x2:N,y2:A}),_?ViewUtil.addClass(L,"edit"):M&&ViewUtil.removeClass(L,"edit"),s&&ViewUtil.addClass(L,"invalid"),A===I&&(E=L),P=N,B=b,O=I;else if(1<U){var W=ViewUtil.query("#"+D,!1,this.$svg);if(W){var R=ViewUtil.randId(W)+"_click";delete oe[R],ViewUtil.removeEvent(W,"click"),ViewUtil.removeElement(W)}}var F,G,X=o.getBranchIcon(),j="branch_"+S,z="branch_"+S+"_hot";if(X){s&&(X+="_red");var H=this.getDefIcon(X).iconId;(F=ViewUtil.query("#"+j,!1,this.$svg))?ViewUtil.removeElement(F):F=SVGUtil.create("use"),ViewUtil.insertAfter(F,E),(G=ViewUtil.query("#"+z,!1,this.$svg))||_?ViewUtil.removeElement(G):G=SVGUtil.create("rect"),_?G&&(ViewUtil.removeEvent(G,"mouseover"),G=null):ViewUtil.insertAfter(G,F);var $=(P+B)/2-9,J=O-11;if(SVGUtil.setAttrs(F,{x:$,y:J,lineId:o.getId(),"xlink:href":"#"+H,id:j}),!_){SVGUtil.setAttrs(G,{x:$,y:J,rx:11.5,ry:11.5,width:23,height:23,fill:"transparent",id:z,for:j}),ViewUtil.removeEvent(G,"mouseover"),G.viewObject=this,ViewUtil.addEvent(G,"mouseover",function(e){(e||window.event).stopPropagation();var t=this.viewObject,i=SVGUtil.getAttr(this,"for"),o=ViewUtil.query("#"+i,!1,t.$svg);t._showLineConditon(o)})}}else{var Y=ViewUtil.query("#"+j,!1,this.$svg);if(Y){var q=ViewUtil.query("#"+j+"_hot",!1,this.$svg);q&&(ViewUtil.removeEvent(q,"mouseover"),ViewUtil.removeEvent(q,"click"),ViewUtil.removeElement(q)),ViewUtil.removeElement(Y)}}if(_){var Z="line_hot_"+S,K=ViewUtil.query("#"+Z);K?ViewUtil.removeElement(K):K=SVGUtil.create("line"),SVGUtil.setAttrs(K,{id:Z,hotfor:S,class:"wf_hotspot_line",x1:P,y1:O,x2:B,y2:O}),ViewUtil.insertAfter(K,G||F||E);var Q=ViewUtil.randId(K),ee=Q+"_click",te=Q+"_mouseover",ie=Q+"_mouseleave";ViewUtil.removeEvent(K,"click"),ViewUtil.removeEvent(K,"mouseover"),ViewUtil.removeEvent(K,"mouseleave"),oe[ie]=function(e){var t=this.viewObject;if(!t.viewState.blockEvent){(e||window.event).stopPropagation();var i=this.getAttribute("hotfor"),o=t.controller.model.process.getLine(i);t.blurLine(o)}},oe[te]=function(e){var t=this.viewObject,i=this.getAttribute("hotfor"),o=t.controller.model.process.getLine(i);if(!t.viewState.blockEvent||o.hasCondition())if((e||window.event).stopPropagation(),o.hasCondition()){var n="branch_"+i,r=ViewUtil.query("#"+n,!1,t.$svg);t._showLineConditon(r)}else t.focusLine(o)},oe[ee]=function(e){var t=e||window.event;t.stopPropagation();var i=this.viewObject,o=this.getAttribute("hotfor"),n=i.controller.model.process,r=i.layoutInfo,s=i.$scrollRoot,a=WorkflowUtil.context,l=n.getLine(o),d=t.clientY-r.mainOffset[0]+s.scrollTop,c=t.clientX-r.mainOffset[1]+s.scrollLeft;if(c-=5,d-=5,a.isTemplete&&a.showMode===WorkflowConstant.showMode.editable){if(a.isCIPModel)return;var h=[];h.push("autoConditionI18N"),h.push("handworkConditionI18N"),h.push("exclusiveConditionI18N"),h.push("moreOptionI18N"),h.push("deleteConditionI18N"),i.menuManager.showLineMenu(l,h,c,d)}},K.viewObject=this,ViewUtil.addEvent(K,"mouseover",oe[te]),ViewUtil.addEvent(K,"mouseleave",oe[ie]),ViewUtil.addEvent(K,"click",oe[ee])}},t._showLineConditon=function(e){var t=this.controller.model.process,i=this.layoutInfo,o=e.getAttribute("lineId"),n=t.getLine(o),r=parseInt(SVGUtil.getAttr(e,"x")),s=parseInt(SVGUtil.getAttr(e,"y"));r*=i.zoom,s*=i.zoom;var a=21*i.zoom;r=r+a/2-30,s=s+a+13,this.menuManager.showBranch(n,r,s)},t._caculateSwimlaneText=function(e,t){var i="",o=0;e-=30;for(var n=0,r=t.length;n<r;n++){var s=t.charAt(n);if(f.test(s)?o+=14:o+=7,!(o+10<e)){i+=n===r-1?s:"...";break}i+=s}return i},t._refreshSwimlane=function(){var e=this.viewState.swimlaneVisible,t=this.controller.model.process,i=t.getSwimlanes(),o=WorkflowUtil.context,n=this.layoutInfo;this._removeSwimlaneDom();for(var r=0,s=i.length;r<s;r++){var a=i[r];if(e&&a.isVisible()){var l=(a.getMinX()+ne)*n.nodeWidth,d=(a.getMaxX()+ne)*n.nodeWidth,c=t.getMaxLayoutY()-40,h="swimlane_"+a.getId(),u=SVGUtil.create("g"),f=null;SVGUtil.setAttrs(u,{id:h,swimlaneId:a.getId(),class:"wf_swimlane",transform:"matrix(1,0,0,1,"+l+",80)"});var p=d-l,m=c-80,g=void 0;o.scene===WorkflowConstant.scene.DESIGNER_ADMIN&&(g=SVGUtil.create("rect"),SVGUtil.setAttrs(g,{width:p,height:m,fill:"transparent"}),u.appendChild(g));var v=SVGUtil.create("path"),w="M0,0 H"+p+" V36 H0 V0 z";SVGUtil.setAttrs(v,{stroke:"#B1C8E1","stroke-width":"1",fill:"#ECF2F8",d:w}),u.appendChild(v);var N=SVGUtil.create("path");w="M0,36 V"+m+" H"+p+" V36 H0 z",SVGUtil.setAttrs(N,{stroke:"#D9E3ED","stroke-width":"1",fill:"none",d:w}),u.appendChild(N);var A=SVGUtil.create("text");SVGUtil.setAttrs(A,{id:h+"_name",swimlaneId:a.getId(),x:p/2,y:25,layoutX:l,layoutY:80,width:p,height:36,"font-family":E,"font-size":"14px",fill:"#333",style:"cursor:text;text-anchor: middle;"});var _=a.getName();_||o.scene!==WorkflowConstant.scene.DESIGNER_ADMIN||(_=o.label.clickEditSwimlaneName),A.appendChild(SVGUtil.newText(this._caculateSwimlaneText(p,_)));var y=SVGUtil.create("title");if(y.appendChild(SVGUtil.newText(_)),A.appendChild(y),u.appendChild(A),o.scene===WorkflowConstant.scene.DESIGNER_ADMIN){var S=SVGUtil.create("g");SVGUtil.setAttrs(S,{id:h+"_add",swimlaneId:a.getId(),transform:"matrix(1,0,0,1,6,36)"});var b=SVGUtil.create("path"),I="M0,0 v22 h22 v-22 h-22 z";SVGUtil.setAttrs(b,{stroke:"none",fill:"#D8EFFF",d:I}),S.appendChild(b);var C=SVGUtil.create("path");if(SVGUtil.setAttrs(C,{stroke:"#6B9DE4","stroke-width":"2",fill:"none",d:"M5,11 h12 M11,5 v12"}),S.appendChild(C),S.style.display="none",u.appendChild(S),S.view=this,ViewUtil.addEvent(S,"click",function(e){e.stopPropagation();for(var t=this.view,i=t.controller.model.process,o=this.getAttribute("swimlaneId"),n=WorkflowUtil.context,r=i.getSwimlane(o),s=r.getNodes(),a=!1,l=0,d=s.length;l<d;l++){var c=s[l];if(c.isCollapsed){a=!0;var h=c.collapsedBy,u=i.getNode(h);n.expandedSplits[u.getId()]="",u.splitDisplay="expanded",u.nextCurrentPathNodeId=null,u.collapseNode=null,u.currentPathSize=0}}a&&t.controller.calculateLocation();var f=r.getMaxX(),p=r.getMinX();if(f-p<2)return WorkflowUtil.toast(n.label.cannotSplitSwimlane),void(a&&t.controller.drawOrRefreshView());var m=new x.BPMSwimlane;m.setId(ModelUtil.nextId()),m.setName();for(var g=0,v=s.length;g<v;g++){var w=s[g];p<w.getX()&&(r.removeNode(w),m.addNode(w))}var N=p+1;m.setMinX(N),m.setMaxX(f),m.setVisible(!0),r.setMaxX(N),i.addSwimlane(m,r),t.controller.drawOrRefreshView()}),A.view=this,ViewUtil.addEvent(A,"click",function(e){e.stopPropagation();var t=parseInt(SVGUtil.getAttr(this,"lastTime")||"0"),i=(new Date).getTime();if(i-t<300){var s=this.view;s.setBlockEvent(!0);var o=s.controller.model.process,n=this.getAttribute("swimlaneId"),r=SVGUtil.createDom("input"),a=o.getSwimlane(n),l=this;ViewUtil.addClass(r,"wf_swimlane_input"),ViewUtil.addEvent(r,"blur",function(){var e=this.value;if(e){a.setName(e);var t=l.childNodes,i=t[0],o=t[1];ViewUtil.removeElement(i),ViewUtil.removeElement(o);var n=parseInt(l.getAttribute("width"));l.appendChild(SVGUtil.newText(s._caculateSwimlaneText(n,a.getName())));var r=SVGUtil.create("title");r.appendChild(SVGUtil.newText(a.getName())),l.appendChild(r)}s.setBlockEvent(!1),ViewUtil.removeEvent(this,"blur"),ViewUtil.removeEvent(this,"keyup"),ViewUtil.removeElement(this),s=a=l=null}),ViewUtil.addEvent(r,"keyup",function(e){13===(e.keyCode||e.which||e.charCode)&&this.blur()});var d=parseInt(this.getAttribute("layoutX")),c=parseInt(this.getAttribute("layoutY")),h=parseInt(this.getAttribute("width")),u=parseInt(this.getAttribute("height")),f=s.layoutInfo,p=d*f.zoom,m=c*f.zoom,g=h*f.zoom,v=u*f.zoom,w=r.style;w.left=p+"px",w.top=m+"px",w.width=g+"px",w.height=v+"px",s.$container.parentNode.appendChild(r),setTimeout(function(){r.focus(),r.value=a.getName(),r=null},10)}SVGUtil.setAttr(this,"lastTime",i)}),0!==r){var k=SVGUtil.create("g");SVGUtil.setAttrs(k,{id:h+"_remove",swimlaneId:a.getId(),transform:"matrix(1,0,0,1,34,36)"});var T=SVGUtil.create("path");SVGUtil.setAttrs(T,{stroke:"none",fill:"#D8EFFF",d:I}),k.appendChild(T);var M=SVGUtil.create("path");SVGUtil.setAttrs(M,{stroke:"#6B9DE4","stroke-width":"2",fill:"none",d:"M5,11 h12"}),k.appendChild(M),k.style.display="none",u.appendChild(k),k.view=this,ViewUtil.addEvent(k,"click",function(e){e.stopPropagation();for(var t=this.view,i=t.controller.model.process,o=this.getAttribute("swimlaneId"),n=i.getSwimlane(o),r=null,s=i.getSwimlanes(),a=0,l=s.length;a<l;a++)if(o===s[a].getId()){(r=s[a-1]).setMaxX(n.getMaxX());break}i.removeSwimlane(o);for(var d=n.getNodes(),c=0,h=d.length;c<h;c++)n.removeNode(d[c]),r.addNode(d[c]);t.controller.drawOrRefreshView()}),f=SVGUtil.create("line"),SVGUtil.setAttrs(f,{id:h+"_line",style:"cursor:col-resize",stroke:"transparent","shape-rendering":"crispEdges","stroke-width":"10",fill:"none",swimlaneId:a.getId(),x1:l,y1:80,x2:l,y2:c}),f.view=this,ViewUtil.addEvent(f,"mousedown",function(e){e.stopPropagation();var h=this.view;h.setBlockEvent(!0);var d,c,t=h.controller.model.process,i=this.getAttribute("swimlaneId"),u=t.getSwimlane(i),f=t.getLeftSwimlane(i),p=e.clientX,m=0,g=1,v=parseInt(this.getAttribute("x1")),w=SVGUtil.create("line");SVGUtil.setAttrs(w,{stroke:"#D0021B","shape-rendering":"crispEdges","stroke-width":"1",fill:"none","stroke-dasharray":"5 5",x1:v,y1:this.getAttribute("y1"),x2:v,y2:this.getAttribute("y2")}),h.$svg.appendChild(w),ViewUtil.addEvent(document,"mousemove",d=function(e){var t=e||event;t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation();var i=t.clientX,o=Math.abs(i-p),n=h.layoutInfo,r=n.nodeWidth*n.zoom,s=r/2;if(s<o){var a=Math.floor(o/s);m=Math.ceil(a/2)}else m=0;if(p<i){var l=u.getMaxX()-u.getMinX()-1;l<m&&(m=l),g=1}else{var d=f.getMaxX()-f.getMinX()-1;d<m&&(m=d),g=-1}var c=g*m*r;SVGUtil.setAttrs(w,{x1:v+c,x2:v+c})}),ViewUtil.addEvent(document,"mouseup",c=function(){if(ViewUtil.removeEvent(document,"mousemove",d),ViewUtil.removeEvent(document,"mouseup",c),ViewUtil.removeElement(w),0<m){if(0<g)for(var e=u.getNodes(),t=0,i=e.length;t<i;t++){var o=e[t];o.getX()-u.getMinX()<m&&(u.removeNode(o),f.addNode(o))}else for(var n=f.getNodes(),r=f.getMaxX()-1,s=0,a=n.length;s<a;s++){var l=n[s];r-l.getX()<m&&(f.removeNode(l),u.addNode(l))}h.controller.drawOrRefreshView()}h.setBlockEvent(!1),c=d=u=w=null,g=f=m=h=p=null})})}ViewUtil.addEvent(u,"mouseenter",function(){var e=this.getAttribute("swimlaneId"),t=ViewUtil.query("#swimlane_"+e+"_add",!1,this),i=ViewUtil.query("#swimlane_"+e+"_remove",!1,this);t.style.display="",i&&(i.style.display="")}),ViewUtil.addEvent(u,"mouseleave",function(){var e=this.getAttribute("swimlaneId"),t=ViewUtil.query("#swimlane_"+e+"_add",!1,this),i=ViewUtil.query("#swimlane_"+e+"_remove",!1,this);t.style.display="none",i&&(i.style.display="none")})}var U=this.$svg.firstChild;"background_ract"===U.getAttribute("id")&&(U=ViewUtil.get_nextsibling(U)),this.$svg.insertBefore(u,U),f&&this.$svg.insertBefore(f,U)}}},t._removeSwimlaneDom=function(){var e=ViewUtil.query(".wf_swimlane",!0,this.$svg);if(e&&0<e.length)for(var t=WorkflowUtil.context,i=0,o=e.length;i<o;i++){var n=e[i],r=n.getAttribute("id");if(t.scene===WorkflowConstant.scene.DESIGNER_ADMIN){var s=ViewUtil.query("#"+r+"_name",!1,n);s&&(ViewUtil.removeEvent(s,"click"),s.view=null);var a=ViewUtil.query("#"+r+"_add",!1,n);a&&(ViewUtil.removeEvent(a,"click"),a.view=null);var l=ViewUtil.query("#"+r+"_remove",!1,n);l&&(ViewUtil.removeEvent(l,"click"),l.view=null);var d=ViewUtil.query("#"+r+"_line",!1,this.$svg);d&&(ViewUtil.removeEvent(d,"mousedown"),ViewUtil.removeElement(d),d.view=null)}ViewUtil.removeElement(n)}},t._caculateSwimlaneLocation=function(e){for(var t=-1,i=0,o=this.controller.model.process,n=this.layoutInfo,r=!1,s=!1,a=!1,l=0,d=e.length;l<d;l++){var c=e[l];if(c&&c.isVisible()){a=!0,r=!r&&c.isStart(),s=!s&&c.isEnd();var h=c.getLayoutX();t=-1===t?h:Math.min(t,h),i=Math.max(i,h)}}return{minX:t,maxX:i+=n.nodeWidth,minY:80,maxY:o.getMaxLayoutY()-40,isStart:r,isEnd:!r&&s,hasVisibleNode:a}},t._drawCircleLine=function(e,t,i){if(!e.isHidden()&&!t.isHidden()&&!0!==e.isCollapsed&&!0!==t.isCollapsed){var o,n,r="false"===this._getVerify(i.getId()).r0,s=this.layoutInfo,a=WorkflowUtil.context,l=(e.getX()+ne)*s.nodeWidth,d=(e.getY()+1.6)*s.nodeHeight,c=(t.getX()+ne)*s.nodeWidth,h=(t.getY()+1.6)*s.nodeHeight,u=l+","+d+" "+c+","+h,f=i.getId(),p=s.lineCache[f],m=!1;if(p){if(m=!0,p.path===p)return}else p={};p.path=u,p.draw=!0,p.lineSize=1,s.lineCache[f]=p;var g,v,w="Line_"+f+"_0",N="line_hot_"+f;if(m)g=ViewUtil.query("#"+w,!1,this.$svg),v=ViewUtil.query("#"+N,!1,this.$svg);else{g=SVGUtil.create("path"),v=SVGUtil.create("path");var A=this.$svg.firstChild;"background_ract"===A.getAttribute("id")&&(A=ViewUtil.get_nextsibling(A)),this.$svg.insertBefore(g,A),this.$svg.insertBefore(v,A)}o=this._getCircleLineLocation(l,d,!0),n=this._getCircleLineLocation(c,h,!0);var _=SVGUtil.svgPathCurv(n[0],n[1],o[0],o[1]);SVGUtil.setAttrs(g,{d:_,id:w,class:"wf_circle_line"+(r?" invalid":""),lineId:i.getId()}),SVGUtil.setAttrs(v,{id:N,class:"wf_hotspot_line",hotfor:i.getId(),d:_});var y=ViewUtil.randId(v)+"_mouseover";if(ViewUtil.removeEvent(v,"mouseover"),oe[y]=function(e){var t=e||window.event;t.stopPropagation();var i=this.viewObject,o=i.controller.model.process,n=i.layoutInfo,r=i.$scrollRoot,s=this.getAttribute("hotfor"),a=o.getLine(s),l=t.clientY-n.mainOffset[0]+r.scrollTop,d=t.clientX-n.mainOffset[1]+r.scrollLeft;d-=30,l+=20,i.menuManager.showBranch(a,d,l)},a.isTemplete&&a.showMode===WorkflowConstant.showMode.editable){ViewUtil.removeEvent(v,"click");var S=ViewUtil.randId(v)+"_click";oe[S]=function(e){var t=e||window.event;t.stopPropagation();var i=this.viewObject,o=this.getAttribute("hotfor"),n=i.controller.model.process,r=i.layoutInfo,s=i.$scrollRoot,a=n.getLine(o),l=t.clientY-r.mainOffset[0]+s.scrollTop,d=t.clientX-r.mainOffset[1]+s.scrollLeft;d-=5,l-=5;var c=[];c.push("autoConditionI18N"),c.push("moreOptionI18N"),c.push("deleteConditionI18N"),i.menuManager.showLineMenu(a,c,d,l)},ViewUtil.addEvent(v,"click",oe[S])}v.viewObject=this,ViewUtil.addEvent(v,"mouseover",oe[y])}},t._getCircleLineLocation=function(e,t,i){var o=[],n=this.layoutInfo;return o.push(e+n.topCircleLineOffset[0]),!0===i?o.push(t+n.topCircleLineOffset[1]):o.push(t+n.bottonCircleLineOffset[1]),o},t._getLineLocation=function(e,t,i,o){var n=[],r=this.layoutInfo;return e.isJoin()||e.isSplit()?n.push(t+r.nodeWidth/2):n.push(t+o),n.push(i+r.leftLineOffset[1]),n},x.View=e}(WorkflowApp),function(r){function t(e){for(var t=0,i=e.length;t<i;t++)for(var o=e[t],n=t+1,r=e.length;n<r;n++){var s=e[n];if(o.index>s.index){var a=e[t];e[t]=e[n],e[n]=a}}return e}function l(e){var t=document._svgMenu;t.menuVisible&&t.hideFloatBox()}function o(e){(e=e||window.event).preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation();for(var t=e.ctrlKey||e.metaKey,i=(e.keyCode||e.which||e.charCode)+"",o=document._svgMenu.menuList,n=0,r=o.length;n<r;n++){var s=o[n],a=s.getAttribute("prefix")||"";if((s.getAttribute("keycode")||"")===i&&(t&&a||!t&&!a)){d({isKeyupEvent:!0,menukey:s.getAttribute("menukey")}),l();break}}return!1}function d(e){var t,i=document._svgMenu;if(!0===e.isKeyupEvent)t=e.menukey;else{var o=e||window.event,n=function e(t,i){if(!t||t===document.documentElement||t===i)return null;return"li"===t.tagName.toLocaleLowerCase()?t:e(t.parentNode)}(ViewUtil.getTarget(o));n&&(t=n.getAttribute("menukey"))}if(t)switch(t){case"addNodeI18N":new r.AddPartyCommand(i.view,i.selectedObj).run(),i.notToBlur=!0;break;case"deleteNodeI18N":new r.RemovePartyCommand(i.view,i.selectedObj).run(),i.notToBlur=!0;break;case"replaceNodeI18N":new r.ReplaceNodeCommand(i.view,i.selectedObj).run(),i.notToBlur=!0;break;case"copyNodeI18N":new r.CopyNodeCommand(i.view,i.selectedObj).run(),i.notToBlur=!0;break;case"pasteReplaceI18N":_exeCommandMethod("pasteReplace",[i.selectedObj]),i.notToBlur=!0;break;case"addBranchI18N":new r.AddBranchCommand(i.view,i.selectedObj).run(),i.notToBlur=!0;break;case"nodePropI18N":case"handBranchI18N":new r.SettingPropCommand(i.view,i.selectedObj).run(),i.notToBlur=!0;break;case"newWorkflowI18N":new r.SettingNewflowCommand(i.view,i.selectedObj).run(),i.notToBlur=!0;break;case"circleBranchI18N":new r.NewCircleBranchCommand(i.view,i.selectedObj).run(),i.notToBlur=!0;break;case"relationdata":new r.RelationDataCommand(i.view,i.selectedObj).run();break;case"advanceEvent":new r.AdvanceEventCommand(i.view,i.selectedObj).run(),i.notToBlur=!0;break;case"autoConditionI18N":new r.BranchConditionCommand(i.view,i.selectedObj,"auto").run(),i.notToBlur=!0;break;case"handworkConditionI18N":new r.BranchConditionCommand(i.view,i.selectedObj,"manual").run();break;case"exclusiveConditionI18N":new r.BranchConditionCommand(i.view,i.selectedObj,"exclusive").run();break;case"moreOptionI18N":new r.BranchConditionCommand(i.view,i.selectedObj,"branchDesc").run(),i.notToBlur=!0;break;case"deleteConditionI18N":new r.BranchConditionCommand(i.view,i.selectedObj,"delete").run(),i.notToBlur=!0;break;default:"function"==typeof window.svgCustomerMenuHandler&&window.svgCustomerMenuHandler(i.view,i.selectedObj,t)}}var e=0<=navigator.platform.indexOf("Mac"),c={46:"DELETE",65:"A",66:"B",67:"C",78:"N",86:"V"},h={CTRL:e?"⌘":"Ctrl + "},i=function(e){this.container=e.container,this.view=e.view,this.menuBox=null,this.branchBox=null,this.nodeMemberBox=null,this._currentFloatBox=null,this._currentHideName=null,this.selectedObj=null,this.menuVisible=!1,this.notToBlur=!1,this.menuList=[],this.nodeMenuList=t(WorkflowUtil.context.nodeMenu),this.lineMenuList=t(WorkflowUtil.context.lineMenu)},n=i.prototype;n.showNodeMenu=function(e,t,i,o){var n=this.view;this._hideOtherBox(this.menuBox),this._currentFloatBox===this.menuBox&&this.selectedObj&&e.getId()!==this.selectedObj.getId()&&(this.selectedObj.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMTransition||this.selectedObj.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMCircleLink?n.blurLine(this.selectedObj):n.blurNode(this.selectedObj)),n.focusNode(e);var r=i,s=o;this._unbindMenuLiEvent(),this.selectedObj=e;var a=this._createMenuItem(this._getNodeMenus(t,this.nodeMenuList));this._createMenuBox(a),this._showMenuBox(r,s),this._bindMenuLiEvent()},n.showLineMenu=function(e,t,i,o){var n=this.view;this._hideOtherBox(this.menuBox),this._currentFloatBox===this.menuBox&&this.selectedObj&&e.getId()!==this.selectedObj.getId()&&(this.selectedObj.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMTransition||this.selectedObj.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMCircleLink?n.blurLine(this.selectedObj):n.blurNode(this.selectedObj)),n.focusLine(e);var r=i,s=o;this._unbindMenuLiEvent(),this.selectedObj=e;var a=this._createMenuItem(this._getNodeMenus(t,this.lineMenuList));this._createMenuBox(a),this._showMenuBox(r,s),this._bindMenuLiEvent()},n.showBranch=function(e,t,i){var o=this.view;this._hideOtherBox(this.branchBox),this._currentFloatBox===this.branchBox&&this.selectedObj&&e.getId()!==this.selectedObj.getId()&&o.blurLine(this.selectedObj),o.focusLine(e);var n=(this.selectedObj=e).getAttr("formCondition"),r="";if(n&&window.translateBranchFunction){var s=[e.getId(),n];r=window.translateBranchFunction(s)}var a=e.getConditionType()||"",l=e.getIsForce()||"",d=e.getConditionBase()||"",c=r||e.getConditionTitle()||"",h=e.getAttr("desc"),u="";e.isCircleLine()&&(u=e.getAttr("submitStyle"));var f=this._createBranchHTML(a,l,d,c,h,u);this._creatBranchBox(f),this._showBranchBox(t,i)},n.showNodeMembers=function(e,t,i){this._hideOtherBox(this.nodeMemberBox);var o=this.view.controller.model.caseItemLog.getWorkItems(e.getId());if(0<o.length){var n=this._createMemberListHTML(o,e.getName());this._creatNodeMemberBox(n),this._showNodeMemberBox(t,i)}},n._createMemberListHTML=function(e,t){var i=this.view,o=WorkflowUtil.context,n=WorkflowConstant.WorkitemAction,r="";r+='<div class="wf_node_member_title">'.concat(ViewUtil.escapeHTML(t),"</div>");for(var s=0,a=e.length;s<a;s++){var l=e[s],d=l.getItemAction(),c=l.isRead(),h=l.getAttr("accountShortName"),u=void 0;u=d===n.ACTION_CREATE?"true"===o.isShowReadState&&c?"read":"unread":d===n.ACTION_FINISHED?"monitor-finish":d===n.ACTION_AUTO_SKIP_OVER?"monitor-autoskip":d===n.ACTION_ZCDB?"temporary":d===n.ACTION_CANCEL?"":d===n.ACTION_STOP?"monitor-stoped":d===n.ACTION_STOP_EXECUTOR?"monitor-stop":d===n.ACTION_SUSPEND?"stepNodeFlag":"";var f=l.getAttr("performerName");if(""!==f&&""!==u){h&&(f+=" ("+h+")");var p="";if(u){var m=i.getDefIcon("nodestate_"+u).iconId;p+='<svg width="16" height="16"><use xlink:href="#'.concat(m,'"></use></svg>')}r+='<div class="wf_node_member_item">\n                                '.concat(p,"\n                                <span>").concat(f,"</span>                                \n                            </div>")}}return r},n._creatNodeMemberBox=function(e){if(null===this.nodeMemberBox){var t=SVGUtil.createDom("div");ViewUtil.addClass(t,"wf_node_member"),ViewUtil.addClass(t,"wf_nowrap"),this.container.appendChild(t),ViewUtil.addEvent(t,"click",function(e){(e||window.event).stopPropagation()}),this.nodeMemberBox=t}this.nodeMemberBox.innerHTML=e},n._showNodeMemberBox=function(e,t){var i=this.nodeMemberBox,o=i.style;o.display="block",o.left=e+"px",o.top=t+"px",this._showFloatBox(i,"_hideNodeMemberBox")},n._hideNodeMemberBox=function(){this.nodeMemberBox.style.display="none"},n._bindMenuLiEvent=function(){for(var e=!1,t=0,i=this.menuList.length;t<i;t++){(this.menuList[t].getAttribute("keycode")||"")&&(e=!0)}e&&ViewUtil.addEvent(document,"keyup",o)},n._unbindMenuLiEvent=function(){for(var e=!1,t=0,i=this.menuList.length;t<i;t++){(this.menuList[t].getAttribute("keycode")||"")&&(e=!0),ViewUtil.removeElement(this.menuList[t])}e&&ViewUtil.removeEvent(document,"keyup",o),this.menuList=[]},n._getNodeMenus=function(e,t){for(var i=[],o=0,n=t.length;o<n;o++)for(var r=t[o],s=0,a=e.length;s<a;s++)if(r.key===e[s]){i.push(r);break}return i},n._createMenuBox=function(e){if(null===this.menuBox){var t=document.createElement("ul");ViewUtil.addClass(t,"wf_contextMenu"),t.style.width="200px",this.menuBox=t,this.container.appendChild(t),ViewUtil.addEvent(this.menuBox,"click",d)}this.menuBox.innerHTML=e,this.menuList=ViewUtil.query("li",!0,this.menuBox)},n._showMenuBox=function(e,t){var i=this.menuBox,o=i.style,n=this.container;o.display="block";var r=e,s=t,a=n.scrollLeft+n.clientWidth,l=n.scrollTop+n.clientHeight,d=i.offsetWidth,c=i.offsetHeight;d<10&&(d=200),c<10&&(c=200),a<r+d&&(r=a-d-10),l<s+c&&(s=l-c-10),o.left=r+"px",o.top=s+"px",this._showFloatBox(i,"_hideMenuBox")},n._createMenuItem=function(e){for(var t="",i=0,o=e.length;i<o;i++){var n=e[i],r=n.prefix||"",s=n.keyCode||"",a="";if(s){var l="";r&&(l+=h[r]),a='<span class="shortcut">'.concat(l).concat(c[s+""],"</span>")}t+='<li prefix="'.concat(r,'" keycode="').concat(s,'"  menukey="').concat(n.key,'"><a style="width: 165px" href="javascript:void(0)">').concat(n.label," ").concat(a,"</a></li>")}return t},n._hideMenuBox=function(){this.menuBox.style.display="none",this._unbindMenuLiEvent();var e=this.view,t=!1;if(!0===this.notToBlur&&this._currentFloatBox===this.menuBox&&e.viewState.isCopyNodeModel){var i=e.selectNode;this.selectedObj.getId()===i.getId()&&(t=!0)}!0===this.notToBlur||t||(this.selectedObj.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMTransition||this.selectedObj.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMCircleLink?e.blurLine(this.selectedObj):e.blurNode(this.selectedObj))},n._creatBranchBox=function(e){if(null===this.branchBox){var t=SVGUtil.createDom("div");ViewUtil.addClass(t,"wf_branch_menu"),this.branchBox=t,this.container.appendChild(t),ViewUtil.addEvent(t,"click",function(e){(e||window.event).stopPropagation()})}this.branchBox.innerHTML=e},n._showBranchBox=function(e,t){var i=this.branchBox,o=i.style;o.display="block",o.left=e+"px",o.top=t+"px",this._showFloatBox(i,"_hideBranchBox")},n._hideBranchBox=function(){var e=this.view;this.branchBox.style.display="none",e.blurLine(this.selectedObj)},n._createBranchHTML=function(e,t,i,o,n,r){var s=WorkflowUtil.context,a=WorkflowConstant.ConditionType,l="",d="";e===a.autoCondition1||e===a.autoCondition4?(l="currentNode"===i?"["+s.label.currentNodeUser+"]":"["+s.label.startUser+"]",d='<div class="wf_wf_branch_menu_content">'+ViewUtil.escapeHTML(o)+"</div>"):e===a.handCondition?l=s.label.handworkConditionI18N:e===a.exclusiveCondition&&(l=s.label.exclusiveConditionI18N);var c="";return-1!==r.indexOf("0")&&(c+=s.label.rerunlabel),-1!==r.indexOf("1")&&(""!==c&&(c+=" , "),c+=s.label.submittolabel),c&&(c='<div class="wf_branch_menu_title">'.concat(s.label.submitstyle,'</div>\n                                    <div class="wf_wf_branch_menu_content">').concat(c,"</div>\n                                ")),'<div style="width: 100%;height:100%;overflow: auto;"><div class="wf_branch_menu_title">'.concat(s.label.splitCondition,'</div>\n                            <div class="wf_wf_branch_menu_content">').concat(l,"</div>\n                            ").concat(d,'\n                            <div class="wf_branch_menu_title">').concat(s.label.moreOptionI18N+s.label.colon,'</div>\n                            <div class="wf_wf_branch_menu_content">').concat(ViewUtil.escapeHTML(n),"</div>\n                            ").concat(c,"\n                        </div>")},n._showFloatBox=function(e,t){this._currentFloatBox=e,this._currentHideName=t;var i=this.view;(document._svgMenu=this).menuVisible||(i.setBlockEvent(!0),ViewUtil.addEvent(document,"click",l)),this.menuVisible=!0},n.hideFloatBox=function(){this._currentFloatBox&&(this[this._currentHideName](),this._currentFloatBox=null,this._currentHideName=null),this.menuVisible=!1,this.notToBlur=!1,this.selectedObj=null,document._svgMenu=null,ViewUtil.removeEvent(document,"click",l),this.view.setBlockEvent(!1)},n._hideOtherBox=function(e){null!==this._currentFloatBox&&this._currentFloatBox!==e&&this[this._currentHideName]()},r.MenuManager=i}(WorkflowApp),function(e){var t=function(){this.attrs={},this.attrIndex=0},i=t.prototype;i.addAttr=function(e,t,i,o){var n="";null!=t&&"null"!==t&&"undefined"!==t&&(n=t+"");var r={defaultValue:n,value:n,name:e,alias:i||e,notToXML:!0===o,index:this.attrIndex++};if(WorkflowUtil.isDebug())if(this.attrs[e])console.error("存在重复的Key："+e+", 对象类型:"+this.getBPMObjectType());else for(var s in this.attrs)if(this.attrs[s].alias===i){var a="\n存在重复的简称 alias: "+i+", 对象类型:"+this.getBPMObjectType();a+="\n原来的属性key："+this.attrs[s].name,a+="\n新增的属性key："+e,console.error(a)}this.attrs[e]=r},i.getBPMObjectType=function(){throw new Error("undefined BPMObjectType")},i.getAttr=function(e){var t=this.attrs[e];if(t){var i=t.value||t.defaultValue;return"null"!==i&&"undefined"!==i||(i=t.defaultValue),"x"===e?i=parseInt(i,10):"y"===e&&(i=parseFloat(i)),i}return console.warn("获取不存在的属性: "+e+", 对象类型:"+this.getBPMObjectType()),""},i.setAttr=function(e,t){var i=this.attrs[e];if(i){var o="";null!=t&&"null"!==t&&"undefined"!==t&&(o=t+""),i.value=o}else console.warn("设置不存在的属性: key='"+e+"', value='"+t+"', 对象类型:"+this.getBPMObjectType())},i.copyAttrFromObj=function(e,t){for(var i=0,o=t.length;i<o;i++){var n=t[i];this.setAttr(n,e.getAttr(n))}},i.setAttrs=function(e){for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];this.setAttr(t,i)}},i.resetAllAtt=function(){var e=this.attrs;for(var t in e)e.hasOwnProperty(t)&&this.setAttr(this.attrs[t].name,null)},i.parseAttr2Node=function(e){var t=new Array(this.attrIndex),i=this.attrs;for(var o in i)if(i.hasOwnProperty(o)){var n=this.attrs[o];t[n.index]=n}for(var r=0,s=t.length;r<s;r++){var a=t[r],l=this.getAttr(a.name);a.notToXML&&l===a.defaultValue||e.setAttribute(a.alias,l)}},i.transXMLNode2BPMObject=function(e){var t=this.attrs;for(var i in t)if(t.hasOwnProperty(i)){var o,n,r;n=(o=this.attrs[i]).alias,r=e.getAttribute(n),this.setAttr(o.name,r)}},e.BPMObject=t}(WorkflowApp),function(M){var e=function e(){e.__super__.constructor.apply(this,arguments),this.addAttr("type","p","t"),this.addAttr("isShowShortName","false","s"),this.addAttr("showSwimlane","false","w"),this.addAttr("id","","i"),this.addAttr("name","","n"),this.addAttr("desc","","d"),this.addAttr("usedNumberStr","","u"),this.startNode=null,this.links=[],this.circleLinks=[],this.nodes=[],this.swimlanes=[],this.id2NodeMap={},this.id2LineMap={},this.superNodeSize=0,this.maxX=0,this.maxY=0,this.maxLayoutX=0,this.maxLayoutY=0};WorkflowUtil.extend(e,M.BPMObject);var t=e.prototype;t.getBPMObjectType=function(){return WorkflowConstant.bpmObjType.BPMProcess},t.getId=function(){return this.getAttr("id")},t.resetNodeId=function(e){delete this.id2NodeMap[e.getId()];e.getId();var t=e.getSwimlane();t&&t.removeNode(e);var i=ModelUtil.nextId();return e.setId(i),this.id2NodeMap[i]=e,t&&t.addNode(e),i},t.hasSwimlane=function(){return 0<this.swimlanes.length},t.hasSuperNode=function(){return 0<this.superNodeSize},t.isEmptySwimlane=function(){return this.swimlanes.length<2},t.initSwimlane=function(){var e=new M.BPMSwimlane;e.setId(ModelUtil.nextId());var t=WorkflowUtil.context;e.setName(t.label.startSwimlaneName);for(var i=0,o=this.nodes.length;i<o;i++)e.addNode(this.nodes[i]);this.setAttr("showSwimlane","true"),this.addSwimlane(e)},t.fromXML=function(e){this._reset();var t=ModelUtil.getXMLDoc(e).documentElement.childNodes[0];this.transXMLNode2BPMObject(t);for(var i=t.firstChild,o=WorkflowConstant.bpmObjType,n=[];null!=i;){var r,s=null;if((r=i.getAttribute("t"))===o.BPMHumenActivity?s=new M.BPMHumenActivity:r===o.BPMTransition?s=new M.BPMTransition:r===o.BPMCircleLink?s=new M.BPMCTransition:r===o.BPMStart?s=new M.BPMStart:r===o.BPMEnd?s=new M.BPMEnd:r===o.BPMAndRouter?s=new M.BPMAndRouter:r===o.BPMSwimlane&&(s=new M.BPMSwimlane),null!=s)if(s.fromXML(i),r===o.BPMTransition)n.push(s);else if(r===o.BPMCircleLink)this.addCircleLink(s);else if(r===o.BPMSwimlane){WorkflowUtil.context.hasWorkflowAdvanced&&this.addSwimlane(s)}else if(this.addNode(s),s.setX(0),s.setY(0),s.isStart()){var a=WorkflowUtil.context,l=s.getActor();l.getAttr("partyId")&&a.isTemplete&&(l.setAttr("partyId",""),l.setAttr("partyType",""),l.setAttr("name",""));var d=s.getPolicy();!d.getAttr("formApp")&&a.isFormTemplate&&d.setAttr("formApp",a.formApp),a.isTemplete?s.setAttr("name",a.label.startUser):!l.getAttr("partyId")&&a.currentUserId&&(l.setAttr("partyId",a.currentUserId),l.setAttr("partyType","user"),l.setAttr("name",a.currentUserName),s.setAttr("name",a.currentUserName))}i=i.nextSibling}for(var c=n.length-1;-1<c;c--){var h=n[c];this.addLink(h);var u=h.getFromId(),f=h.getToId(),p=this.getNode(u),m=this.getNode(f);ModelUtil.makeLink(p,m,h)}for(var g=this.getCircleLinks(),v=g.length-1;-1<v;v--){var w=g[v],N=w.getFromId(),A=w.getToId(),_=this.getNode(N),y=this.getNode(A);w.setPairNodes(_,y),_.addCircleDonwLink(w),y.addCircleUpLink(w)}for(var S=0,b=this.swimlanes.length;S<b;S++)for(var I=this.swimlanes[S],C=I.getNodeIds().split(","),k=0,T=C.length;k<T;k++)I.addNode(this.getNode(C[k]))},t.hasPolicy=function(e){for(var t=this.nodes,i=0,o=t.length;i<o;i++)if(t[i].getPolicyId()===e&&!t[i].isBlank())return!0;return!1},t.getAllWFSuperNodeNames=function(){for(var e=this.nodes,t=[],i=0,o=e.length;i<o;i++)"WF_SUPER_NODE"===e[i].getPartyType()&&t.push(e[i].getName());return t},t.getAllWFSuperNodePartyIds=function(){for(var e=this.nodes,t=[],i=0,o=e.length;i<o;i++)"WF_SUPER_NODE"===e[i].getPartyType()&&t.push(e[i].getPartyId());return t},t.toXML=function(e,t){var i=WorkflowUtil.context,o=t.createElement("p");e.appendChild(o);for(var n=0,r=this.nodes.length;n<r;n++){this.nodes[n].toXML(o,t)}for(var s=this.links.length-1;0<=s;s--){this.links[s].toXML(o,t)}for(var a=0,l=this.circleLinks.length;a<l;a++){this.circleLinks[a].toXML(o,t)}if(i.hasWorkflowAdvanced)for(var d=0,c=this.swimlanes.length;d<c;d++){var h=this.swimlanes[d];h.isEmpty()||h.toXML(o,t)}this.parseAttr2Node(o)},t.addLink=function(e){this.addLinkBefore(e,-1)},t.addLinkBefore=function(e,t){this.id2LineMap[e.getId()]=e,!t&&0!==t||-1===t?this.links.push(e):this.links.splice(t,0,e)},t.removeLink=function(e){var t;if(t="string"==typeof e?this.id2LineMap[e]:e){delete this.id2LineMap[t.getId()];for(var i=0,o=this.links.length;i<o;i++)if(this.links[i].getId()===t.getId()){this.links.splice(i,1);break}t.getFromNode().removeDonwLink(t.getId()),t.getToNode().removeUpLink(t.getId())}},t.addSwimlane=function(e,t){if(t){for(var i=0,o=this.swimlanes.length;i<o;i++)if(this.swimlanes[i].getId()===t.getId()){this.swimlanes.splice(i+1,0,e);break}}else this.swimlanes.push(e)},t.removeSwimlane=function(e){for(var t=0,i=this.swimlanes.length;t<i;t++)if(this.swimlanes[t].getId()===e){this.swimlanes.splice(t,1);break}},t.addCircleLink=function(e){this.circleLinks.push(e),this.id2LineMap[e.getId()]=e},t.removeCircleLink=function(e){var t;if(t="string"==typeof e?this.id2LineMap[e]:e){delete this.id2LineMap[t.getId()];for(var i=0,o=this.circleLinks.length;i<o;i++)if(this.circleLinks[i].getId()===t.getId()){this.circleLinks.splice(i,1);break}t.getFromNode().removeCircleDonwLink(t.getId()),t.getToNode().removeCircleUpLink(t.getId())}},t.addNode=function(e){this.addNodeBefore(e,-1)},t.addNodeBefore=function(e,t){"start"===e.getId()&&(this.startNode=e),this.id2NodeMap[e.getId()]=e,!t&&0!==t||-1===t?this.nodes.push(e):this.nodes.splice(t,0,e),e.isSuperNode()&&this.superNodeSize++},t.removeNode=function(e){var t;if(t="string"==typeof e?this.getNode(e):e){t.isSuperNode()&&this.superNodeSize--,delete this.id2NodeMap[t.getId()];for(var i=0,o=this.nodes.length;i<o;i++)if(this.nodes[i].getId()===t.getId()){this.nodes.splice(i,1);break}var n=t.getSwimlane();n&&(n.removeNode(t),n.isEmpty()&&this.removeSwimlane(n.getId()))}},t.getSwimlanes=function(){return this.swimlanes},t.addNodeToSwimlane=function(e,t){var i=e.getSwimlane();if(i)if(Array.isArray(t))for(var o=0,n=t.length;o<n;o++)i.addNode(t[o]);else i.addNode(t)},t.getSwimlane=function(e){for(var t=this.swimlanes,i=0,o=t.length;i<o;i++)if(t[i].getId()===e)return t[i];return null},t.getLeftSwimlane=function(e){for(var t=this.swimlanes,i=0,o=t.length;i<o;i++)if(t[i].getId()===e)return 0===i?null:t[i-1];return null},t.getRightSwimlane=function(e){for(var t=this.swimlanes,i=0,o=t.length;i<o;i++)if(t[i].getId()===e)return i===o-1?null:t[i+1];return null},t.getLinks=function(){return this.links},t.getCircleLinks=function(){return this.circleLinks},t.getNodes=function(){return this.nodes},t.getNode=function(e){return this.id2NodeMap[e]},t.getLine=function(e){return this.id2LineMap[e]},t.getStartNode=function(){return this.startNode},t.getMaxX=function(){return this.maxX},t.setMaxX=function(e){this.maxX=e},t.setMaxLayoutX=function(e){this.maxLayoutX=e},t.getMaxLayoutX=function(){return this.maxLayoutX},t.setMaxLayoutY=function(e){this.maxLayoutY=e},t.getMaxLayoutY=function(){return this.maxLayoutY},t.getMaxY=function(){return this.maxY},t.setMaxY=function(e){this.maxY=e},t._reset=function(){this.resetAllAtt()},M.BPMProcess=e}(WorkflowApp),function(u){var t={x:0,y:0,nextLineSize:0,preLineSize:0,nextSubSize:1,subSize:1,skip:!1,_delete:!1,visible:!1,virtual:!1,forceRedraw:!1},e=function e(){e.__super__.constructor.apply(this,arguments),this.addAttr("id","","i"),this.addAttr("name","","n"),this.addAttr("type",this.getBPMObjectType(),"t"),this.addAttr("desc","","d"),this.addAttr("x","0","x"),this.addAttr("y","0","y"),this.addAttr("fromType","","q"),this.downLinks=[],this.upLinks=[],this.downCircleLinks=[],this.upCircleLinks=[],this.isCurrentPath=!1,this.isCollapsed=!1,this.collapsedBy=null,this.actor=new u.BPMActor,this.policy=new u.BPMSeeyonPolicy,this.swimlane=null,this.state=WorkflowConstant.nodeState.STATE_NORMAL,this.locationInfo=WorkflowUtil.merge({},t),this.setId(ModelUtil.nextId())};WorkflowUtil.extend(e,u.BPMObject);var i=e.prototype;i.resetLocationInfo=function(){var e=this.locationInfo.forceRedraw;this.locationInfo=WorkflowUtil.merge({},t),this.locationInfo.forceRedraw=e},i.setSwimlane=function(e){this.swimlane=e},i.getSwimlane=function(){return this.swimlane},i.getNodeIcon=function(){var e,t=this.getActor(),i=WorkflowUtil.context,o="",n="";t&&(o=t.getPartyType(),n=t.getAttr("partyVJoin"));var r="nodeicon_";return this.isEnd()?r+=this.getId():this.isSplit()||this.isJoin()?r+="SynNode":this.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMCollapsedNode?r+="CollapsedNode":this.isBlank()?r+="BlankNode":"Node"===o?r+="Role":"WFDynamicForm"===o?r+="FormField":"WF_SUPER_NODE"===o?r+="SuperNode":"JoinAccountTag"===o?r+="VJ_AccountTag":"1"===n||"2"===n||"3"===n?r+="VJ_"+o+"_"+n:(r+=o,"user"!==o||i.isTemplete||(r+="_"+t.getPartyId(),e=t.getPartyId()),this.isStart()&&!e&&(r+="start")),{nodeIconCode:r,memberId:e}},i.getNodeState=function(e){this.isCollapsed=!1,this.collapsedBy=null;var t,i,o=this.getPolicy(),n=WorkflowConstant.nodeState,r=!1,s=[];t=i=this.getState(),e&&0<(s=e.getWorkItems(this.getId())).length&&(r=s[0].isRead()||s[s.length-1].isRead());for(var a=0;a<s.length;a++){var l=s[a],d=l.getItemAction(),c=l.isRead(),h=WorkflowConstant.WorkitemAction;if(t===n.STATE_READY||t===n.STATE_INFORM)d===h.ACTION_FINISHED||d===h.ACTION_ZCDB?(t=n.STATE_ZCDB,r=c):d===h.ACTION_STOP?t=n.STATE_STOP_PASSIVITY:d===h.ACTION_STOP_EXECUTOR&&(t=n.STATE_STOP);else if(t===n.STATE_FINISHED)d===h.ACTION_AUTO_SKIP_OVER&&(t=n.STATE_AUTO_SKIP);else if(t===n.STATE_STOP)d===h.ACTION_STOP&&(t=n.STATE_STOP_PASSIVITY);else{if(t!==n.STATE_STOP_PASSIVITY)break;d===h.ACTION_STOP_EXECUTOR&&(t=n.STATE_STOP_24)}}return this.isBlank()?t===n.STATE_READY&&(t=n.STATE_FINISHED):t===n.STATE_FINISHED&&o.getNa()===u.BPMSeeyonPolicy.na_2_NOT_MATCH_SKIP&&0===s.length&&(t=n.STATE_AUTO_SKIP),{state:t,nodeState:i,isReadState:r}},i.getState=function(){return this.state},i.setState=function(e){this.state=e},i.getBPMObjectType=function(){},i.getNodeType=function(){},i.getId=function(){return this.getAttr("id")},i.setId=function(e){this.setAttr("id",e)},i.getName=function(){return this.getAttr("name")},i.getPartyId=function(){return null===this.actor?"":this.actor.getPartyId()},i.getPartyType=function(){return null===this.actor?"":this.actor.getPartyType()},i.getAccountShortName=function(){return null===this.actor?"":this.actor.getAttr("shortName")},i.setName=function(e){this.setAttr("name",e)},i.getPolicyName=function(){var e="",t=this.policy;return t&&(e=t.getName()),e},i.getPolicyId=function(){var e="",t=this.policy;return t&&(e=t.getAttr("id")),e},i.fromXML=function(e){var t=this.policy,i=e.getElementsByTagName("s");i&&i[0]&&t.fromXML(i[0]);var o=this.actor;if(o){var n=e.getElementsByTagName("a");n&&n[0]&&o.fromXML(n[0])}},i.toXML=function(e,t){var i=t.createElement("n");e.appendChild(i);var o=this.actor;o&&o.toXML(i,t);var n=this.policy;if(n){var r=WorkflowUtil.context,s=this.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMHumenActivity;"collaboration"===r.appName&&r.formApp&&s&&this.isBlank(),n.toXML(i,t)}this.parseAttr2Node(i)},i.getActor=function(){return this.actor},i.setActor=function(e){this.actor=e},i.getPolicy=function(){return this.policy},i.getDownLinks=function(){return this.downLinks},i.getUpLinks=function(){return this.upLinks},i.getAvailableUpLinks=function(){for(var e=[],t=this.upLinks,i=0,o=t.length;i<o;i++){t[i].getFromNode().isDelete()||e.push(t[i])}return e},i.getCircleDownLinks=function(){return this.downCircleLinks},i.getCircleUpLinks=function(){return this.upCircleLinks},i.addDonwLink=function(e,t){!t&&0!==t||-1===t?this.downLinks.push(e):this.downLinks.splice(t,0,e)},i.removeDonwLink=function(e){for(var t=this.downLinks,i=0,o=t.length;i<o;i++)if(t[i].getId()===e){t.splice(i,1);break}},i.addUpLink=function(e){this.upLinks.push(e)},i.removeUpLink=function(e){for(var t=this.upLinks,i=0,o=t.length;i<o;i++)if(t[i].getId()===e){t.splice(i,1);break}},i.addCircleDonwLink=function(e){this.downCircleLinks.push(e)},i.removeCircleDonwLink=function(e){for(var t=this.downCircleLinks,i=0,o=t.length;i<o;i++)if(t[i].getId()===e){t.splice(i,1);break}},i.addCircleUpLink=function(e){this.upCircleLinks.push(e)},i.removeCircleUpLink=function(e){for(var t=this.upCircleLinks,i=0,o=t.length;i<o;i++)if(t[i].getId()===e){t.splice(i,1);break}},i.getDownNodes=function(){for(var e=[],t=this.downLinks,i=0,o=t.length;i<o;i++)e.push(t[i].getToNode());return e},i.getAvailableDownNodes=function(){for(var e=[],t=this.downLinks,i=0,o=t.length;i<o;i++){var n=t[i].getToNode();n.isDelete()||e.push(n)}return e},i.getUpNodes=function(){for(var e=[],t=this.upLinks,i=0,o=t.length;i<o;i++)e.push(t[i].getFromNode());return e},i.getAvailableUpNodes=function(){for(var e=[],t=this.upLinks,i=0,o=t.length;i<o;i++){var n=t[i].getFromNode();n.isDelete()||e.push(n)}return e},i.getX=function(){return this.getAttr("x")},i.setX=function(e){this.setAttr("x",e)},i.setLayoutX=function(e){this.locationInfo.x=e},i.getLayoutX=function(){return this.locationInfo.x},i.getY=function(){return this.getAttr("y")},i.setY=function(e){this.setAttr("y",e)},i.setLayoutY=function(e){this.locationInfo.y=e},i.getLayoutY=function(){return this.locationInfo.y},i.addNextLineSize=function(){this.locationInfo.nextLineSize++},i.getNextLineSize=function(){return this.locationInfo.nextLineSize},i.addPreLineSize=function(){this.locationInfo.preLineSize++},i.getPreLineSize=function(){return this.locationInfo.preLineSize},i.setSkip=function(e){this.locationInfo.skip=e},i.isSkip=function(){return this.locationInfo.skip},i.isForceRedraw=function(){return this.locationInfo.forceRedraw},i.setForceRedraw=function(e){this.locationInfo.forceRedraw=e},i.isValid=function(){var e=this.getAttr("isValid");return"normal"===e||""===e},i.isDelete=function(){return this.locationInfo._delete||this.policy.isDelete()},i.setDelete=function(e){this.locationInfo._delete=e},i.setVirtual=function(e){this.locationInfo.virtual=e},i.isVirtual=function(){return this.locationInfo.virtual},i.isHidden=function(){return this.isDelete()&&!this.isVirtual()},i.setVisible=function(e){this.locationInfo.visible=e},i.isVisible=function(){return this.locationInfo.visible},i.isSplit=function(){return this.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMAndRouter&&"true"===this.getAttr("start")},i.isJoin=function(){return this.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMAndRouter&&"true"!==this.getAttr("start")},i.isStart=function(){return"start"===this.getId()},i.isEnd=function(){return"end"===this.getId()},i.isSuperNode=function(){var e=this.actor;return!!e&&"WF_SUPER_NODE"===e.getAttr("partyType")},i.isUserNode=function(){return null!=this.actor&&"user"===this.actor.getPartyType()},i.isInfoNode=function(){var e=this.policy;if(null===e)return!1;var t=e.getAttr("id");return"inform"===t||"zhihui"===t},i.isVouch=function(){var e=this.policy;return null!==e&&"vouch"===e.getAttr("id")},i.canStepBack=function(){var e=this.policy;return null!==e&&("2"!==e.getAttr("stepBackType")&&!this.isVouch())},i.isCompetitionModel=function(){return!!this.policy&&"competition"===this.policy.getAttr("processMode")},i.hasAdvanceEvent=function(){return"1"===this.getAttr("hasAdvanceEvent")},i.hasSubProcess=function(){return!!this.policy&&"1"===this.policy.getAttr("isHasNewflow")},i.isBlank=function(){return null!=this.actor&&"BlankNode"===this.actor.getPartyId()},i.setNextSubSize=function(e){this.locationInfo.nextSubSize=e},i.getNextSubSize=function(){return this.locationInfo.nextSubSize},i.setSubSize=function(e){this.locationInfo.subSize=e},i.getSubSize=function(){return this.locationInfo.subSize},u.BPMAbstractNode=e}(WorkflowApp),function(e){var t=function e(){e.__super__.constructor.apply(this,arguments),this.addAttr("id","","i"),this.addAttr("name","","n"),this.addAttr("type",this.getBPMObjectType(),"t"),this.addAttr("desc","","d"),this.addAttr("fromId","","k"),this.addAttr("toId","","j"),this.addAttr("sortIndex","","o"),this.addAttr("conditionType","3","h"),this.addAttr("formCondition","","m"),this.addAttr("conditionId","","e"),this.addAttr("isForce","","b"),this.addAttr("conditionBase","","a"),this.addAttr("conditionTitle","","c"),this.fromNode=null,this.toNode=null,this.forceRedraw=!1};WorkflowUtil.extend(t,e.BPMObject);var i=t.prototype;i.getBPMObjectType=function(){return WorkflowConstant.bpmObjType.BPMTransition},i.getNodeType=function(){return"Link"},i.isForceRedraw=function(){return this.forceRedraw},i.setForceRedraw=function(e){this.forceRedraw=e},i.isCircleLine=function(){return this.getBPMObjectType()===WorkflowConstant.bpmObjType.BPMCircleLink},i.getBranchIcon=function(){var e="",t=WorkflowConstant.ConditionType,i=this.getAttr("conditionType"),o=this.getAttr("isForce");return i===t.autoCondition1||i===t.autoCondition4?e="1"===o?"branch_auto_force":"branch_auto":i===t.handCondition?e="branch_manual":i===t.exclusiveCondition&&(e="branch_exclusive"),e},i.hasCondition=function(){return"3"!==this.getAttr("conditionType")},i.getFromId=function(){return this.getAttr("fromId")},i.getToId=function(){return this.getAttr("toId")},i.getId=function(){return this.getAttr("id")},i.setId=function(e){this.setAttr("id",e)},i.getConditionType=function(){return this.getAttr("conditionType")},i.getIsForce=function(){return this.getAttr("isForce")},i.getConditionBase=function(){return this.getAttr("conditionBase")},i.getConditionTitle=function(){return this.getAttr("conditionTitle")},i.getFromNode=function(){return this.fromNode},i.getToNode=function(){return this.toNode},i.setPairNodes=function(e,t){this.setAttr("fromId",e.getId()),this.setAttr("toId",t.getId()),this.fromNode=e,this.toNode=t},i.copyCondition=function(e){e.setAttr("conditionType",this.getAttr("conditionType")),e.setAttr("formCondition",this.getAttr("formCondition")),e.setAttr("conditionId",this.getAttr("conditionId")),e.setAttr("isForce",this.getAttr("isForce")),e.setAttr("conditionBase",this.getAttr("conditionBase")),e.setAttr("conditionTitle",this.getAttr("conditionTitle")),e.setAttr("desc",this.getAttr("desc"))},i.fromXML=function(e){this.transXMLNode2BPMObject(e)},i.toXML=function(e,t){var i=t.createElement("l");e.appendChild(i),this.parseAttr2Node(i)},e.BPMTransition=t}(WorkflowApp),function(e){var t=function e(){e.__super__.constructor.apply(this,arguments),this.addAttr("submitStyle","","s")};WorkflowUtil.extend(t,e.BPMTransition);var i=t.prototype;i.getBPMObjectType=function(){return WorkflowConstant.bpmObjType.BPMCircleLink},i.getNodeType=function(){return"Clink"},i.toXML=function(e,t){var i=t.createElement("cl");e.appendChild(i),this.parseAttr2Node(i)},e.BPMCTransition=t}(WorkflowApp),function(e){var t=function e(){e.__super__.constructor.apply(this,arguments),this.addAttr("id","","i"),this.addAttr("name","","n"),this.addAttr("desc","","d"),this.addAttr("type",this.getBPMObjectType(),"t"),this.addAttr("node","","o"),this.nodeMap={},this.nodeSize=0,this.visible=!1,this.minX=0,this.maxX=0};WorkflowUtil.extend(t,e.BPMObject);var i=t.prototype;i.getBPMObjectType=function(){return WorkflowConstant.bpmObjType.BPMSwimlane},i.getNodeType=function(){return"Swimlane"},i.fromXML=function(e){this.transXMLNode2BPMObject(e)},i.toXML=function(e,t){if(!this.isEmpty()){var i=[];for(var o in this.nodeMap)this.nodeMap.hasOwnProperty(o)&&i.push(o);this.setAttr("node",i.join(","));var n=t.createElement("s");e.appendChild(n),this.parseAttr2Node(n)}},i.isEmpty=function(){return 0===this.nodeSize},i.setVisible=function(e){this.visible=e},i.isVisible=function(){return this.visible},i.getId=function(){return this.getAttr("id")},i.getName=function(){return this.getAttr("name")},i.setName=function(e){this.setAttr("name",e)},i.setId=function(e){this.setAttr("id",e)},i.getNodes=function(){var e=[],t=this.nodeMap;for(var i in t)t.hasOwnProperty(i)&&e.push(t[i]);return e},i.getNodeIds=function(){return this.getAttr("node")},i.addNode=function(e){e&&(this.nodeSize++,(this.nodeMap[e.getId()]=e).setSwimlane(this))},i.removeNode=function(e){this.nodeMap.hasOwnProperty(e.getId())&&(this.nodeSize--,delete this.nodeMap[e.getId()],e.setSubSize(null))},i.setMaxX=function(e){this.maxX=e},i.getMaxX=function(){return this.maxX},i.setMinX=function(e){this.minX=e},i.getMinX=function(){return this.minX},e.BPMSwimlane=t}(WorkflowApp),function(e){var t=function e(){e.__super__.constructor.apply(this,arguments),this.addAttr("roleId","","k"),this.addAttr("condition",1,"c"),this.addAttr("isConstant","false","j"),this.addAttr("includeChild","false","i"),this.addAttr("partyId","","f"),this.addAttr("partyType","","g"),this.addAttr("partyExcludeChildChild","false","h"),this.addAttr("name","","d"),this.addAttr("shortName","","a",!0),this.addAttr("addition","","l"),this.addAttr("raddition","","m"),this.addAttr("partyAccountId","","b"),this.addAttr("partyVJoin","0","vj")};WorkflowUtil.extend(t,e.BPMObject);var i=t.prototype;i.getPartyId=function(){return this.getAttr("partyId")},i.getBPMObjectType=function(){return WorkflowConstant.bpmObjType.BPMActor},i.fromXML=function(e){this.transXMLNode2BPMObject(e)},i.toXML=function(e,t){var i=t.createElement("a");e.appendChild(i),this.parseAttr2Node(i)},i.getPartyType=function(){return this.getAttr("partyType")},i.getPartyId=function(){return this.getAttr("partyId")},e.BPMActor=t}(WorkflowApp),function(e){var t=function e(){e.__super__.constructor.apply(this,arguments),this.addAttr("id","","i"),this.addAttr("name","","n"),this.addAttr("desc","","d"),this.addAttr("type",this.getBPMObjectType(),"t"),this.addAttr("dealTerm","","l"),this.addAttr("dealTermType","","q"),this.addAttr("dealTermUserId","","p"),this.addAttr("dealTermUserName","","o"),this.addAttr("hst","-1","u"),this.addAttr("hstv","-1","h"),this.addAttr("rup","-1","v"),this.addAttr("rScope","","rs"),this.addAttr("mu","1","mu"),this.addAttr("pup","-1","w"),this.addAttr("na","-1","na"),this.addAttr("naUserId","","nai"),this.addAttr("naUserName","","nan"),this.addAttr("asBlankNode","0","na_b"),this.addAttr("ignoreBlank","0","na_i"),this.addAttr("remindTime","","k"),this.addAttr("cycleRemindTime","","cy"),this.addAttr("isOvertopTime","0","g"),this.addAttr("processMode","single","j"),this.addAttr("formApp","","f"),this.addAttr("form","","e"),this.addAttr("operationName","","r"),this.addAttr("operationm","","z"),this.addAttr("FR","","FR"),this.addAttr("DR","","DR"),this.addAttr("isPass","success","s"),this.addAttr("isDelete","false","m"),this.addAttr("isColAssign","false","ca"),this.addAttr("matchScope","1","c"),this.addAttr("isHasNewflow","0","b"),this.addAttr("formField","","a"),this.addAttr("isAdded","0","ad",!0),this.addAttr("addedFromId","","fd",!0),this.addAttr("tolerantModel","1","tm"),this.addAttr("queryIds","","qid"),this.addAttr("statisticsIds","","sid"),this.addAttr("systemAdd","0","sa"),this.addAttr("mergeDealType","","md"),this.addAttr("stepBackType","0","st"),this.addAttr("lockRollback","0","lk"),this.addAttr("multipleMode","0","oe"),this.addAttr("finishedCondition","0","ft"),this.addAttr("executeFinishedValue","100","ftv"),this.addAttr("messageRule","","mr"),this.addAttr("sealMethod","","sm")};WorkflowUtil.extend(t,e.BPMObject),t.na_2_NOT_MATCH_SKIP="2",t.na_2_NOT_MATCH_PROXY="1",t.na_2_NOT_MATCH_SELECT="0";var i=t.prototype;i.setProcessMode=function(e){this.setAttr("processMode",e)},i.getBPMObjectType=function(){return WorkflowConstant.bpmObjType.BPMSeeyonPolicy},i.fromXML=function(e){this.transXMLNode2BPMObject(e)},i.toXML=function(e,t){var i=t.createElement("s");e.appendChild(i),this.parseAttr2Node(i)},i.isDelete=function(){return"true"===this.getAttr("isDelete")},i.getName=function(){return this.getAttr("name")},i.setSealMethod=function(e){this.setAttr("sealMethod",e)},i.getSealMethod=function(){return this.getAttr("sealMethod")},i.getNa=function(){return this.getAttr("na")},e.BPMSeeyonPolicy=t}(WorkflowApp),function(e){var t=function e(){e.__super__.constructor.apply(this,arguments),this.addAttr("customName","","ncn"),this.addAttr("customNameI18n","","ncn_i18n"),this.addAttr("hasAdvanceEvent","0","ae",!0),this.addAttr("copyNumber","","h"),this.addAttr("copyFrom","","g"),this.addAttr("pasteTo","","f")};WorkflowUtil.extend(t,e.BPMAbstractNode);var i=t.prototype;i.getBPMObjectType=function(){return WorkflowConstant.bpmObjType.BPMActivity},i.fromXML=function(e){t.__super__.fromXML.apply(this,[e])},e.BPMActivity=t}(WorkflowApp),function(e){var t=function e(){e.__super__.constructor.apply(this,arguments),this.addAttr("start","","p"),this.addAttr("parallelismNodeId","","o"),this.actor=null,this.reachToJoinNodes=[],this.splitDisplay="default",this.nextCurrentPathNodeId=null,this.collapseNode=null,this.currentPathSize=0};WorkflowUtil.extend(t,e.BPMAbstractNode);var i=t.prototype;i.getBPMObjectType=function(){return WorkflowConstant.bpmObjType.BPMAndRouter},i.getNodeType=function(){return"SynNode"},i.fromXML=function(e){this.transXMLNode2BPMObject(e),t.__super__.fromXML.apply(this,[e])},e.BPMAndRouter=t}(WorkflowApp),function(e){var t=function e(){e.__super__.constructor.apply(this,arguments),this.addAttr("isValid","normal","b"),this.addAttr("finishNum","0","e"),this.addAttr("finishNum2","1000","l"),this.addAttr("task_num","1","c"),this.addAttr("task_num_value","","a")};WorkflowUtil.extend(t,e.BPMActivity);var i=t.prototype;i.getBPMObjectType=function(){return WorkflowConstant.bpmObjType.BPMHumenActivity},i.getNodeType=function(){return"HumenNode"},i.fromXML=function(e){this.transXMLNode2BPMObject(e),t.__super__.fromXML.apply(this,[e])},e.BPMHumenActivity=t}(WorkflowApp),function(e){var t=function e(){e.__super__.constructor.apply(this,arguments)};WorkflowUtil.extend(t,e.BPMAbstractNode);var i=t.prototype;i.getBPMObjectType=function(){return WorkflowConstant.bpmObjType.BPMStatus},i.getNodeType=function(){return"StatusNode"},i.fromXML=function(e){t.__super__.fromXML.apply(this,[e])},e.BPMStatus=t}(WorkflowApp),function(e){var t=function e(){e.__super__.constructor.apply(this,arguments),this.addAttr("customName","","ncn"),this.addAttr("customNameI18n","","ncn_i18n"),this.addAttr("hasAdvanceEvent","0","ae",!0),this.addAttr("copyNumber","","h"),this.addAttr("copyFrom","","g"),this.addAttr("pasteTo","","f"),this.addAttr("isValid","normal","b"),this.setId("start")};WorkflowUtil.extend(t,e.BPMStatus);var i=t.prototype;i.getBPMObjectType=function(){return WorkflowConstant.bpmObjType.BPMStart},i.getNodeType=function(){return"StartNode"},i.fromXML=function(e){this.transXMLNode2BPMObject(e),t.__super__.fromXML.apply(this,[e])},e.BPMStart=t}(WorkflowApp),function(e){var t=function e(){e.__super__.constructor.apply(this,arguments),this.actor=null,this.setId("end")};WorkflowUtil.extend(t,e.BPMStatus);var i=t.prototype;i.getBPMObjectType=function(){return WorkflowConstant.bpmObjType.BPMEnd},i.getNodeType=function(){return"EndNode"},i.fromXML=function(e){this.transXMLNode2BPMObject(e),t.__super__.fromXML.apply(this,[e])},e.BPMEnd=t}(WorkflowApp),function(d){var e=function e(i,o){if(e.__super__.constructor.apply(this,arguments),this.splitNode=i,this.joinNode=o,this.collapsedNodes=[],this.iconNodes=[],this.joinNode){var t=new d.BPMTransition;t.setId(ModelUtil.nextId()),this.addDonwLink(t),t.setPairNodes(this,this.joinNode)}var n=new d.BPMTransition;n.setId(ModelUtil.nextId()),this.addUpLink(n),n.setPairNodes(this.splitNode,this);var r="",s=[],a=1===this.splitNode.currentPathSize,l=this.splitNode.nextCurrentPathNodeId;ModelUtil.iterator(this.splitNode,this.joinNode,function(e){if(a&&e.getId()===l)return 0;if(a&&(e.getId()===i.getId()||o&&e.getId()===o.getId())||(e.isCollapsed=!0,e.collapsedBy=i.getId()),!(e.isSplit()||e.isJoin()||e.isEnd()||e.isBlank())){if(""===r){var t=WorkflowUtil.context;r=e.getName()+"["+e.getPolicyName()+"]"+t.label.etAl}s.length<3&&s.push(e)}return 1}),this.setName(r),this.iconNodes=s};WorkflowUtil.extend(e,d.BPMAbstractNode);var t=e.prototype;t.getBPMObjectType=function(){return WorkflowConstant.bpmObjType.BPMCollapsedNode},t.getNodeType=function(){return"CollapsedNode"},t.getNodeState=function(e){var t=this.collapsedNodes;if(0===t.length){var i=this.splitNode,o=1===this.splitNode.currentPathSize,n=this.splitNode.nextCurrentPathNodeId,r=WorkflowUtil.context;ModelUtil.iterator(i,this.joinNode,function(e){return o&&e.getId()===n?0:(e.isSplit()||e.isJoin()||e.isEnd()||t.push(e),e.isSplit()&&i.getId()!==e.getId()&&"collapsed"===e.splitDisplay&&(r.expandedSplits[e.getId()]="",e.splitDisplay="expanded",e.nextCurrentPathNodeId=null,e.collapseNode=null,e.currentPathSize=0),1)})}for(var s=WorkflowConstant.nodeState,a={state:s.STATE_NORMAL,nodeState:s.STATE_NORMAL,isReadState:!1},l=[s.STATE_NORMAL,s.STATE_AUTO_SKIP,s.STATE_FINISHED,s.STATE_READY,s.STATE_ZCDB,s.STATE_PAUSEED,s.STATE_NEEDREDO_TOME,s.STATE_SUSPENDED,s.STATE_STOP_PASSIVITY,s.STATE_STOP,s.STATE_STOP_24],d={},c=0;c<l.length;c++)d[l[c]]=c;for(var h=0,u=t.length;h<u;h++){var f=t[h],p=f.getNodeState(e),m=p.state,g=p.nodeState,v=p.isReadState;f.isCollapsed=!0,f.collapsedBy=this.splitNode.getId(),v&&(a.isReadState=!0),""===a.state&&(a.state=m,a.nodeState=g),(d[m]||0)>d[a.state]&&(a.state=m)}return a.nodeState=a.state,a},t.getSplitNode=function(){return this.splitNode},t.getJoinNode=function(){return this.joinNode},d.BPMCollapsedNode=e}(WorkflowApp),function(n){var e=function e(){e.__super__.constructor.apply(this,arguments),this.stepList=[]};WorkflowUtil.extend(e,n.BPMObject);var t=e.prototype;t.getStepList=function(){return this.stepList},t.fromXML=function(e){for(var t=ModelUtil.getXMLDoc(e).documentElement.firstChild,i=this.stepList;null!=t;){var o=new n.Step;o.fromXML(t),i.push(o),t=t.nextSibling}},n.BPMCaseLog=e}(WorkflowApp),function(n){var e=function e(){e.__super__.constructor.apply(this,arguments),this.addAttr("action","","A"),this.addAttr("nodeId","","N"),this.frameList=[]};WorkflowUtil.extend(e,n.BPMObject);var t=e.prototype;t.getFrameList=function(){return this.frameList},t.fromXML=function(e){this.transXMLNode2BPMObject(e);for(var t=e.firstChild,i=this.frameList;null!=t;){var o=new n.ProcessFrame;o.fromXML(t),i.push(o),t=t.nextSibling}},t.addFrame=function(e){this.frameList.push(e)},n.Step=e}(WorkflowApp),function(e){var t=function e(){e.__super__.constructor.apply(this,arguments),this.addAttr("nodeId","","N"),this.addAttr("state","","S"),this.addAttr("attri_1","","A1"),this.addAttr("attri_2","","A2")};WorkflowUtil.extend(t,e.BPMObject);var i=t.prototype;i.fromXML=function(e){this.transXMLNode2BPMObject(e)},i.getState=function(){return this.getAttr("state")},i.getNodeId=function(){return this.getAttr("nodeId")},e.ProcessFrame=t}(WorkflowApp),function(r){var e=function e(){e.__super__.constructor.apply(this,arguments),this.itemLogList=[],this._id2Item={}};WorkflowUtil.extend(e,r.BPMObject);var t=e.prototype;t.fromXML=function(e){for(var t=ModelUtil.getXMLDoc(e).documentElement.firstChild,i=this.itemLogList;null!=t;){var o=new r.ItemLog;o.fromXML(t),i.push(o);var n=this._id2Item[o.getNodeId()];n||(n=[]),n.push(o),this._id2Item[o.getNodeId()]=n,t=t.nextSibling}},t.getWorkItems=function(e){return this._id2Item[e]||[]},t.getItemReceiveTime=function(e){var t=0,i=this.getWorkItems(e);if(i&&0<i.length)for(var o=0,n=i.length;o<n&&0===(t=i[o].getItemReceiveTime());o++);return t},t.getItemDealTime=function(e){var t=0,i=this.getWorkItems(e);if(i&&0<i.length)for(var o=0,n=i.length;o<n;o++)t=i[o].getItemDealTime();return t},r.BPMCaseItemLog=e}(WorkflowApp),function(e){var t=function e(){e.__super__.constructor.apply(this,arguments),this.addAttr("itemId","","I"),this.addAttr("nodeId","","N"),this.addAttr("batch","","B"),this.addAttr("performer","","P"),this.addAttr("performerName","","PN"),this.addAttr("performerState","","PS"),this.addAttr("accountShortName","","PA"),this.addAttr("itemCreateDate","","ICD"),this.addAttr("itemUpdateDate","","IUD"),this.addAttr("actionState","","AS"),this.actionList=[],this.isReadState=!1};WorkflowUtil.extend(t,e.BPMObject);var i=t.prototype;i.fromXML=function(e){this.transXMLNode2BPMObject(e);var t=this.actionList=[];this.isReadState=!1;var i=this.getAttr("performerState");if(i){var o=WorkflowUtil.context,n=this.getAttr("performerName"),r="";switch(i){case"0":r="["+o.label.personDelete+"]";break;case"1":r="["+o.label.personDimission+"]";break;case"2":r="["+o.label.personUnAssign+"]";break;case"3":r="["+o.label.personTruce+"]"}this.setAttr("performerName",n+r)}var s=this.getAttr("actionState");if(null!=s&&""!==s)for(var a=s.split(","),l=0;l<a.length;l++){var d=a[l];null!=d&&""!==d&&("26"===d?this.isReadState=!0:t.push(d))}},i.getNodeId=function(){return this.getAttr("nodeId")},i.isRead=function(){return this.isReadState},i.getItemAction=function(){var e=this.actionList;return 0<e.length?e[e.length-1]:""},i.getItemReceiveTime=function(){for(var e=this.actionList,t=0,i=e.length;t<i;t++){if("0"===e[t])return Number(this.getAttr("itemCreateDate"))}return 0},i.getItemDealTime=function(){for(var e=this.actionList,t=0,i=e.length;t<i;t++){var o=e[t];if("5"===o||"22"===o||"23"===o||"24"===o||"15"===o||"14"===o||"7"===o||"27"===o)return Number(this.getAttr("itemUpdateDate"))}return 0},e.ItemLog=t}(WorkflowApp),window.svgMonitorObj={},svgMonitorObj.setAttribute=function(){},svgMonitorObj.resizeScrollPane=function(){var e=_getSvgDesigner();e&&e.resizeScrollPane()},svgMonitorObj.setStepBackTargetNode=function(e){_getSvgDesigner().stepbackTargetNodeCallback(e)},svgMonitorObj.refreshMonitor=function(e,t,i,o,n,r,s){var a=WorkflowUtil.context;a.showMode=n+"",a.scene=s+"",_getSvgDesigner().reloadWorkflow({processXml:e,caseLogXml:t,caseWorkitemLogXml:i})},svgMonitorObj.edocRefresh_Flash=function(e){var t=_getSvgDesigner(),i=e[0],o=e[1],n=e[2];t.reloadWorkflow({processXml:i,caseLogXml:o,caseWorkitemLogXml:n})},svgMonitorObj.selectAddNodePeople=function(e){_exeCommandCallback("selectAddNodePeople",arguments)},svgMonitorObj.setAdvanceEventFlag=function(e){_exeCommandCallback("setAdvanceEventFlag",arguments)},svgMonitorObj.pasteAndReplaceNode=function(){_exeCommandCallback("pasteAndReplaceNode",arguments)},svgMonitorObj.replaceHumenNode=function(e){_exeCommandCallback("replaceHumenNode",arguments)},svgMonitorObj.cancelExeCommand=function(){_exeCommandCallback("cancelExeCommand",arguments)},svgMonitorObj.setRelationDataToProcess=function(e){_getSvgDesigner().setRelationDataToProcess(e)},svgMonitorObj.getHandSelectOptions=function(e,t){var i=_getSvgDesigner(),o=i.toXMLObject(),n=i.getNodeInfo(),r=[];r.push("xml"),r.push(o),r.push(n),r.push(e),r.push(t),_exePageFunction("getHandSelectOptions",r)},svgMonitorObj.updateNewWorkflow=function(e){_exeCommandCallback("updateNewWorkflow",[{isNewWorkflow:"true"===e[0]}])},svgMonitorObj.setProp=function(e){var t=e[0],i=e[1],o=e[2],n=e[3],r=e[4],s=e[5],a=e[6],l=e[7],d=(e[8],e[9]),c=e[10],h=e[11],u=e[12],f=e[13],p=e[14],m=e[15],g=e[16],v=e[17],w=e[18],N=e[19],A=e[20],_=e[21],y=e[22],S=e[23];e[24];_exeCommandCallback("setProp",[{policyId:t,policyName:i,dealTerm:o,remindTime:n,processMode:r,formApp:s,form:a,operationName:l,operationm:e[25],matchScope:d,hasNewflow:c,isApplyToAll:h,formFieldId:u,desc:f,dealTermType:p,dealTermUserId:m,dealTermUserName:g,hasDesc:v,isProIncludeChild:w,hst:N,hstv:A,rAutoUp:_,pAutoUp:y,nuAction:S,tolerantModel:e[26],nodeNameNew:e[27],queryIds:e[28],statisticsIds:e[29],rScope:e[30],mu:e[31]}])},svgMonitorObj.autoCondition=function(e){_exeCommandCallback("autoCondition",[{conditionType:e[0],formCondition:e[1],conditionId:e[2],isForce:e[3],conditionBase:e[4],conditionTitle:e[5],submitStyle:e[6]}])},svgMonitorObj.setConditionDesc=function(e){e[0],e[1];_exeCommandCallback("updateConditionDesc",[e[2]])},svgMonitorObj.submitDataXML=function(){var e=_getSvgDesigner(),t=e.toXMLObject(),i=e.getNodeInfo(),o=[];o.push("xml"),o.push(t),o.push(i),submit(o)},svgMonitorObj.showWorkflowDiagramByWindowSize=function(e){e.minimizeView()},svgMonitorObj.showWorkflowDiagramByActualSize=function(e){e.maximizeView()},svgMonitorObj.mouseWheelHandler=function(e,t){e<0?t.scaleView(!0):t.scaleView(!1)},svgMonitorObj.hasPolicy=function(e){return _getSvgDesigner().hasPolicy(e)},svgMonitorObj.getAllWFSuperNodeNames=function(){return _getSvgDesigner().getAllWFSuperNodeNames()},svgMonitorObj.getAllWFSuperNodePartyIds=function(){return _getSvgDesigner().getAllWFSuperNodePartyIds()},function(e){var t=function(){var e=svgMonitorObj._currentCommond;e&&e.cancelExeCommand&&e.cancelExeCommand()},i=t.prototype;i.exeCommand=function(e){this.beforExe();var t=Array.prototype.slice.call(arguments,1);window[e].apply(window,t)},i.beforExe=function(){svgMonitorObj._currentCommond=this},i.destroy=function(){svgMonitorObj._currentCommond=null},e.Command=t}(WorkflowApp),function(m){var e=function e(t,i){e.__super__.constructor.apply(this,arguments),this.currentNode=i,this.view=t};WorkflowUtil.extend(e,m.Command);var t=e.prototype;t.run=function(){var e=WorkflowUtil.context,t=this.currentNode,i=this.view;if(e.scene===WorkflowConstant.scene.RUNNING_MANAGERCONTROL||e.scene===WorkflowConstant.scene.RUNNING_SUPERVISION){if(t.isStart())return WorkflowUtil.toast(e.label.unAN1),void i.blurNode(t);var o=t.getState(),n=WorkflowConstant.nodeState;if(t.isInfoNode()&&o!==n.STATE_NORMAL)return WorkflowUtil.toast(e.label.unAN0),void i.blurNode(t);var r=0;if(o===n.STATE_NORMAL||o===n.STATE_READY||o===n.STATE_ZCDB)r=1;else if(o===n.STATE_SUSPENDED){var s=t.getAvailableDownNodes()[0];if(s.getState()===n.STATE_NORMAL||s.isEnd())r=1;else{if(!s.isJoin())return WorkflowUtil.toast(e.label.unAN1),void i.blurNode(t);r=1}}else{if(o!==n.STATE_FINISHED)return WorkflowUtil.toast(e.label.unAN1),void i.blurNode(t);var a=t.getAvailableDownNodes()[0],l=a.getState();if(l===n.STATE_NORMAL)r=2;else{if(!a.isJoin())return WorkflowUtil.toast(e.label.unAN1),void i.blurNode(t);if(l!==n.STATE_READY&&l!==n.STATE_NORMAL)return WorkflowUtil.toast(e.label.unAN1),void i.blurNode(t);r=2}}i.blurNode(t);var d=i.controller.model.process.getId(),c=[];c.push(d),c.push(t.getId()),c.push(r+""),c.push(o),c.push(t.getNodeType()),e.isTemplete?c.push("true"):c.push("false"),c.push(e.appName),i.blurNode(t),_exePageFunction("edocAddNodeItem",c)}else this.exeCommand("designerCallAddNodeItem",{nodeType:t.getNodeType(),isTemplete:e.isTemplete,appName:e.appName,isAddBranchModel:i.viewState.isAddBranchModel+""})},t.cancelExeCommand=function(){this.view.blurNode(this.currentNode),this.destroy()},t.selectAddNodePeople=function(e){var t=WorkflowUtil.context,i=this.view,o=this.currentNode,n=i.controller.model.process;if(i.blurNode(o),this.destroy(),"true"===e[2]+""&&n.setAttr("isShowShortName","true"),e&&e[0]){var r=e[1];"2"===r&&(r="1");for(var s=e[0],a=!1,l=0,d=0,c=s.length;d<c;d++)s[d].id&&(a=!0,l++);if(a){var h=!0;"addBranch"===this.addType?"0"===r?h=this._addSerail4AddBranch(s):"1"===r&&(h=this._addParallel4AddBranch(s)):h="0"===r||"1"===r&&1===l?this._addSerail(s):"1"===r?this._addParallel(s):this._colAssign(s),h?(i.controller.drawOrRefreshView(),ViewUtil.triggerEvent("flowChangeEvent")):WorkflowUtil.toast(t.label.unallowed)}}},t._check=function(){var e=this.currentNode,t=e.isStart(),i=e instanceof m.BPMHumenActivity,o=e.isJoin();return t||i||o},t._colAssign=function(e){var t=this.currentNode;if(t instanceof m.BPMHumenActivity){var i,o,n=t.getDownLinks(),r=t.getUpLinks();i=n[0].getToNode(),o=r[0].getFromNode();var s,a,l=this.view.controller.model,d=l.process;o.isSplit()&&i.isJoin()?(s=o,a=i):(s=l.createSplit(),a=l.createJoin(),ModelUtil.relinkNode(l,o,t,s),ModelUtil.relinkNode(l,t,i,a,!0),d.addNodeToSwimlane(t,s),d.addNodeToSwimlane(t,a));for(var c=[],h=0,u=e.length;h<u;h++){var f=e[h];if(f.name){f.nodeDesc=f.nodeDesc||"";var p=l.createByParty(f);c.push(p)}}return d.addNodeToSwimlane(t,c),ModelUtil.addNodes(l,s,a,c,!1,t),!0}},t._addParallel=function(e){if(!this._check())return!1;var t,i=this.view.controller.model,o=i.process,n=this.currentNode;t=n.getDownLinks()[0].getToNode();var r=i.createSplit(),s=i.createJoin(),a=[];a.push(r),a.push(s),o.addNodeToSwimlane(n,a),ModelUtil.relinkNode(i,n,t,a),ModelUtil.removeLink(i,r,s);for(var l=[],d=0,c=e.length;d<c;d++){var h=e[d];if(h.name){h.nodeDesc=h.nodeDesc||"";var u=i.createByParty(h);l.push(u)}}return o.addNodeToSwimlane(n,l),ModelUtil.addNodes(i,r,s,l),!0},t._addSerail=function(e){if(!this._check())return!1;var t,i=this.currentNode;t=i.getDownLinks()[0].getToNode();for(var o=[],n=this.view.controller.model,r=n.process,s=0,a=e.length;s<a;s++){var l=e[s];if(l.name){l.nodeDesc=l.nodeDesc||"";var d=n.createByParty(l);o.push(d)}}return r.addNodeToSwimlane(i,o),ModelUtil.relinkNode(n,i,t,o),!0},m.AddPartyCommand=e}(WorkflowApp),function(e){var t=function e(t,i){e.__super__.constructor.apply(this,arguments),this.currentNode=i,this.view=t};WorkflowUtil.extend(t,e.Command);var i=t.prototype;i.run=function(){var e=WorkflowUtil.context,t=this.currentNode,i=this.view;if(e.scene===WorkflowConstant.scene.RUNNING_MANAGERCONTROL||e.scene===WorkflowConstant.scene.RUNNING_SUPERVISION){var o=t.getState(),n=WorkflowConstant.nodeState,r=0;if(t.isInfoNode()&&o!==n.STATE_NORMAL)return void this._cancleCommand(e.label.unDN1);if(o===n.STATE_READY)return void this._cancleCommand(e.label.unDN2);if(o===n.STATE_NORMAL||o===n.STATE_CANCEL){r=t.getAvailableUpNodes()[0].getState()===n.STATE_FINISHED?4:3}else{if(o!==n.STATE_READY)return void this._cancleCommand(e.label.unDN0);if("user"===t.getPartyType())r=4;else for(var s=i.controller.model.caseItemLog.getWorkItems(t.getId()),a=WorkflowConstant.WorkitemAction,l=0,d=s.length;l<d;l++){var c=s[l].getItemAction();if(r=4,c!==a.ACTION_CREATE&&c!==a.ACTION_CANCEL_BYACTIVITY)return r=0,void this._cancleCommand(e.label.unDN0)}}var h=t.getAvailableDownNodes()[0],u=0;if(h.isJoin())for(var f=h.getAvailableUpNodes(),p=0,m=f.length;p<m;p++){var g=f[p].getState();g!==n.STATE_READY&&g!==n.STATE_FINISHED||u++}else u=1;var v="false";o!==n.STATE_READY&&o!==n.STATE_ZCDB||1!==u||(v="true");var w=i.controller.model.process.getId(),N=[];N.push(w),N.push(t.getId()),N.push(r+""),N.push(v),N.push(t.getActor().getPartyType()),N.push(t.state),i.blurNode(t),_exePageFunction("edocDelNodeItem",N)}else{this._executeRemoveNode(this.currentNode,!1)?(i.controller.drawOrRefreshView(),ViewUtil.triggerEvent("flowChangeEvent")):this._cancleCommand(e.label.unallowed)}},i._cancleCommand=function(e){var t=this.view,i=this.currentNode;t.blurNode(i),WorkflowUtil.toast(e)},i._executeRemoveNode=function(e,t){var i=this.view.controller.model,o=i.process,n=e.isStart(),r=e.isEnd(),s=e.isSplit()||e.isJoin();if(!0!==t&&(n||r||s))return!1;ModelUtil.clearCopyNodeProperty(o,e);var a,l,d=e.getUpLinks()[0],c=d.getFromNode(),h=e.getDownLinks()[0],u=h.getToNode();if(c.isStart()&&u.isEnd()&&!i.isNewCreate())return!1;(o.removeNode(e),c.isSplit()&&u.isJoin())?(o.removeLink(d),o.removeLink(h),1===c.getDownLinks().length&&(this._executeRemoveNode(c,!0),this._executeRemoveNode(u,!0))):(l=u.isJoin()||u.isEnd()?(a=h,d):(h.hasCondition()&&h.copyCondition(d),a=d,h),o.removeLink(l),ModelUtil.makeLink(c,u,a));for(var f=e.getCircleUpLinks(),p=e.getCircleDownLinks(),m=[].concat(f,p),g=0,v=m.length;g<v;g++)o.removeCircleLink(m[g]);return!0},e.RemovePartyCommand=t}(WorkflowApp),function(e){var t=function e(t,i){e.__super__.constructor.apply(this,arguments),this.currentNode=i,this.view=t};WorkflowUtil.extend(t,e.Command);var i=t.prototype;i.run=function(){var e=WorkflowUtil.context,t=this.view,i=this.currentNode;if(e.scene===WorkflowConstant.scene.RUNNING_MANAGERCONTROL||e.scene===WorkflowConstant.scene.RUNNING_SUPERVISION){var o=i.getState(),n=WorkflowConstant.nodeState,r=0;if(o===n.STATE_NORMAL||o===n.STATE_CANCEL)r=5;else{if(o!==n.STATE_READY&&o!==n.STATE_ZCDB)return WorkflowUtil.toast(e.label.unRN0),void t.blurNode(i);if("user"===i.getPartyType())r=6;else for(var s=t.controller.model.caseItemLog.getWorkItems(i.getId()),a=WorkflowConstant.WorkitemAction,l=0,d=s.length;l<d;l++){r=6,s[l].getItemAction()==a.ACTION_SUSPEND&&(r=0,WorkflowUtil.toast(e.label.unRN0),t.blurNode(i))}}var c=t.controller.model.process.getId(),h=[];h.push(c),h.push(i.getId()),h.push(r+""),h.push(i.getActor().getPartyType()),h.push(i.state),t.blurNode(i),_exePageFunction("edocReplaceNodeItem",h)}else{var u=i.isSplit()||i.isJoin(),f=i.isStart(),p=i.isEnd();u&&f&&p?(t.blurNode(this.currentNode),WorkflowUtil.toast(e.label.unallowed)):this.exeCommand("designerCallReplaceNode",{isTemplete:e.isTemplete})}},i.replaceHumenNode=function(e){var t=WorkflowUtil.context,i=this.view,o=this.currentNode;if(i.blurNode(this.currentNode),this.destroy(),1<e.length)WorkflowUtil.toast(t.label.unRN2);else if(!(e.length<1)&&this.exeReplaceNode(e)){var n=i._getVerify(o.getId());n.r0="true",n.r0msg="";var r=i.controller.model.process;ModelUtil.clearCopyNodeProperty(r,o),i.controller.drawOrRefreshView(),ViewUtil.triggerEvent("flowChangeEvent")}},i.exeReplaceNode=function(e){var t=this.view,i=t.controller.model,o=this.currentNode,n=WorkflowUtil.context,r=o.isBlank(),s=e[0],a=i.createByParty(s),l=a.getActor();o.setName(a.getName()),o.setForceRedraw(!0),o.setActor(l);var d=o.getPolicy();r&&(d.setAttr("id",a.getPolicy().getAttr("id")),d.setAttr("name",a.getPolicy().getAttr("name"))),"Member"===s.type?d.setProcessMode("single"):"Node"===s.type&&"Sender"===s.id||"Node"===s.type&&-1!==s.id.indexOf("ReciprocalRoleReporter")||-1!==s.id.indexOf("Member@")?d.setProcessMode("single"):n.isTemplete?"BlankNode"==s.id&&(d.setProcessMode("single"),d.setAttr("multipleMode","")):d.setProcessMode("all");var c=l.getAttr("partyType"),h=l.getAttr("partyId"),u=d.getAttr("id");if("Post"===c){var f=t._getVerify(o.getId());f.r4="true",f.r4msg=""}"HumenNode"===o.getNodeType()&&o.setAttr("isValid","normal"),o.setAttr("customName",""),o.setAttr("customNameI18n","");var p=!1;"FormField"===c&&(h.indexOf("#")===h.lastIndexOf("#")&&(0===h.indexOf("Member")||0===h.indexOf("Multimember")||(p=!0)));var m=o.isInfoNode();if((o.isBlank()||m||"vouch"===u||"2"===d.getAttr("stepBackType"))&&ModelUtil.removeAllCircleLink(i.process,o),o.isBlank()||p){d.setAttr("isHasNewflow","0"),o.isBlank()&&d.setProcessMode("single");var g=o.getUpLinks()[0],v=g.getFromNode(),w=o.getDownLinks()[0],N=w.getToNode();i.process.resetNodeId(o),ModelUtil.makeLink(v,o,g),ModelUtil.makeLink(o,N,w)}return i.resetPolicy(o),!0},i.cancelExeCommand=function(){this.view.blurNode(this.currentNode),this.destroy()},e.ReplaceNodeCommand=t}(WorkflowApp),function(e){var t=function e(t,i,o){e.__super__.constructor.apply(this,arguments),this.currentLink=i,this.view=t,this.type=o};WorkflowUtil.extend(t,e.Command);var i=t.prototype;i.run=function(){switch(this.type){case"auto":this._exeAutoCommand();break;case"manual":this._exeManualCommand();break;case"exclusive":this._exeExclusiveCommand();break;case"delete":this._exeDeleteCommand();break;case"branchDesc":this._exeDescCommand()}},i._exeManualCommand=function(){var e={conditionType:WorkflowConstant.ConditionType.handCondition,formCondition:"",conditionId:ModelUtil.nextId(),isForce:"",conditionBase:"",conditionTitle:"",submitStyle:""};this.autoCondition(e,!1)},i._exeExclusiveCommand=function(){var e={conditionType:WorkflowConstant.ConditionType.exclusiveCondition,formCondition:"",conditionId:ModelUtil.nextId(),isForce:"",conditionBase:"",conditionTitle:"",submitStyle:""};this.autoCondition(e,!1)},i._exeDeleteCommand=function(){var e=this.currentLink,t=this.view,i=this;function o(){t.blurLine(e),i.destroy(),i=e=t=null}e.hasCondition()?$.confirm({msg:$.i18n("workflow.branch.confirmdelcondition"),ok_fn:function(){i._confirmDeleteBranch(),i=null},cancel_fn:function(){o()}}):o()},i._confirmDeleteBranch=function(){var e=this.currentLink;if(e.isCircleLine()){var t=this.view,i=t.controller.model.process,o=e.getFromNode(),n=e.getToNode();o.removeCircleDonwLink(e.getId()),n.removeCircleUpLink(e.getId()),i.removeCircleLink(e),t.draw()}else{var r={conditionType:WorkflowConstant.ConditionType.noCondition,formCondition:"",conditionId:"",isForce:"",conditionBase:"",conditionTitle:"",submitStyle:""};e.setAttr("desc",""),this.autoCondition(r)}},i._exeDescCommand=function(){var e=this.currentLink,t=this.view;if(e.hasCondition()){var i={linkId:e.getId(),conditionId:e.getAttr("conditionId"),conditionDesc:e.getAttr("desc")};this.exeCommand("designerCallMoreOption",i)}else WorkflowUtil.toast($.i18n("workflow.branch.firstsetcondition")),t.blurLine(e),this.destroy()},i._exeAutoCommand=function(){var e=WorkflowUtil.context,t=this.currentLink,i=e.appName;e.isFormTemplate&&(i="form");var o={linkId:t.getId(),appName:i,conditionId:t.getAttr("conditionId"),formCondition:t.getAttr("formCondition"),conditionTitle:t.getAttr("conditionTitle"),conditionType:t.getAttr("conditionType"),isForce:t.getAttr("isForce"),conditionBase:t.getAttr("conditionBase"),conditionDesc:t.getAttr("desc"),isCircle:("Clink"===t.getNodeType())+"",submitStyle:t.getAttr("submitStyle")};this.exeCommand("designerCallAutoOption",o)},i.updateConditionDesc=function(e){var t=this.currentLink,i=this.view;t.setAttr("desc",e),i.blurLine(t),ViewUtil.triggerEvent("flowChangeEvent"),this.destroy()},i.autoCondition=function(e,t){var i=this.currentLink,o=this.view;i.setAttr("conditionType",e.conditionType),i.setAttr("formCondition",e.formCondition),i.setAttr("conditionId",e.conditionId),i.setAttr("isForce",e.isForce),i.setAttr("conditionBase",e.conditionBase),i.setAttr("conditionTitle",e.conditionTitle),i.setAttr("submitStyle",e.submitStyle);var n=o._getVerify(i.getId());n.r0="true",n.r0msg="",i.setForceRedraw(!0),"newCircle"===this.type?this._autoConditionCallback():!1!==t&&(o.blurLine(i),this.destroy()),ViewUtil.triggerEvent("flowChangeEvent"),o.draw()},i.cancelExeCommand=function(){this.view.blurLine(this.currentLink),this.destroy()},e.BranchConditionCommand=t}(WorkflowApp),function(e){var t=function e(t,i){e.__super__.constructor.apply(this,arguments),this.currentNode=i,this.view=t};WorkflowUtil.extend(t,e.Command);var i=t.prototype;i.run=function(){for(var e=this.currentNode,t=this.view,i=e.getPolicy(),o=t.controller.model.process.getNodes(),n=[],r=0,s=o.length;r<s;r++){var a=o[r];if(!a.isEnd()&&!a.isSplit()&&!a.isJoin()){var l=a.getPolicy();n.push(a.getId()+"|"+l.getAttr("DR"))}}this.exeCommand("designerCallRelationData",{activityId:e.getId(),activityName:e.getName(),policyId:e.getPolicyId(),policyName:e.getPolicyName(),nodeIdAndDRLists:n.join(","),DR:i.getAttr("DR")}),this.destroy()},i.cancelExeCommand=function(){this.view.blurNode(this.currentNode),this.destroy()},e.RelationDataCommand=t}(WorkflowApp),function(e){var t=function e(t,i){e.__super__.constructor.apply(this,arguments),this.currentNode=i,this.view=t};WorkflowUtil.extend(t,e.Command);var i=t.prototype;i.run=function(){var e=this.currentNode,t=this.view,i=WorkflowUtil.context,o=e.getPolicy(),n=!1;if(e.isSplit()||e.isJoin()||e.isStart()||e.isEnd())WorkflowUtil.toast(i.label.unallowed);else if(e.isInfoNode())WorkflowUtil.toast(i.label.unANF0);else{var r=o.getAttr("processMode");if("single"===r||"competition"===r){n=!0;var s={nodeId:e.getId()};this.exeCommand("designerCallCallNewflowSetting",s)}else WorkflowUtil.toast(i.label.unANF1)}n||t.blurNode(e)},i.updateNewWorkflow=function(e){var t=this.view,i=this.currentNode,o=i.getPolicy();t.blurNode(i),this.destroy(),i.setForceRedraw(!0),o.setAttr("isHasNewflow",e.isNewWorkflow?"1":"0");var n=t._getVerify(i.getId());n.r2="true",n.r2msg="",t.controller.drawOrRefreshView()},i.cancelExeCommand=function(){this.view.blurNode(this.currentNode),this.destroy()},e.SettingNewflowCommand=t}(WorkflowApp),function(e){var t=function e(t,i){e.__super__.constructor.apply(this,arguments),this.currentLink=null,this.type="newCircle",this.currentNode=i,this.view=t};WorkflowUtil.extend(t,e.BranchConditionCommand);var i=t.prototype;i.run=function(){var e=this.currentNode,t=this.view,i=(e.getPolicy(),WorkflowUtil.context,ModelUtil.findCanSelectNodes(e));this.beforExe(),t.initCircleBranchModel(e,i)},i.newCircleBranch=function(e){for(var t=this.currentNode,i=this.view,o=i.controller.model,n=t.getCircleDownLinks(),r=0,s=n.length;r<s;r++){var a=n[r],l=a.getToNode();if(e.getId()===l.getId()){this.currentLink=a,this.cancelExeCommand(),i.focusLine(this.currentLink),this.type="auto";break}}null===this.currentLink&&(this.currentLink=o.createCircleLink(t,e)),this._exeAutoCommand()},i._autoConditionCallback=function(){var e=this.currentLink,t=this.view,i=e.getFromNode(),o=e.getToNode();t.controller.model.process.addCircleLink(e),i.addCircleDonwLink(e),o.addCircleUpLink(e),t.destroyCircleBranchModel(!1),t.blurNode(this.currentNode)},i.cancelExeCommand=function(){var e=this.view;e.destroyCircleBranchModel(),"auto"===this.type?e.blurLine(this.currentLink):e.blurNode(this.currentNode),this.destroy()},e.NewCircleBranchCommand=t}(WorkflowApp),function(e){var t=function e(t,i){e.__super__.constructor.apply(this,arguments),this.currentNode=i,this.view=t,this.addType="addBranch",this.toNode=null};WorkflowUtil.extend(t,e.AddPartyCommand);var i=t.prototype;i.run=function(){var e=this.currentNode,t=this.view,i=WorkflowUtil.context,o=ModelUtil.findCanSelectNode4AddBranch(e),n=!0;for(var r in o)if(o.hasOwnProperty(r)&&r!==e.getId()){n=!1;break}if(n)return WorkflowUtil.toast(i.label.unSN4),void this.cancelExeCommand();this.beforExe(),t.initAddBranchModel(e,o)},i.runAddBranch=function(e){this.toNode=e,t.__super__.run.apply(this,arguments)},i._getSplitAndJoinNode=function(){var e,t,i=this.view.controller.model,o=this.currentNode,n=this.toNode,r=i.process,s=!0;return o.isSplit()&&(t=ModelUtil.findJoin(o)).getId()===n.getId()&&(s=!1,e=o),s&&(e=i.createSplit(),t=i.createJoin(),ModelUtil.relinkNode(i,o.getUpNodes()[0],o,e,!0),ModelUtil.relinkNode(i,n,n.getDownNodes()[0],t,!0),r.addNodeToSwimlane(o,e),r.addNodeToSwimlane(n,t)),{split:e,join:t,newRouter:s}},i._addSerail4AddBranch=function(e){return this._doAddBranch(e,"Serail"),!0},i._addParallel4AddBranch=function(e){return this._doAddBranch(e,"Parallel"),!0},i._doAddBranch=function(e,t){var i=this.view,o=i.controller.model,n=this.currentNode,r=o.process;r.hasSwimlane()&&"false"===r.getAttr("showSwimlane")&&i.controller.autoLayout.calculateLocation(r,!1);for(var s=this._getSplitAndJoinNode(),a=s.split,l=s.join,d=s.newRouter,c=[],h=0,u=e.length;h<u;h++){var f=e[h];if(f.name){f.nodeDesc=f.nodeDesc||"";var p=o.createByParty(f);c.push(p)}}if("Serail"===t){if(ModelUtil.addNodes(o,a,l,c,!0),r.hasSwimlane()){var m;m=d?0:1;for(var g=this.toNode.getSwimlane(),v=n.getSwimlane(),w=v.getMaxX()-n.getX()-m,N=0,A=c.length;N<A;){for(var _=0;_<w&&N<A;_++)v.addNode(c[N]),N++;if(v.getId()!==g.getId()){var y=r.getRightSwimlane(v.getId());null!=y&&(v=y)}w=v.getMaxX()-v.getMinX()}}}else if(ModelUtil.addNodes(o,a,l,c,!1),r.hasSwimlane())if(d)r.addNodeToSwimlane(n,c);else{var S,b=n.getSwimlane();1<b.getMaxX()-n.getX()?S=b:null==(S=r.getRightSwimlane(b.getId()))&&(S=b);for(var I=0,C=c.length;I<C;I++)S.addNode(c[I])}i.destroyAddBranchModel(!1)},i.cancelExeCommand=function(){var e=this.view;e.destroyAddBranchModel(),e.blurNode(this.currentNode),this.destroy()},e.AddBranchCommand=t}(WorkflowApp),function(e){var t=function e(t,i){e.__super__.constructor.apply(this,arguments),this.currentNode=i,this.view=t,this.toNode=null};WorkflowUtil.extend(t,e.Command);var i=t.prototype;i.run=function(){var e=this.view,t=this.currentNode,i=e.controller.model.process,o=WorkflowUtil.context,n=(t.getPolicy(),i.getAttr("usedNumberStr"));if(99<(n?n.split(","):[]).length)return WorkflowUtil.toast(o.label.cp0),void this.cancelExeCommand();var r=e._getVerify(t.getId());if("false"===r.r0||"false"===r.r1||"false"===r.r2||"false"===r.r3||"false"===r.r4)return WorkflowUtil.toast(o.label.cp2),void this.cancelExeCommand();this.beforExe(),t.setForceRedraw(!0),e.initCopyNodeModel(t)},i.pasteReplace=function(e){var t=this.currentNode,i=this.view.controller;this.toNode=e;var o=[];o.push(t.getId()),o.push(e.getId()),o.push(i.parseProcess2XML()),this.exeCommand("isCanPasteAndReplaceNode",o)},i.pasteAndReplaceNode=function(){var e=this.currentNode,t=this.toNode,i=this.view,o=i.controller.model.process,n=i.viewState.currentNumber;n||(n=e.getAttr("copyNumber")),i.blurNode(t),i.blurNode(e),i.destroyCopyNodeModel(),this.destroy();for(var r=e.getAttr("pasteTo"),s=r?r.split(","):[],a=0,l=s.length;a<l;a++)if(s[a]===t.getId())return void s.splice(a,1);ModelUtil.clearCopyNodeProperty(o,t);for(var d=o.getAttr("usedNumberStr"),c=d?d.split(","):[],h=0,u=c.length;h<u;h++)if(c[h]===n){c.splice(h,1);break}c.push(n),o.setAttr("usedNumberStr",c.join(",")),s.push(t.getId()),e.setAttr("pasteTo",s.join(",")),e.setAttr("copyNumber",n),t.copyAttrFromObj(e,["isValid","name","customName","customNameI18n","desc","copyNumber"]),t.setAttr("copyFrom",e.getId());var f=e.getActor(),p=e.getPolicy(),m=t.getActor(),g=t.getPolicy();m.copyAttrFromObj(f,["roleId","partyExcludeChildChild","partyId","partyType","name","partyAccountId","shortName"]),g.copyAttrFromObj(p,["id","name","formField","processMode","formApp","form","operationm","operationName","matchScope","dealTerm","remindTime","cycleRemindTime","dealTermType","dealTermUserId","dealTermUserName","rup","pup","na","ignoreBlank","asBlankNode","queryIds","statisticsIds","rScope","mu","multipleMode","naUserId","naUserName","finishedCondition","executeFinishedValue","messageRule","sealMethod"]),"1"===g.getAttr("isHasNewflow")&&(_exePageFunction("designerCallDeleteSubProcess",t.getId()),g.setAttr("isHasNewflow","0"));var v=i._getVerify(t.getId());v.r0=v.r1=v.r2=v.r3="true",v.r0msg=v.r1msg=v.r2msg=v.r3msg="",e.setForceRedraw(!0),t.setForceRedraw(!0),ViewUtil.triggerEvent("flowChangeEvent"),i.draw()},i.cancelExeCommand=function(){var e=this.view;this.currentNode.setForceRedraw(!0),this.toNode&&this.toNode.setForceRedraw(!0),e.destroyCopyNodeModel(),this.destroy()},e.CopyNodeCommand=t}(WorkflowApp),function(e){var t=function e(t,i){e.__super__.constructor.apply(this,arguments),this.currentNode=i,this.view=t};WorkflowUtil.extend(t,e.Command);var i=t.prototype;i.run=function(){var e=this.currentNode,t=[];t.push(e.getId()),t.push(e.getName()),t.push(e.getPolicyId()),t.push(e.getPolicyName()),this.exeCommand("setAdvanceEvent",t)},i.setAdvanceEventFlag=function(e){var t=this.currentNode,i=this.view;this.destroy(),"true"===e?t.setAttr("hasAdvanceEvent","1"):t.setAttr("hasAdvanceEvent","0"),t.setForceRedraw(!0),i.draw()},i.cancelExeCommand=function(){this.view.blurNode(this.currentNode),this.destroy()},e.AdvanceEventCommand=t}(WorkflowApp),function(e){var t=function e(t,i,o){e.__super__.constructor.apply(this,arguments),this.currentNode=i,this.view=t,this.showProp=o};WorkflowUtil.extend(t,e.Command);var i=t.prototype;i.run=function(){!0===this.showProp?this._showProp():this._settingProp()},i._showProp=function(){var e=this.view,t=this.currentNode,i=t.getActor(),o=t.getPolicy(),n=e.controller.model.caseItemLog;if(!(t.isBlank()||t.isEnd()||t.isStart()||t.isSplit()||t.isJoin())){var r=t.getId(),s=t.getState(),a=t.getName(),l=o.getAttr("processMode"),d=i.getAttr("partyType");"user"===d&&(l="single");var c=o.getAttr("name"),h=o.getAttr("id"),u="1"===o.getAttr("isOvertopTime")?"1":"0",f=0,p=0;n&&(f=n.getItemReceiveTime(r),p=n.getItemDealTime(r));var m=o.getAttr("dealTerm"),g=o.getAttr("remindTime");if(0!==f)if(0===m)u="0";else{var v=6e4*Number(m),w=p;0===w&&(w=(new Date).getTime()),u=v<w-f?"1":"0"}else u="0";var N="";if(0!==f)N=new Date(f).format("yyyy-MM-dd hh:mm:ss");var A="";if(0!==p)A=new Date(p).format("yyyy-MM-dd hh:mm:ss");var _=i.getAttr("shortName"),y=a;"Account"!==d&&"Role"!==d&&"Node"!==d&&_&&(y=y+"("+_+")");var S=!0;"true"===i.getAttr("partyExcludeChildChild")&&(S=!1);var b={stateStr:s,nodeName:y,nodePolicy:c,receiveTime:N,completeTime:A,overtopTime:u,processMode:l,policyId:h,dealTime:m,remindTime:g,partyId:i.getAttr("partyId"),partyType:d,matchScope:o.getAttr("matchScope"),nodeId:r,desc:t.getAttr("desc"),formApp:o.getAttr("formApp"),formId:o.getAttr("form"),operationName:o.getAttr("operationName"),operationId:o.getAttr("operationm"),dealTermType:o.getAttr("dealTermType"),dealTermUserId:o.getAttr("dealTermUserId"),dealTermUserName:o.getAttr("dealTermUserName"),hst:o.getAttr("hst"),hstv:o.getAttr("hstv"),rup:o.getAttr("rup"),pup:o.getAttr("pup"),na:o.getAttr("na"),naUserId:o.getAttr("naUserId"),naUserName:o.getAttr("naUserName"),tolerantModel:o.getAttr("tolerantModel"),queryIds:o.getAttr("queryIds"),statisticsIds:o.getAttr("statisticsIds"),rScope:o.getAttr("rScope"),mu:o.getAttr("mu"),na_i:o.getAttr("ignoreBlank"),na_b:o.getAttr("asBlankNode"),cycleRemindTime:o.getAttr("cycleRemindTime"),vjoin:i.getAttr("partyVJoin"),mergeDealType:o.getAttr("mergeDealType"),customName:t.getAttr("customName"),isOrderExecute:o.getAttr("multipleMode"),stepBackType:o.getAttr("stepBackType"),finishedCondition:o.getAttr("finishedCondition"),executeFinishedValue:o.getAttr("executeFinishedValue"),messageRule:o.getAttr("messageRule"),formfiled:o.getAttr("formField"),isProIncludeChild:S,sealMethod:o.getAttr("sealMethod")};this.exeCommand("designerCallCheckPropertyItem",b),this.destroy()}},i._settingProp=function(){var e=WorkflowUtil.context,t=this.view,i=this.currentNode,o=i.getPolicy(),n=i.getActor(),r=!0;if(i.isJoin()&&(WorkflowUtil.toast(e.label.unallowed),r=!1),r){var s="",a="",l="",d="",c="";null!=n&&(s=n.getAttr("partyType"),a=n.getAttr("partyId"),l=n.getAttr("partyVJoin"),d=n.getAttr("partyExcludeChildChild"),c=n.getAttr("shortName"));var h=!0;"true"===d&&(h=!1);var u=i.getName();"Account"!==s&&"Role"!==s&&"Node"!==s&&c&&(u=u+"("+c+")");var f=!0;"user"!==s&&"Sender"!==a||(f=!1);var p=o.getAttr("dealTerm");p&&"null"!==p||(p=0);var m=o.getAttr("remindTime");m&&"null"!==m||(m=-1);var g=o.getAttr("cycleRemindTime");if(g&&"null"!==g||(g=-1),e.scene===WorkflowConstant.scene.RUNNING_MANAGERCONTROL||e.scene===WorkflowConstant.scene.RUNNING_SUPERVISION){if(i.isStart())return WorkflowUtil.toast(e.label.unSN1),void t.blurNode(i);var v=i.getState(),w=WorkflowConstant.nodeState;if(i.isInfoNode()&&v!==w.STATE_NORMAL)return WorkflowUtil.toast(e.label.unSN2),void t.blurNode(i);if(v===w.STATE_FINISHED||v===w.STATE_STOP||v===w.STATE_SUSPENDED||v===w.STATE_NEEDREDO_TOME)return WorkflowUtil.toast(e.label.unSN3),void t.blurNode(i);var N=t.controller.model.process.getId(),A=[];A.push(u),A.push(o.getAttr("id")),A.push(p),A.push(m),A.push(o.getAttr("processMode")),A.push(o.getAttr("formApp")),A.push(o.getAttr("form")||null),A.push(o.getAttr("operationName")),A.push(i.getNodeType()),A.push(f),A.push(i.getId()),A.push(N),A.push(i.getId()),A.push("7"),A.push(i.getPartyId()),A.push(i.getPartyType()),A.push(o.getAttr("matchScope")),A.push(v),v===w.STATE_READY||v===w.STATE_ZCDB?A.push("supervise_pending"):A.push(""),i.getAvailableUpLinks()[0].hasCondition()?A.push("true"):A.push("false"),A.push(i.getAttr("desc")),A.push(o.getAttr("dealTermType")),A.push(o.getAttr("dealTermUserId")),A.push(o.getAttr("dealTermUserName")),e.isTemplete?A.push("true"):A.push("false"),A.push(e.appName),A.push(h+""),A.push(e.scene+""),A.push(o.getAttr("formField")),A.push(o.getAttr("hst")),A.push(o.getAttr("hstv")),A.push(i.getAttr("copyFrom")),A.push(i.getAttr("copyNumber")),A.push(i.getAttr("pasteTo")),A.push(o.getAttr("rup")),A.push(o.getAttr("pup")),A.push(o.getAttr("na")),A.push(o.getAttr("operationm")),A.push(o.getAttr("tolerantModel")),A.push(o.getAttr("queryIds")),A.push(o.getAttr("statisticsIds")),A.push(o.getAttr("rScope")),A.push(o.getAttr("mu")),A.push((0<i.getCircleUpLinks().length||0<i.getCircleDownLinks().length)+""),A.push(i.getAttr("hasAdvanceEvent")),t.blurNode(i),_exePageFunction("setEdocPolicy",A)}else{var _={nodeName:u,policyName:o.getAttr("id"),dealTerm:p,remindTime:m,processMode:o.getAttr("processMode"),formApp:o.getAttr("formApp"),operationm:o.getAttr("operationm"),operationName:o.getAttr("operationName"),form:o.getAttr("form"),nodeType:i.getNodeType(),isEditor:f,nodeId:i.getId(),partyId:a,partyType:s,matchScope:o.getAttr("matchScope"),nodeState:i.getState(),hasNewflow:i.hasSubProcess(),hasBranch:0<i.getUpLinks().length&&i.getUpLinks()[0].hasCondition(),formfiled:o.getAttr("formField"),desc:i.getAttr("desc"),dealTermType:o.getAttr("dealTermType"),dealTermUserId:o.getAttr("dealTermUserId"),dealTermUserName:o.getAttr("dealTermUserName"),isTemplete:e.isTemplete,appName:e.appName,isProIncludeChild:h,scene:e.scene+"",hst:o.getAttr("hst"),hstv:o.getAttr("hstv"),copyFrom:i.getAttr("copyFrom"),copyNumber:i.getAttr("copyNumber"),pasteTo:i.getAttr("pasteTo"),rup:o.getAttr("rup"),pup:o.getAttr("pup"),na:o.getAttr("na"),naUserId:o.getAttr("naUserId"),naUserName:o.getAttr("naUserName"),tolerantModel:o.getAttr("tolerantModel"),queryIds:o.getAttr("queryIds"),statisticsIds:o.getAttr("statisticsIds"),rScope:o.getAttr("rScope"),mu:o.getAttr("mu"),na_i:o.getAttr("ignoreBlank"),na_b:o.getAttr("asBlankNode"),cycleRemindTime:g,vjoin:l,mergeDealType:o.getAttr("mergeDealType"),customName:i.getAttr("customName"),isOrderExecute:o.getAttr("multipleMode"),hasCircleBranch:(0<i.getCircleUpLinks().length||0<i.getCircleDownLinks().length)+"",hasAdvanceEvent:i.getAttr("hasAdvanceEvent"),finishedCondition:o.getAttr("finishedCondition"),executeFinishedValue:o.getAttr("executeFinishedValue"),messageRule:o.getAttr("messageRule"),sealMethod:o.getAttr("sealMethod")};this.exeCommand("designerCallSelectPolicy",_)}}else t.blurNode(i)},i.setProp=function(e){WorkflowUtil.context;var t=this.view,i=t.controller.model.process,o=this.currentNode,n=o.getActor(),r=o.getPolicy();t.blurNode(this.currentNode),this.destroy();var s=e.policyId,a=e.policyName,l=e.dealTerm,d=e.remindTime,c=e.processMode,h=e.formApp,u=e.form,f=e.operationName,p=e.operationm,m=e.matchScope,g=e.hasNewflow,v=e.isApplyToAll,w=e.formFieldId,N=e.desc,A=e.dealTermType,_=e.dealTermUserId,y=e.dealTermUserName,S=e.hasDesc,b=e.isProIncludeChild,I=e.hst,C=e.hstv,k=e.rAutoUp,T=e.pAutoUp,M=e.nuAction,U=e.tolerantModel,x=e.nodeNameNew,E=e.queryIds,V=e.statisticsIds,L=e.rScope,P=e.mu,B=e.na_i,O=e.na_b,D=e.naUserId,W=e.naUserName,R=e.cycleRemindTime,F=e.mergeDealType,G=e.customName,X=e.isOrderExecute,j=e.finishedCondition,z=e.executeFinishedValue,H=e.messageRule,$=e.customNameI18n,J=e.sealMethod;if(o.isSplit())r.setAttr("hst",I);else{var Y=n.getAttr("partyType"),q=n.getAttr("partyId")||"";o.isSuperNode()&&o.setName(x),r.setAttrs({dealTerm:l,name:a,id:s,dealTermType:A,dealTermUserId:_,dealTermUserName:y,remindTime:d,cycleRemindTime:R,processMode:c,multipleMode:X,form:u,operationName:f,operationm:p,formApp:h,matchScope:m,isHasNewflow:"true"===g?"1":"0",formField:w,hst:I,hstv:C,tolerantModel:U,rup:k,rScope:L,mu:P,pup:T,na:M,naUserId:D,naUserName:W,ignoreBlank:B,asBlankNode:O,queryIds:E,statisticsIds:V,mergeDealType:F,finishedCondition:j,executeFinishedValue:z,messageRule:H,sealMethod:J}),!0,"vouch"===s?r.setAttr("stepBackType","1"):r.setAttr("stepBackType","0"),o.setAttr("desc","0"===S?"":N),o.setAttr("customName",G),o.setAttr("customNameI18n",$);var Z="inform"===s||"zhihui"===s;if(Z&&ModelUtil.removeAllCircleLink(i,o),"vouch"===s&&ModelUtil.removeAllUpCircleLink(i,o),"4"!==m||"Post"!==Y&&(-1===q.toLowerCase().indexOf("post")||"FormField"!==Y&&"WFDynamicForm"!==Y)||n.setAttrs({includeChild:b,partyExcludeChildChild:"true"===b?"false":"true"}),"true"===v)for(var K=i.getNodes(),Q=0,ee=K.length;Q<ee;Q++){var te=K[Q],ie=te.getPolicy(),oe=te.getActor(),ne=te.getNodeType();if("SynNode"!==ne&&"StartNode"!==ne&&"EndNode"!==ne&&o.getId()!==te.getId()&&!te.isBlank()&&!te.isSuperNode()){var re=oe.getAttr("partyType"),se=oe.getAttr("partyId");te.setForceRedraw(!0),"4"!==ie.getAttr("matchScope")||"Post"!==re&&(-1===se.toLowerCase().indexOf("post")||"FormField"!==re&&"WFDynamicForm"!==re)||oe.setAttrs({includeChild:b,partyExcludeChildChild:"true"===b?"false":"true"});var ae=!1;if(Z&&te.hasSubProcess()||(ie.setAttrs({id:s,name:a}),ae=!0),ae){var le=t._getVerify(te.getId());le.r1="true",le.r1msg="",le.r5="true",le.r5msg="",te.isStart()&&(le.r0="true",le.r0msg="")}"0"===ie.getAttr("dealTerm")&&ie.setAttr("dealTermType",""),ie.setAttrs({dealTerm:l,remindTime:d,cycleRemindTime:R,messageRule:H}),"2"!==A?ie.setAttrs({dealTermType:A,dealTermUserId:_,dealTermUserName:y}):ie.getAttr("dealTermType")||ie.setAttr("dealTermType","0"),Z&&ie.setAttr("mergeDealType",F)}}var de=t._getVerify(o.getId());o.isStart()&&(de.r0="true",de.r0msg=""),de.r1="true",de.r1msg="",de.r5="true",de.r5msg="",de.r3="true",de.r3msg="",de.r4="true",de.r4msg="";var ce=o.getAttr("pasteTo");if(ce)for(var he=ce?ce.split(","):[],ue=0,fe=he.length;ue<fe;ue++){var pe=he[ue],me=i.getNode(pe),ge=me.getPolicy(),ve=me.getActor();ge.setAttrs({processMode:c,multipleMode:X,matchScope:m,formField:w,rup:k,rScope:L,mu:P,pup:T,na:M,ignoreBlank:B,asBlankNode:O,naUserId:D,naUserName:W,finishedCondition:j,executeFinishedValue:z,messageRule:H,sealMethod:J}),ve.setAttrs({includeChild:b,partyExcludeChildChild:"true"===b?"false":"true"});var we=t._getVerify(me.getId());we.r4="true",we.r4msg=""}o.setForceRedraw(!0),t.controller.drawOrRefreshView(!1)}},i.cancelExeCommand=function(){this.view.blurNode(this.currentNode),this.destroy()},e.SettingPropCommand=t}(WorkflowApp);WorkflowApp.buildInfo="B2020-09-15";